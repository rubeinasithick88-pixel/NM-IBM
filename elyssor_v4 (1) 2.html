<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Elyssor â€” Professional Resume Builder</title>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;0,700;1,400&family=DM+Sans:opsz,wght@9..40,300;9..40,400;9..40,500;9..40,600&family=Playfair+Display:wght@700;800&family=Raleway:wght@400;500;600;700&family=Josefin+Sans:wght@300;400;600;700&family=Lora:ital,wght@0,400;0,600;1,400&family=Nunito:wght@400;600;700&family=Poppins:wght@300;400;500;600;700&family=Outfit:wght@300;400;500;600&family=Merriweather:ital,wght@0,300;0,400;0,700&family=EB+Garamond:ital,wght@0,400;0,600;1,400&family=Libre+Baskerville:wght@400;700&family=Jost:wght@300;400;500;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<script>if(window.pdfjsLib)pdfjsLib.GlobalWorkerOptions.workerSrc='https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';</script>
<style>
:root{
  --cream:#0d1421;--beige:#121a29;--sand:#1c2836;--caramel:#caa46a;--amber:#b78a53;
  --brown:#a6b3c8;--dark:#e9eef5;--gold:#e0b980;--rust:#9a7a52;--sage:#7b8d74;
  --white:#111a28;--sw:rgba(5,8,12,.55);--sd:rgba(0,0,0,.45);
  --gh:linear-gradient(135deg,#0a0f18 0%,#121a29 45%,#1d2a40 100%);
}
*{margin:0;padding:0;box-sizing:border-box}
html{scroll-behavior:smooth}
body{font-family:"DM Sans",sans-serif;background:var(--cream);color:var(--dark);min-height:100vh;overflow-x:hidden}
.screen{display:none}.screen.active{display:flex;flex-direction:column;min-height:100vh}
#toast{position:fixed;bottom:80px;left:50%;transform:translateX(-50%) translateY(14px);background:var(--beige);color:var(--dark);padding:10px 22px;border-radius:50px;font-size:13px;font-weight:600;opacity:0;transition:all .3s;z-index:9999;pointer-events:none;white-space:nowrap}
#toast.show{opacity:1;transform:translateX(-50%) translateY(0)}
@keyframes slideUp{from{opacity:0;transform:translateY(22px)}to{opacity:1;transform:translateY(0)}}
@keyframes pulse{0%,100%{box-shadow:0 0 0 0 rgba(196,149,106,.45)}50%{box-shadow:0 0 0 11px rgba(196,149,106,0)}}
@keyframes blink{0%,80%,100%{transform:scale(0)}40%{transform:scale(1)}}
/* AUTH â€” Light Theme Login */
#authScreen{background:linear-gradient(135deg,#0a0f18 0%,#111d30 40%,#1a2a44 100%);background-size:cover;position:relative}
#authScreen::before{content:'';position:absolute;inset:0;background:radial-gradient(ellipse at 50% 20%,rgba(202,164,106,.08),transparent 60%)}
.auth-nav{display:flex;align-items:center;justify-content:space-between;padding:18px 36px;position:relative;z-index:2}
.brand{font-family:"Cormorant Garamond",serif;font-size:32px;font-weight:700;color:var(--gold)}.brand em{color:var(--caramel);font-style:normal}
.anb{padding:7px 15px;border-radius:8px;font-size:12px;font-weight:700;cursor:pointer;border:1.5px solid;font-family:"DM Sans",sans-serif;transition:.2s}
.anb.ol{background:transparent;border-color:rgba(202,164,106,.4);color:#e0b980}.anb.ol:hover{border-color:#e0b980;background:rgba(202,164,106,.12)}
.anb.sd{background:linear-gradient(135deg,#caa46a,#b78a53);border-color:#caa46a;color:#fff}.anb.sd:hover{background:linear-gradient(135deg,#b78a53,#a07040)}
.auth-hero{flex:1;display:flex;align-items:center;justify-content:center;padding:20px 16px;position:relative;z-index:2}
.auth-card{background:#fffdf8;backdrop-filter:blur(20px);border-radius:22px;padding:34px 30px;width:100%;max-width:480px;box-shadow:0 36px 72px rgba(0,0,0,.28),0 0 0 1px rgba(202,164,106,.15);animation:slideUp .55s cubic-bezier(.16,1,.3,1)}
.auth-logo{text-align:center;margin-bottom:18px}
.auth-logo h1{font-family:"Cormorant Garamond",serif;font-size:38px;font-weight:700;color:#1a1a2e}.auth-logo h1 em{color:#caa46a;font-style:normal}
.auth-logo p{font-size:12px;color:#6a6a7a;font-style:italic;margin-top:2px}
.atabs{display:flex;background:#f0e8d8;border-radius:10px;padding:3px;margin-bottom:18px;gap:2px}
.atab{flex:1;padding:7px 4px;border:none;background:transparent;border-radius:8px;font-family:"DM Sans",sans-serif;font-size:11px;font-weight:700;color:#7a6a55;cursor:pointer;transition:.2s}
.atab.on{background:#1a1a2e;color:#e0b980}
.af{display:none}.af.on{display:block}
.utype-g{display:grid;grid-template-columns:repeat(3,1fr);gap:7px;margin-bottom:12px}
.utype{border:1.5px solid #e0d8c8;border-radius:9px;padding:10px 5px;cursor:pointer;text-align:center;transition:.2s;background:#fff}
.utype:hover,.utype.sel{border-color:#caa46a;background:rgba(202,164,106,.06)}
.utype i{font-size:18px;color:#caa46a;display:block;margin-bottom:4px}.utype span{font-size:10px;font-weight:700;color:#2a2a3a}
.lbl{display:block;font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.6px;color:#7a6a55;margin-bottom:5px}
.inp{width:100%;padding:10px 12px;border:1.5px solid #e0d8c8;border-radius:8px;font-family:"DM Sans",sans-serif;font-size:13px;background:#faf6ef;color:#2a2a3a;outline:none;transition:.2s;margin-bottom:10px}
.inp:focus{border-color:#caa46a;box-shadow:0 0 0 3px rgba(202,164,106,.12)}.inp::placeholder{color:#b0a590}
.inp-row{display:grid;grid-template-columns:1fr 1fr;gap:9px}
.btn-p{width:100%;padding:12px;background:linear-gradient(135deg,#1a1f30,#0d1421);color:#e0b980;border:none;border-radius:11px;font-family:"DM Sans",sans-serif;font-size:14px;font-weight:700;cursor:pointer;transition:.2s;box-shadow:0 4px 16px rgba(0,0,0,.2)}
.btn-p:hover{transform:translateY(-1px);box-shadow:0 8px 24px rgba(0,0,0,.28)}
.guest-l{text-align:center;margin-top:10px;font-size:12px;color:#7a6a55}
.guest-l a{color:#b78a53;font-weight:700;cursor:pointer;text-decoration:none}
.oauth-btn{padding:9px 12px;border:1.5px solid #e0d8c8;border-radius:8px;background:#fff;cursor:pointer;font-family:"DM Sans",sans-serif;font-size:11px;font-weight:700;color:#2a2a3a;display:flex;align-items:center;justify-content:center;gap:7px;transition:.2s;width:100%}
.oauth-btn:hover{border-color:#caa46a;background:rgba(202,164,106,.05);transform:translateY(-1px)}
/* HEADER */
.app-hdr{background:var(--beige);height:56px;display:flex;align-items:center;justify-content:space-between;padding:0 16px;position:sticky;top:0;z-index:200;box-shadow:0 3px 20px var(--sd);flex-shrink:0}
.hd-left{display:flex;align-items:center;gap:8px}
.hd-mid{display:flex;align-items:center;gap:7px}
.hd-r{display:flex;align-items:center;gap:5px;flex-wrap:wrap}
.hbtn{padding:5px 10px;border-radius:7px;font-family:"DM Sans",sans-serif;font-size:11px;font-weight:700;cursor:pointer;transition:.2s;border:1.5px solid transparent;display:inline-flex;align-items:center;gap:4px;white-space:nowrap}
.mbtn{display:none;background:rgba(255,255,255,.08);border-color:rgba(255,255,255,.08);color:var(--dark)}
.mbtn:hover{background:rgba(255,255,255,.16)}
.hbtn.ol{background:transparent;border-color:rgba(196,149,106,.38);color:var(--caramel)}.hbtn.ol:hover{border-color:var(--caramel);background:rgba(196,149,106,.09)}
.hbtn.gd{background:var(--caramel);color:#fff;border-color:var(--caramel)}.hbtn.gd:hover{background:var(--amber)}
.hbtn.dg{background:transparent;border-color:rgba(192,96,58,.3);color:var(--rust)}.hbtn.dg:hover{background:rgba(192,96,58,.09)}
.av{width:27px;height:27px;border-radius:50%;background:var(--beige);display:flex;align-items:center;justify-content:center;font-weight:700;font-size:10px;color:var(--dark);border:2px solid var(--caramel);cursor:pointer;flex-shrink:0}
.sbadge{padding:2px 8px;border-radius:20px;font-size:9px;font-weight:700;text-transform:uppercase}
.sbadge.free{background:rgba(124,78,46,.15);color:var(--brown)}.sbadge.pro{background:rgba(212,168,83,.2);color:var(--amber)}.sbadge.premium{background:linear-gradient(135deg,rgba(212,168,83,.3),rgba(196,149,106,.3));color:var(--amber)}
.sdd{position:relative;display:inline-block}
.sdd-m{position:absolute;top:calc(100% + 4px);right:0;background:var(--white);border:1.5px solid var(--sand);border-radius:9px;box-shadow:0 9px 28px var(--sw);min-width:180px;overflow:hidden;z-index:300;display:none}
.sdd.on .sdd-m{display:block;animation:slideUp .2s ease}
.sdd-i{padding:9px 13px;font-size:12px;font-weight:600;color:var(--dark);cursor:pointer;display:flex;align-items:center;gap:7px;transition:.2s}
.sdd-i:hover{background:var(--beige);color:var(--caramel)}.sdd-i i{color:var(--caramel);width:13px}
/* LAYOUT */
/* â•â•â• RESIZABLE SPLIT â•â•â• */
:root { --sb-w: 310px; }
.app-body  { display:flex; flex:1; overflow:hidden; height:calc(100vh - 100px); position:relative; }
.sidebar   { width:var(--sb-w); flex-shrink:0; background:var(--white); border-right:1px solid var(--sand);
             display:flex; flex-direction:row; height:100%; transition:width .18s ease; min-width:0; overflow:hidden; }
.sb-content::-webkit-scrollbar{width:3px}.sb-content::-webkit-scrollbar-thumb{background:var(--sand)}
.preview-area { flex:1; background:var(--beige); overflow-y:auto; padding:14px; min-width:0; }
.preview-area::-webkit-scrollbar{width:5px}.preview-area::-webkit-scrollbar-thumb{background:var(--sand);border-radius:3px}

/* drag handle */
.drag-h { width:6px; background:var(--sand); cursor:col-resize; flex-shrink:0; z-index:20;
          display:flex; align-items:center; justify-content:center; transition:background .2s; }
.drag-h:hover,.drag-h.active { background:var(--caramel); }
.drag-h::after { content:"â‹®â‹®"; font-size:9px; color:var(--brown); line-height:1; letter-spacing:-1px; }

/* mobile layout */
.sb-overlay{display:none}
@media (max-width: 980px){
  .mbtn{display:inline-flex}
  .hd-mid{display:none}
  .app-body{height:calc(100vh - 56px)}
  .sidebar{position:fixed;top:56px;left:0;height:calc(100vh - 56px);z-index:300;transform:translateX(-110%);transition:transform .25s cubic-bezier(.4,0,.2,1);width:86vw;max-width:360px;box-shadow:0 10px 30px rgba(0,0,0,.25)}
  .drag-h{display:none}
  #appScreen.sb-open .sidebar{transform:translateX(0)}
  #appScreen.sb-open .sb-overlay{display:block;position:fixed;top:56px;left:0;right:0;bottom:0;background:rgba(0,0,0,.45);z-index:250;backdrop-filter:blur(2px)}
  #appScreen.preview-only .sidebar{display:none}
  #appScreen.form-only .preview-area{display:none}
  #appScreen.preview-only .preview-area{display:block}
  /* Remove resize buttons on tablets too */
  .rsz-bar{display:none}
  .r-frame{min-height:auto}
}

/* quick actions */
#quickActions{position:fixed;right:16px;bottom:18px;z-index:600}
.qa-fab{width:44px;height:44px;border-radius:50%;border:none;background:var(--caramel);color:#fff;font-size:16px;cursor:pointer;box-shadow:0 10px 20px rgba(0,0,0,.2)}
.qa-panel{position:absolute;right:0;bottom:52px;background:var(--white);border:1.5px solid var(--sand);border-radius:12px;box-shadow:0 12px 28px rgba(0,0,0,.18);padding:8px;display:none;min-width:160px}
#quickActions.open .qa-panel{display:block;animation:slideUp .2s ease}
.qa-btn{width:100%;padding:8px 10px;border:none;background:transparent;text-align:left;font-size:12px;font-weight:700;color:var(--dark);cursor:pointer;border-radius:8px}
.qa-btn:hover{background:var(--beige);color:var(--caramel)}

/* â•â•â• GUIDED TOUR â€” REBUILT â•â•â• */
.tour-backdrop{position:fixed;inset:0;background:rgba(2,6,14,.78);z-index:5000;display:none;opacity:0;transition:opacity .3s}
.tour-backdrop.active{display:block;opacity:1}
.tour-spotlight{position:fixed;z-index:5005;border-radius:12px;box-shadow:0 0 0 9999px rgba(2,6,14,.78);transition:all .4s cubic-bezier(.4,0,.2,1);pointer-events:none}
.tour-spotlight::after{content:'';position:absolute;inset:-4px;border:2.5px solid var(--gold);border-radius:14px;animation:tourPulse 1.8s ease-in-out infinite}
@keyframes tourPulse{0%,100%{box-shadow:0 0 0 0 rgba(224,185,128,.5)}50%{box-shadow:0 0 0 10px rgba(224,185,128,0)}}
.tour-dialog{position:fixed;z-index:5010;width:380px;max-width:calc(100vw - 32px);background:linear-gradient(145deg,#fdf6ec 0%,#fff9f0 100%);border-radius:18px;padding:0;box-shadow:0 25px 60px rgba(0,0,0,.45),0 0 0 1px rgba(202,164,106,.3);transition:all .35s cubic-bezier(.4,0,.2,1);display:none}
.tour-dialog.show{display:block;animation:tourSlideIn .35s cubic-bezier(.16,1,.3,1)}
@keyframes tourSlideIn{from{opacity:0;transform:translateY(18px) scale(.96)}to{opacity:1;transform:translateY(0) scale(1)}}
.tour-dialog-hd{padding:18px 20px 0;display:flex;align-items:center;gap:12px}
.tour-dialog-ico{width:42px;height:42px;border-radius:12px;background:linear-gradient(135deg,#1a1f30,#0d1421);display:flex;align-items:center;justify-content:center;font-size:18px;color:var(--gold);flex-shrink:0;box-shadow:0 4px 12px rgba(0,0,0,.2)}
.tour-dialog-step{font-size:10px;font-weight:800;text-transform:uppercase;letter-spacing:1.2px;color:#9a7a52;margin-bottom:2px}
.tour-dialog-title{font-family:"Cormorant Garamond",serif;font-size:20px;font-weight:700;color:#1a1a2e;line-height:1.2}
.tour-dialog-body{padding:14px 20px;font-size:13px;color:#4a4a5a;line-height:1.6}
.tour-dialog-progress{margin:0 20px;height:4px;background:#e8e0d4;border-radius:4px;overflow:hidden}
.tour-dialog-progress-fill{height:100%;background:linear-gradient(90deg,#caa46a,#e0b980);border-radius:4px;transition:width .4s ease}
.tour-dialog-ft{padding:14px 20px 18px;display:flex;align-items:center;justify-content:space-between}
.tour-dialog-ft .t-skip{background:none;border:none;font-size:12px;color:#888;cursor:pointer;font-family:"DM Sans",sans-serif;font-weight:600;transition:.2s;padding:6px 10px;border-radius:8px}
.tour-dialog-ft .t-skip:hover{color:#1a1a2e;background:rgba(0,0,0,.05)}
.tour-dialog-ft .t-btns{display:flex;gap:8px}
.tour-dialog-ft .t-back{padding:8px 16px;border-radius:10px;border:1.5px solid #d6cfc4;background:#fff;color:#555;font-size:12px;font-weight:700;cursor:pointer;font-family:"DM Sans",sans-serif;transition:.2s}
.tour-dialog-ft .t-back:hover{border-color:#caa46a;color:#caa46a}
.tour-dialog-ft .t-back:disabled{opacity:.35;pointer-events:none}
.tour-dialog-ft .t-next{padding:8px 20px;border-radius:10px;border:none;background:linear-gradient(135deg,#1a1f30,#0d1421);color:#e0b980;font-size:12px;font-weight:700;cursor:pointer;font-family:"DM Sans",sans-serif;transition:.2s;box-shadow:0 4px 14px rgba(0,0,0,.25)}
.tour-dialog-ft .t-next:hover{transform:translateY(-1px);box-shadow:0 6px 18px rgba(0,0,0,.3)}
/* tour btn in header */
.hbtn.tour-btn{background:rgba(202,164,106,.12);border-color:rgba(202,164,106,.4);color:var(--gold)}
.hbtn.tour-btn:hover{background:rgba(202,164,106,.22);border-color:var(--gold)}
/* tooltip system */
[data-tooltip]{position:relative}
[data-tooltip]::before{content:attr(data-tooltip);position:absolute;bottom:calc(100% + 8px);left:50%;transform:translateX(-50%) translateY(4px);background:#111a28;color:#e0b980;font-size:10px;font-weight:700;padding:5px 10px;border-radius:7px;white-space:nowrap;opacity:0;pointer-events:none;transition:all .2s ease;z-index:9000;box-shadow:0 4px 12px rgba(0,0,0,.3);border:1px solid rgba(202,164,106,.25)}
[data-tooltip]::after{content:'';position:absolute;bottom:calc(100% + 3px);left:50%;transform:translateX(-50%);border:5px solid transparent;border-top-color:#111a28;opacity:0;pointer-events:none;transition:all .2s ease;z-index:9001}
[data-tooltip]:hover::before,[data-tooltip]:hover::after{opacity:1;transform:translateX(-50%) translateY(0)}
[data-tooltip]:hover::after{transform:translateX(-50%)}
@media(max-width:980px){.tour-dialog{width:calc(100vw - 24px);bottom:12px!important;left:12px!important;top:auto!important;right:auto!important}}
@media(max-width:768px){.tour-dialog{bottom:66px!important}}

/* resize buttons */
.rsz-bar { display:flex; gap:4px; align-items:center; }
.rsz-btn { width:24px; height:24px; border:1.5px solid var(--sand); border-radius:5px; background:var(--white);
           cursor:pointer; display:flex; align-items:center; justify-content:center; font-size:9px;
           color:var(--brown); transition:.2s; }
.rsz-btn:hover { border-color:var(--caramel); color:var(--caramel); background:rgba(196,149,106,.07); }
.rsz-btn.active { background:var(--beige); color:var(--dark); border-color:var(--beige); }

/* â•â•â• PHOTO UPLOAD â•â•â• */
.photo-uparea { display:flex; align-items:center; gap:12px; background:var(--beige); border-radius:10px;
                padding:11px; margin-bottom:12px; border:1.5px solid var(--sand); }
.photo-ring   { width:64px; height:64px; border-radius:50%; border:3px solid var(--caramel);
                background:var(--sand); overflow:hidden; flex-shrink:0; cursor:pointer;
                display:flex; align-items:center; justify-content:center; font-size:24px;
                transition:.25s; position:relative; }
.photo-ring:hover::after { content:"ðŸ“·"; position:absolute; inset:0; display:flex; align-items:center;
                           justify-content:center; background:rgba(61,35,20,.5); border-radius:50%; font-size:20px; }
.photo-ring img { width:100%; height:100%; object-fit:cover; display:block; }
.photo-meta { flex:1; }
.photo-meta .fl { margin-bottom:3px; }
.photo-meta p { font-size:10px; color:var(--brown); line-height:1.4; margin-bottom:7px; }
.photo-btns { display:flex; gap:5px; }
.pbtn { padding:4px 11px; border-radius:6px; font-family:"DM Sans",sans-serif; font-size:10px;
        font-weight:700; cursor:pointer; transition:.2s; border:1.5px solid; }
.pbtn.up { border-color:var(--caramel); color:var(--caramel); background:transparent; }
.pbtn.up:hover { background:var(--caramel); color:#fff; }
.pbtn.rm { border-color:var(--sand); color:var(--brown); background:transparent; display:none; }
.pbtn.rm:hover { border-color:var(--rust); color:var(--rust); }

/* â•â•â• PROFESSIONAL TEMPLATE GRID â•â•â• */
.tmpl-section { margin-bottom:14px; }
.tmpl-section-title { font-size:9px; font-weight:700; text-transform:uppercase; letter-spacing:.8px;
                      color:var(--brown); margin-bottom:7px; display:flex; align-items:center; gap:5px;
                      padding:0 1px; }
.tmpl-section-title::after { content:""; flex:1; height:1px; background:var(--sand); }
.tmpl-g { display:grid; grid-template-columns:repeat(2,1fr); gap:8px; }
.tt { border:2px solid var(--sand); border-radius:9px; overflow:hidden; cursor:pointer; transition:all .22s;
      background:#fff; position:relative; aspect-ratio:.707; /* A4 ratio */
      box-shadow:0 2px 8px rgba(0,0,0,.07); }
.tt:hover { border-color:var(--caramel); transform:translateY(-2px); box-shadow:0 7px 20px rgba(196,149,106,.22); }
.tt.on  { border-color:var(--amber); box-shadow:0 0 0 2px rgba(184,115,42,.3), 0 5px 16px rgba(184,115,42,.18); }
.tt-preview { width:100%; height:calc(100% - 26px); display:block; }
.tt-foot { height:26px; display:flex; align-items:center; justify-content:space-between;
           padding:0 7px; background:var(--cream); border-top:1px solid var(--sand); }
.tt-nm { font-size:8.5px; font-weight:700; color:var(--dark); white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.tt-bx { font-size:7px; font-weight:700; text-transform:uppercase; padding:1px 5px; border-radius:8px; flex-shrink:0; }
.tt-bx.free { background:rgba(122,140,110,.18); color:var(--sage); }
.tt-bx.pro  { background:rgba(212,168,83,.18);  color:var(--amber); }
.tt-bx.prem { background:linear-gradient(135deg,#D4A853,#C4956A); color:#fff; }
.tt-lock { position:absolute; inset:0; background:rgba(0,0,0,.04); display:flex;
           align-items:center; justify-content:center; }
.tt-lock span { background:rgba(0,0,0,.6); color:#fff; padding:3px 8px; border-radius:20px;
                font-size:9px; font-weight:700; }
/* filter pills */
.tf { display:flex; flex-wrap:wrap; gap:4px; margin-bottom:10px; }
.tfb { padding:3px 9px; border-radius:20px; border:1.5px solid var(--sand); background:transparent;
       font-size:10px; font-weight:700; color:var(--brown); cursor:pointer; transition:.2s; }
.tfb:hover,.tfb.on { border-color:var(--caramel); background:rgba(196,149,106,.09); color:var(--caramel); }
/* â•â•â• SIDEBAR NAV â€” PROFESSIONAL ICON RAIL â•â•â• */
.sidebar{display:flex;flex-direction:row!important;overflow:hidden!important;}
.sb-rail{width:58px;flex-shrink:0;background:var(--beige);display:flex;flex-direction:column;align-items:center;padding:10px 0;gap:2px;height:100%;overflow-y:auto;overflow-x:hidden;z-index:10;}
.sb-rail::-webkit-scrollbar{display:none}
.sb-rail-logo{font-family:"Cormorant Garamond",serif;font-size:16px;font-weight:700;color:var(--caramel);letter-spacing:-.5px;margin-bottom:10px;padding-bottom:10px;border-bottom:1px solid rgba(196,149,106,.2);text-align:center;width:100%;}
.sb-rail-sep{width:30px;height:1px;background:rgba(196,149,106,.18);margin:6px auto;}
.sb-rail-grp-lbl{font-size:7px;font-weight:800;text-transform:uppercase;letter-spacing:1.2px;color:rgba(196,149,106,.65);margin:8px 0 3px;text-align:center;width:100%;}
.st{width:46px;height:46px;border:none;background:rgba(255,255,255,.04);border-radius:10px;cursor:pointer;transition:all .18s;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:3px;position:relative;flex-shrink:0;border:1px solid transparent;}
.st i{font-size:16px;color:rgba(253,246,236,.75);transition:.2s;filter:drop-shadow(0 0 3px rgba(196,149,106,.3));}
.st span{font-size:7.5px;font-weight:800;color:rgba(253,246,236,.55);letter-spacing:.4px;transition:.2s;white-space:nowrap;text-transform:uppercase;}
.st:hover{background:rgba(196,149,106,.16);border-color:rgba(196,149,106,.28);}
.st:hover i{color:var(--caramel);filter:drop-shadow(0 0 6px rgba(196,149,106,.5));}
.st:hover span{color:rgba(196,149,106,.9);}
.st.on{background:rgba(196,149,106,.22);border-color:rgba(196,149,106,.45);box-shadow:0 0 12px rgba(196,149,106,.15);}
.st.on i{color:var(--gold);filter:drop-shadow(0 0 6px rgba(212,168,83,.55));}
.st.on span{color:var(--gold);}
.st.on::before{content:"";position:absolute;right:-1px;top:50%;transform:translateY(-50%);width:3px;height:26px;background:linear-gradient(180deg,var(--gold),var(--caramel));border-radius:2px 0 0 2px;box-shadow:0 0 6px rgba(212,168,83,.4);}
/* tooltip */
.st::after{content:attr(data-tip);position:absolute;left:calc(100% + 8px);top:50%;transform:translateY(-50%);background:var(--beige);color:var(--dark);font-size:10px;font-weight:700;padding:4px 9px;border-radius:6px;white-space:nowrap;opacity:0;pointer-events:none;transition:opacity .15s;z-index:999;border:1px solid rgba(196,149,106,.25);}
.st:hover::after{opacity:1;}
.sb-content{flex:1;overflow-y:auto;overflow-x:hidden;min-width:0;}
.sb-content::-webkit-scrollbar{width:3px}.sb-content::-webkit-scrollbar-thumb{background:var(--sand)}
.ss{padding:14px;display:none}.ss.on{display:block}
.ss-title{font-family:"Cormorant Garamond",serif;font-size:18px;font-weight:700;color:var(--dark);margin-bottom:2px}
.ss-desc{font-size:11px;color:var(--brown);margin-bottom:10px;font-style:italic}
/* FORM */
.fl{font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.5px;color:var(--brown);margin-bottom:4px;display:block}
.fr{color:var(--rust)}
.fi{width:100%;padding:9px 11px;border:1.5px solid var(--sand);border-radius:7px;font-family:"DM Sans",sans-serif;font-size:12.5px;background:var(--cream);color:var(--dark);outline:none;transition:.2s;margin-bottom:10px}
.fi:focus{border-color:var(--caramel);box-shadow:0 0 0 2px rgba(196,149,106,.09);background:var(--white)}.fi::placeholder{color:rgba(125,78,46,.32)}
.frow{display:grid;grid-template-columns:1fr 1fr;gap:8px}
textarea.fi{resize:vertical;min-height:66px}
.fsel{width:100%;padding:9px 11px;border:1.5px solid var(--sand);border-radius:7px;font-family:"DM Sans",sans-serif;font-size:12.5px;background:var(--cream);color:var(--dark);outline:none;cursor:pointer;margin-bottom:10px;appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='10' viewBox='0 0 10 10'%3E%3Cpath fill='%237D4E2E' d='M5 7L1 3h8z'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 10px center}
.fsel:focus{border-color:var(--caramel)}
.btn-a{width:100%;padding:8px;border:1.5px dashed var(--sand);border-radius:7px;background:transparent;color:var(--caramel);font-family:"DM Sans",sans-serif;font-size:11px;font-weight:700;cursor:pointer;transition:.2s;display:flex;align-items:center;justify-content:center;gap:5px;margin-top:2px}
.btn-a:hover{border-color:var(--caramel);background:rgba(196,149,106,.04)}
.ec{background:var(--cream);border:1.5px solid var(--sand);border-radius:8px;padding:10px;margin-bottom:8px;transition:.2s}
.ec:hover{border-color:var(--caramel);box-shadow:0 2px 7px var(--sw)}
.ec-h{display:flex;align-items:flex-start;justify-content:space-between}
.ec-t{font-weight:700;font-size:12px;color:var(--dark)}.ec-s{font-size:10px;color:var(--brown);margin-top:1px}
.ec-acts{display:flex;gap:3px;flex-shrink:0}
.icb{width:22px;height:22px;border:none;border-radius:5px;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:9px;transition:.2s}
.icb.ed{background:rgba(196,149,106,.14);color:var(--caramel)}.icb.ed:hover{background:var(--caramel);color:#fff}
.icb.dl{background:rgba(192,96,58,.1);color:var(--rust)}.icb.dl:hover{background:var(--rust);color:#fff}
.chip{background:var(--beige);border:1.5px solid var(--sand);border-radius:20px;padding:3px 8px;font-size:10px;font-weight:700;color:var(--dark);display:inline-flex;align-items:center;gap:3px;margin:2px;cursor:pointer;transition:.2s}
.chip:hover{border-color:var(--rust)}.chip i{font-size:7px;color:var(--rust)}
.chip-s{background:transparent;border-style:dashed;color:var(--caramel)}.chip-s:hover{background:rgba(196,149,106,.06);border-color:var(--caramel)}
.chip-grid{display:flex;flex-wrap:wrap;margin-bottom:6px}
.tog{position:relative;width:34px;height:18px;cursor:pointer;display:inline-block}
.tog input{opacity:0;width:0;height:0}
.tog-sl{position:absolute;inset:0;background:var(--sand);border-radius:18px;transition:.3s}
.tog-sl::before{content:"";position:absolute;left:3px;bottom:3px;width:12px;height:12px;border-radius:50%;background:#fff;transition:.3s}
.tog input:checked+.tog-sl{background:var(--caramel)}.tog input:checked+.tog-sl::before{transform:translateX(16px)}
.prog-w{margin-bottom:10px}
.prog-h{display:flex;justify-content:space-between;font-size:10px;font-weight:700;color:var(--dark);margin-bottom:4px}
.prog-t{height:5px;background:var(--sand);border-radius:3px;overflow:hidden}
.prog-f{height:100%;background:linear-gradient(90deg,var(--caramel),var(--gold));border-radius:3px;transition:width .5s}
.pc-chips{display:flex;flex-wrap:wrap;gap:3px;margin-top:5px}
.pcc{font-size:9px;font-weight:700;padding:2px 6px;border-radius:20px}
.pcc.d{background:rgba(122,140,110,.14);color:var(--sage)}.pcc.t{background:rgba(196,149,106,.12);color:var(--caramel)}
/* ATS */
.ats-c{background:linear-gradient(135deg,var(--beige),var(--sand));border-radius:12px;padding:14px;margin-bottom:10px;color:var(--dark)}
.ats-hd{font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:var(--caramel);margin-bottom:7px}
.ats-r{display:flex;align-items:center;gap:12px}
.ats-ring{width:64px;height:64px;border-radius:50%;display:flex;align-items:center;justify-content:center;position:relative;flex-shrink:0}
.ats-ring::before{content:"";position:absolute;inset:7px;border-radius:50%;background:var(--beige)}
.ats-n{position:relative;font-family:"Cormorant Garamond",serif;font-size:19px;font-weight:700;z-index:1}
.ats-lbl{font-family:"Cormorant Garamond",serif;font-size:15px;font-weight:700}
.ats-sub{font-size:10px;opacity:.65;margin-top:1px}
.ats-bars{margin-top:8px}
.ats-br{margin-bottom:4px}
.ats-bt{display:flex;justify-content:space-between;font-size:9px;opacity:.7;margin-bottom:2px}
.ats-btr{height:3px;background:rgba(255,255,255,.1);border-radius:2px;overflow:hidden}
.ats-bfi{height:100%;border-radius:2px;transition:width 1s}
/* SUGGESTIONS */
.sug{background:var(--white);border-left:3px solid var(--caramel);border-radius:0 7px 7px 0;padding:8px 11px;margin-bottom:7px}
.sug.w{border-color:var(--rust)}.sug.ok{border-color:var(--sage)}
.sug-t{font-weight:700;font-size:10px;text-transform:uppercase;letter-spacing:.4px;color:var(--brown);margin-bottom:2px}
.sug-txt{font-size:11px;color:var(--dark);line-height:1.5}
/* QUOTE */
.qcard{background:linear-gradient(135deg,var(--dark),var(--brown));border-radius:10px;padding:12px 14px;margin-bottom:10px;position:relative;overflow:hidden}
.qcard::before{content:"ÂC";position:absolute;top:-14px;left:4px;font-family:"Cormorant Garamond",serif;font-size:78px;color:rgba(196,149,106,.1)}
.q-txt{font-family:"Cormorant Garamond",serif;font-style:italic;font-size:13px;color:var(--dark);line-height:1.5;position:relative}
.q-by{font-size:9px;color:var(--caramel);margin-top:3px;font-weight:700;text-transform:uppercase;letter-spacing:.8px}
/* CHARTS */
.chart-g{display:grid;grid-template-columns:1fr 1fr;gap:9px;margin-bottom:10px}
.chart-c{background:var(--white);border:1.5px solid var(--sand);border-radius:9px;padding:10px;box-shadow:0 2px 7px var(--sw)}
.chart-c.full{grid-column:span 2}
.ct{font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.5px;color:var(--brown);margin-bottom:6px;display:flex;align-items:center;gap:4px}.ct i{color:var(--caramel)}
/* TEMPLATES */
.tf{display:flex;gap:4px;margin-bottom:9px;flex-wrap:wrap}
.tfb{padding:4px 9px;border-radius:20px;border:1.5px solid var(--sand);background:transparent;font-size:10px;font-weight:700;color:var(--brown);cursor:pointer;transition:.2s}
.tfb:hover,.tfb.on{border-color:var(--caramel);background:rgba(196,149,106,.08);color:var(--caramel)}
/* tmpl css moved to block above */
/* FONTS */
.font-g{display:grid;grid-template-columns:1fr 1fr;gap:4px;max-height:230px;overflow-y:auto;margin-bottom:9px}
.font-g::-webkit-scrollbar{width:3px}.font-g::-webkit-scrollbar-thumb{background:var(--sand)}
.fo{border:1.5px solid var(--sand);border-radius:6px;padding:6px 8px;cursor:pointer;transition:.2s}
.fo:hover,.fo.on{border-color:var(--caramel);background:rgba(196,149,106,.06)}.fo .fn{font-size:13px;font-weight:700;color:var(--dark)}.fo .fs{font-size:9px;color:var(--brown);margin-top:1px}
/* PALETTES */
.pal-g{display:grid;grid-template-columns:repeat(4,1fr);gap:5px;margin-bottom:10px}
.po{border:2px solid transparent;border-radius:7px;overflow:hidden;cursor:pointer;transition:.2s;height:34px;display:flex}
.po:hover,.po.on{border-color:var(--dark);transform:scale(1.06)}.po .ph{flex:1}
.cclr{display:flex;flex-direction:column;gap:7px;margin-bottom:10px}
.cc-r{display:flex;align-items:center;gap:7px;font-size:11px;font-weight:600;color:var(--dark)}.cc-r input[type=color]{width:29px;height:24px;border:none;border-radius:5px;cursor:pointer;background:transparent}
.elem-g{display:flex;flex-wrap:wrap;gap:4px;margin-bottom:9px}
.eb{width:31px;height:31px;border:1.5px solid var(--sand);border-radius:6px;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:14px;transition:.2s;background:var(--white)}.eb:hover{border-color:var(--caramel);background:rgba(196,149,106,.06)}
/* SKILLS */
.sk-ts{display:flex;gap:3px;margin-bottom:8px;background:var(--beige);border-radius:6px;padding:2px}
.sk-t{flex:1;padding:4px 5px;border:none;background:transparent;border-radius:5px;font-size:9px;font-weight:700;color:var(--brown);cursor:pointer;transition:.2s;text-align:center}
.sk-t.on{background:var(--beige);color:var(--dark)}
.sk-r{display:flex;gap:6px;align-items:flex-end;margin-bottom:8px}.sk-r .fi{margin-bottom:0;flex:1}
/* GRAMMAR */
.upz{border:2px dashed var(--sand);border-radius:10px;padding:20px;text-align:center;cursor:pointer;transition:.3s;margin-bottom:10px;background:var(--white)}
.upz:hover{border-color:var(--caramel);background:rgba(196,149,106,.03)}
.upz i{font-size:28px;color:var(--sand);display:block;margin-bottom:6px}.upz:hover i{color:var(--caramel)}
.up-t{font-weight:700;font-size:13px;color:var(--dark);margin-bottom:2px}.up-s{font-size:11px;color:var(--brown);line-height:1.4}
.gram-r{background:var(--white);border:1.5px solid var(--sand);border-radius:8px;padding:10px;margin-bottom:8px}
.gram-e{display:flex;align-items:flex-start;justify-content:space-between;padding:6px 0;border-bottom:1px solid var(--beige);font-size:11px}
.gram-e:last-child{border-bottom:none}
.gw{color:var(--rust);font-weight:700;text-decoration:line-through}.gr{color:var(--sage);font-weight:700}
.gfix{padding:2px 8px;border:1px solid var(--sage);border-radius:20px;background:transparent;color:var(--sage);font-size:9px;font-weight:700;cursor:pointer;flex-shrink:0;margin-left:6px;transition:.2s}.gfix:hover{background:var(--sage);color:#fff}
/* COURSES */
.ccard{background:var(--white);border:1.5px solid var(--sand);border-radius:8px;padding:9px;margin-bottom:6px;display:flex;align-items:center;gap:8px;cursor:pointer;transition:.2s}
.ccard:hover{border-color:var(--caramel);box-shadow:0 2px 7px var(--sw)}
.ccico{width:33px;height:33px;border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:14px;flex-shrink:0}
.ct1{font-weight:700;font-size:11px;color:var(--dark)}.cp1{font-size:10px;color:var(--brown);margin-top:1px}
/* CHINKO */
#chinkoBtn{position:fixed;bottom:20px;right:20px;width:52px;height:52px;border-radius:50%;background:var(--gh);border:none;cursor:pointer;box-shadow:0 7px 25px var(--sd);display:flex;align-items:center;justify-content:center;z-index:500;transition:.3s;animation:pulse 2.5s infinite;font-size:22px;color:var(--dark)}
#chinkoBtn:hover{transform:scale(1.08)}
#chinkoPanel{position:fixed;bottom:82px;right:20px;width:330px;background:var(--white);border-radius:16px;box-shadow:0 18px 55px var(--sd),0 0 0 1px rgba(196,149,106,.18);z-index:500;display:none;flex-direction:column;max-height:490px}
#chinkoPanel.on{display:flex;animation:slideUp .3s ease}
.ch-hd{background:var(--gh);padding:11px 13px;display:flex;align-items:center;gap:8px;border-radius:16px 16px 0 0}
.ch-av{width:34px;height:34px;border-radius:50%;background:rgba(196,149,106,.28);display:flex;align-items:center;justify-content:center;font-size:16px;border:2px solid rgba(196,149,106,.48)}
.ch-nm{font-family:"Cormorant Garamond",serif;font-size:15px;font-weight:700;color:var(--dark)}.ch-st{font-size:9px;color:var(--brown)}
.ch-cls{margin-left:auto;background:none;border:none;color:var(--dark);cursor:pointer;font-size:15px}
.ch-msgs{flex:1;overflow-y:auto;padding:11px;display:flex;flex-direction:column;gap:7px}
.ch-msgs::-webkit-scrollbar{width:3px}.ch-msgs::-webkit-scrollbar-thumb{background:var(--sand)}
.mb,.mu{max-width:88%;padding:8px 11px;border-radius:12px;font-size:12px;line-height:1.5}
.mb{background:var(--cream);border:1px solid var(--sand);border-bottom-left-radius:3px;color:var(--dark);align-self:flex-start}
.mu{background:var(--beige);color:var(--dark);border-bottom-right-radius:3px;align-self:flex-end}
.mb strong{color:var(--amber)}
.ch-qr{padding:5px 11px;display:flex;flex-wrap:wrap;gap:4px}
.qrb{padding:3px 8px;border:1.5px solid var(--sand);border-radius:20px;font-size:10px;font-weight:700;color:var(--brown);background:var(--cream);cursor:pointer;transition:.2s}
.qrb:hover{border-color:var(--caramel);color:var(--caramel)}
.ch-ir{display:flex;padding:8px 9px;gap:5px;border-top:1px solid var(--sand)}
.ch-in{flex:1;padding:7px 10px;border:1.5px solid var(--sand);border-radius:8px;font-family:"DM Sans",sans-serif;font-size:12px;outline:none;background:var(--cream);color:var(--dark)}.ch-in:focus{border-color:var(--caramel)}
.ch-snd{width:33px;height:33px;border-radius:7px;background:var(--beige);border:none;cursor:pointer;color:var(--dark);display:flex;align-items:center;justify-content:center;transition:.2s}.ch-snd:hover{background:var(--sand)}
.tdot{display:inline-block;width:5px;height:5px;border-radius:50%;background:var(--caramel);animation:blink 1.2s infinite ease-in-out both;margin:0 2px}
.tdot:nth-child(2){animation-delay:.16s}.tdot:nth-child(3){animation-delay:.32s}
/* PREVIEW */
.prev-h{display:flex;align-items:center;justify-content:space-between;margin-bottom:11px}
.prev-t{font-family:"Cormorant Garamond",serif;font-size:18px;font-weight:700;color:var(--dark)}.prev-a{display:flex;gap:6px}
.bdl{padding:7px 13px;background:var(--beige);color:var(--dark);border:none;border-radius:7px;font-family:"DM Sans",sans-serif;font-size:11px;font-weight:700;cursor:pointer;transition:.2s;display:inline-flex;align-items:center;gap:5px;box-shadow:0 2px 8px var(--sw)}.bdl:hover{background:var(--sand);transform:translateY(-1px)}
.bdl.out{background:transparent;border:1.5px solid var(--sand);color:var(--dark);box-shadow:none}.bdl.out:hover{border-color:var(--caramel)}
.r-frame{background:#fff;border-radius:8px;box-shadow:0 18px 55px var(--sd);overflow:hidden;min-height:760px;transition:all .4s}
/* FOOTER */
.app-ft{background:var(--beige);padding:8px 18px;display:flex;align-items:center;justify-content:space-between;height:44px;border-top:1px solid rgba(196,149,106,.18);flex-shrink:0}
.ft-l{font-size:10px;color:rgba(253,246,236,.38);font-family:"Cormorant Garamond",serif;font-style:italic}.ft-l em{color:var(--caramel);font-style:normal}
.ft-r{display:flex;gap:10px}
.ft-lnk{font-size:10px;color:rgba(253,246,236,.3);cursor:pointer;transition:.2s;background:none;border:none;font-family:"DM Sans",sans-serif}.ft-lnk:hover{color:var(--caramel)}
/* MODAL */
.modal{position:fixed;inset:0;background:rgba(61,35,20,.52);backdrop-filter:blur(5px);display:none;align-items:center;justify-content:center;z-index:800;padding:14px}.modal.on{display:flex}
.mbox{background:var(--white);border-radius:16px;padding:24px;width:100%;max-width:500px;box-shadow:0 28px 72px var(--sd);animation:slideUp .3s ease;position:relative;max-height:85vh;overflow-y:auto}
.mbox::-webkit-scrollbar{width:3px}.mbox::-webkit-scrollbar-thumb{background:var(--sand)}
.mt{font-family:"Cormorant Garamond",serif;font-size:22px;font-weight:700;color:var(--dark);margin-bottom:15px;padding-left:28px}
.mb-k{position:absolute;top:15px;left:13px;background:none;border:none;color:var(--brown);cursor:pointer;font-size:15px;padding:3px 7px;border-radius:6px;transition:.2s}.mb-k:hover{background:var(--beige)}
.mac{display:flex;gap:7px;margin-top:16px;justify-content:flex-end}
.mcl{padding:8px 15px;border:1.5px solid var(--sand);border-radius:8px;background:transparent;color:var(--brown);font-family:"DM Sans",sans-serif;font-size:12px;cursor:pointer}
.msv{padding:8px 19px;border:none;border-radius:8px;background:var(--beige);color:var(--dark);font-family:"DM Sans",sans-serif;font-size:12px;font-weight:700;cursor:pointer}
/* RECRUITER */
.rec-body{display:grid;grid-template-columns:244px 1fr;flex:1;overflow:hidden;height:calc(100vh - 100px)}
.rec-sb{background:var(--white);border-right:1px solid var(--sand);padding:15px;overflow-y:auto}
.rec-m{padding:18px;background:var(--cream);overflow-y:auto}
.a-card{background:var(--white);border-radius:12px;padding:15px;margin-bottom:12px;box-shadow:0 2px 9px var(--sw)}
.a-t{font-family:"Cormorant Garamond",serif;font-size:19px;font-weight:700;color:var(--dark);margin-bottom:2px}
.a-s{font-size:11px;color:var(--brown);margin-bottom:12px}
.str-b{display:flex;align-items:center;gap:7px;margin-bottom:5px}
.str-l{width:95px;font-weight:600;flex-shrink:0;font-size:10px;color:var(--dark)}
.str-tr{flex:1;height:7px;background:var(--beige);border-radius:4px;overflow:hidden}
.str-fi{height:100%;border-radius:4px;transition:width 1s ease}
.rec-up{border:2px dashed var(--sand);border-radius:10px;padding:24px;text-align:center;cursor:pointer;transition:.3s;margin-bottom:12px}.rec-up:hover{border-color:var(--caramel);background:rgba(196,149,106,.03)}
/* SUBSCRIPTION */
.sub-hero{background:var(--gh);padding:44px 36px;text-align:center;position:relative;flex-shrink:0}
.sub-hero::before{content:"";position:absolute;inset:0;background:radial-gradient(ellipse at 50% 80%,rgba(196,149,106,.18),transparent 58%)}
.sub-hero h1{font-family:"Cormorant Garamond",serif;font-size:44px;font-weight:700;color:var(--dark);margin-bottom:6px;position:relative}
.sub-hero p{font-size:14px;color:rgba(253,246,236,.68);position:relative}
.plans-g{display:grid;grid-template-columns:repeat(3,1fr);gap:16px;padding:30px;max-width:1010px;margin:0 auto;width:100%}
.plan-c{background:var(--white);border-radius:16px;padding:22px;border:2px solid var(--sand);transition:.3s;position:relative}
.plan-c:hover{transform:translateY(-3px);box-shadow:0 16px 44px var(--sw)}.plan-c.pop{border-color:var(--caramel);box-shadow:0 7px 30px var(--sw)}
.plan-bg{position:absolute;top:11px;right:11px;background:var(--caramel);color:#fff;font-size:9px;font-weight:700;padding:2px 8px;border-radius:20px;text-transform:uppercase}
.plan-nm{font-family:"Cormorant Garamond",serif;font-size:24px;font-weight:700;color:var(--dark);margin-bottom:2px}
.plan-pr{font-family:"Cormorant Garamond",serif;font-size:38px;font-weight:700;color:var(--dark);margin-bottom:2px}
.plan-pr span{font-size:13px;color:var(--brown);font-weight:400}.plan-dc{font-size:12px;color:var(--brown);margin-bottom:15px;line-height:1.5}
.plan-fs{list-style:none;margin-bottom:17px}
.plan-fs li{display:flex;align-items:center;gap:6px;font-size:12px;color:var(--dark);padding:3px 0}
.plan-fs li i{width:13px;text-align:center}.plan-fs li.inc i{color:var(--sage)}.plan-fs li.exc{color:var(--sand)}.plan-fs li.exc i{color:var(--sand)}
.plan-btn{width:100%;padding:11px;border:none;border-radius:10px;font-family:"DM Sans",sans-serif;font-size:13px;font-weight:700;cursor:pointer;transition:.2s}
.plan-btn.fb{background:var(--beige);color:var(--dark)}.plan-btn.pb{background:var(--caramel);color:#fff}.plan-btn.pb:hover{background:var(--amber)}.plan-btn.prb{background:var(--gh);color:#fff}
/* VISUALIZATION */
.viz-b{padding:22px;max-width:1240px;margin:0 auto;width:100%;flex:1;overflow-y:auto}
.viz-t{font-family:"Cormorant Garamond",serif;font-size:36px;font-weight:700;color:var(--dark);margin-bottom:4px}
.viz-s{font-size:13px;color:var(--brown);margin-bottom:20px}
.viz-g{display:grid;grid-template-columns:repeat(3,1fr);gap:15px;margin-bottom:17px}
.vc{background:var(--white);border-radius:12px;padding:15px;box-shadow:0 3px 13px var(--sw);border:1.5px solid var(--sand)}
.vc.wide{grid-column:span 2}.vc.tall{grid-row:span 2}
.vc-t{font-family:"Cormorant Garamond",serif;font-size:16px;font-weight:700;color:var(--dark);margin-bottom:10px;display:flex;align-items:center;gap:6px}.vc-t i{color:var(--caramel)}
.vn{font-family:"Cormorant Garamond",serif;font-size:46px;font-weight:700;text-align:center;display:block}
.vl{font-size:10px;color:var(--brown);font-weight:600;text-transform:uppercase;letter-spacing:.5px;text-align:center;display:block}
.vbar{height:5px;background:var(--beige);border-radius:3px;margin-top:6px;overflow:hidden}
.vfi{height:100%;border-radius:3px;background:linear-gradient(90deg,var(--caramel),var(--gold));transition:width 1.5s ease}
.sc-r{display:flex;align-items:center;gap:8px;margin-bottom:6px}
.sc-l{font-size:10px;font-weight:700;width:88px;color:var(--dark);flex-shrink:0}
.sc-tr{flex:1;height:7px;background:var(--beige);border-radius:4px;overflow:hidden}
.sc-fi{height:100%;border-radius:4px;transition:width 1.5s ease}
.sc-p{font-size:10px;font-weight:700;color:var(--brown);width:27px;text-align:right;flex-shrink:0}
/* â•â•â• MOBILE BOTTOM NAV â•â•â• */
.mob-nav{display:none;position:fixed;bottom:0;left:0;right:0;z-index:500;background:var(--beige);border-top:1px solid rgba(202,164,106,.2);padding:4px 0 env(safe-area-inset-bottom,4px);box-shadow:0 -4px 20px rgba(0,0,0,.15)}
.mob-nav-btn{flex:1;display:flex;flex-direction:column;align-items:center;gap:2px;padding:6px 4px;background:none;border:none;cursor:pointer;color:rgba(253,246,236,.45);font-family:"DM Sans",sans-serif;transition:.2s}
.mob-nav-btn i{font-size:16px;transition:.2s}
.mob-nav-btn span{font-size:8px;font-weight:700;text-transform:uppercase;letter-spacing:.5px}
.mob-nav-btn.active{color:var(--gold)}
.mob-nav-btn.active i{transform:translateY(-2px)}
.mob-nav-btn:active{transform:scale(.92);opacity:.7}
body.light-theme .mob-nav{background:#f0ebe2;border-color:#e0d8c8;box-shadow:0 -4px 20px rgba(0,0,0,.08)}
body.light-theme .mob-nav-btn{color:#9a8a72}
body.light-theme .mob-nav-btn.active{color:#b78a53}

/* â•â•â• RESPONSIVE â€” COMPLETE MOBILE OVERHAUL â•â•â• */

/* â”€â”€ Tablet â‰¤ 980px â”€â”€ */
/* (slide-in sidebar already handled above) */

/* â”€â”€ Small tablet / large phone â‰¤ 768px â”€â”€ */
@media(max-width:768px){
  /* â”€â”€ MOBILE BOTTOM NAV â€” show it â”€â”€ */
  .mob-nav{display:flex!important}

  /* â”€â”€ Header â€” slim, icon-only â”€â”€ */
  .app-hdr{padding:0 10px;height:48px;gap:4px}
  .hd-left{gap:4px}
  .hd-left .brand{font-size:14px;letter-spacing:-.5px}
  .hd-left .brand em{font-size:14px}
  .hd-left .mbtn{display:none!important}/* replaced by bottom nav */
  .hd-mid{display:none!important}
  .hd-r{gap:3px}
  /* Make all header buttons icon-only */
  .hd-r .hbtn{padding:5px 8px;font-size:0;gap:0}
  .hd-r .hbtn i{font-size:12px}
  .hd-r .hbtn.undo-redo{padding:4px 7px}
  .hd-r .hbtn.undo-redo i{font-size:11px}
  /* Hide buttons duplicated in bottom nav */
  .hd-r .hbtn.ol[onclick*="autoSave"],
  #saveDD,.hd-r .hbtn.tour-btn,
  .hd-r .hbtn.ol[onclick*="subScreen"],
  .hd-r .hbtn.ol[onclick*="goViz"]{display:none!important}
  .theme-toggle{width:34px;height:18px}
  .theme-toggle::after{width:13px;height:13px;font-size:7px}
  body.light-theme .theme-toggle::after{left:calc(100% - 15px)}
  .av{width:24px;height:24px;font-size:8px;border-width:1.5px}

  /* â”€â”€ Layout â€” account for bottom nav (54px) â”€â”€ */
  .app-body{flex-direction:row!important;height:calc(100vh - 48px - 54px)!important}
  .sidebar{position:fixed!important;top:48px!important;left:0;height:calc(100vh - 48px - 54px)!important;z-index:300;
           transform:translateX(-110%);transition:transform .25s cubic-bezier(.4,0,.2,1);
           width:88vw!important;max-width:380px!important;
           box-shadow:0 10px 40px rgba(0,0,0,.35)!important;flex-direction:row!important}
  #appScreen.sb-open .sidebar{transform:translateX(0)!important}
  #appScreen.sb-open .sb-overlay{top:48px!important;bottom:54px!important}
  .drag-h{display:none!important}
  .sb-rail{width:52px!important;flex-direction:column!important;overflow-y:auto!important;overflow-x:hidden!important;
           padding:8px 0!important;height:100%!important}
  .sb-rail-grp-lbl,.sb-rail-sep{display:block!important}
  .sb-content{flex:1;overflow-y:auto;padding:12px 10px!important}
  .st{width:40px;height:40px}
  .st i{font-size:14px}
  .st-lbl{font-size:6px}

  /* â”€â”€ Preview area â”€â”€ */
  .preview-area{padding:10px!important}
  .prev-h{flex-direction:column;gap:8px;align-items:stretch}
  .rsz-bar{display:none!important}
  .prev-t{font-size:16px}
  .prev-a{width:100%;display:flex;gap:6px}
  .prev-a .bdl{flex:1;justify-content:center;font-size:10px;padding:6px 8px}
  .r-frame{min-height:auto!important;border-radius:6px;overflow:visible}
  /* Scale the A4 resume to fit screen */
  #resumeDoc{transform-origin:top left;width:793.7px;transform:scale(calc((100vw - 20px) / 793.7));margin-bottom:-350px}

  /* â”€â”€ Form-only / Preview-only toggle â”€â”€ */
  #appScreen.form-only .preview-area{display:none!important}
  #appScreen.preview-only .sidebar{display:none!important}
  #appScreen.preview-only .preview-area{display:block!important}

  /* â”€â”€ Footer â€” hide on mobile (replaced by bottom nav) â”€â”€ */
  .app-ft{display:none!important}

  /* â”€â”€ Quick actions â€” position above bottom nav â”€â”€ */
  .qa-fab{width:48px;height:48px;font-size:17px}
  #quickActions{right:12px;bottom:62px}
  .qa-panel{min-width:175px}

  /* â”€â”€ Keyboard hint â€” hide on mobile â”€â”€ */
  .kb-hint{display:none!important}

  /* â”€â”€ Command palette â€” full width â”€â”€ */
  #cmdPalette .cmd-modal{width:calc(100vw - 24px)!important;max-height:70vh}

  /* â”€â”€ Forms inside sidebar â”€â”€ */
  .ph-grid{grid-template-columns:1fr 1fr!important}
  .tmpl-g{grid-template-columns:repeat(2,1fr)!important}
  .frow{flex-direction:column!important;gap:0!important}
  .frow>div{width:100%!important}

  /* â”€â”€ Tooltips â€” disable on touch â”€â”€ */
  [data-tooltip]::before,[data-tooltip]::after{display:none!important}

  /* â”€â”€ Plans grid â”€â”€ */
  .plans-g{grid-template-columns:1fr!important;padding:16px}

  /* â”€â”€ Analytics / Viz â”€â”€ */
  .viz-g{grid-template-columns:1fr!important}
  .vc.wide,.vc.tall{grid-column:span 1!important;grid-row:span 1!important}
  .viz-b{padding:12px}

  /* â”€â”€ Recruiter â”€â”€ */
  .rec-body{grid-template-columns:1fr!important;height:auto!important}

  /* â”€â”€ ATS / Chinko Panel â”€â”€ */
  #chinkoPanel{width:calc(100vw - 16px)!important;right:8px!important;left:8px!important;max-height:70vh;overflow-y:auto}
  #chinkoBtn{bottom:70px!important}

  /* â”€â”€ Resume dropdown â”€â”€ */
  .resume-dd-menu{position:fixed!important;top:48px!important;left:8px!important;right:8px!important;width:auto!important;min-width:auto!important;max-height:55vh;overflow-y:auto}

  /* â”€â”€ Tour dialog â”€â”€ */
  .tour-dialog{width:calc(100vw - 24px)!important;max-width:none!important}

  /* â”€â”€ Charts in sidebar â”€â”€ */
  .chart-g{grid-template-columns:1fr!important}
  .chart-c.full{grid-column:span 1!important}

  /* â”€â”€ Confetti canvas â”€â”€ */
  #confettiCanvas{pointer-events:none}

  /* â”€â”€ Auth nav on mobile â”€â”€ */
  .auth-nav{padding:0 12px;height:50px}
  .auth-nav .brand{font-size:18px}

  /* â”€â”€ Modal â”€â”€ */
  .mbox{padding:18px;max-width:calc(100vw - 20px);border-radius:12px}

  /* â”€â”€ Sub-hero sections â”€â”€ */
  .sub-hero h1{font-size:22px!important}
  .sub-hero p{font-size:12px!important}
}

/* â”€â”€ Phone â‰¤ 480px â”€â”€ */
@media(max-width:480px){
  .app-hdr{padding:0 6px;height:46px}
  .hd-left .brand{font-size:13px}
  .hd-left .brand em{font-size:13px}
  /* Keep only: undo, redo, theme, avatar, logout */
  .hd-r .hbtn.undo-redo{padding:4px 6px}
  .hd-r .hbtn.dg i{font-size:10px}
  .av{width:22px;height:22px;font-size:7px;border-width:1.5px}
  .theme-toggle{width:28px;height:15px}
  .theme-toggle::after{width:10px;height:10px;font-size:5px}
  body.light-theme .theme-toggle::after{left:calc(100% - 12px)}

  /* Layout heights */
  .app-body{height:calc(100vh - 46px - 54px)!important}
  .sidebar{top:46px!important;height:calc(100vh - 46px - 54px)!important;width:94vw!important;max-width:none!important}
  #appScreen.sb-open .sb-overlay{top:46px!important}
  .sb-rail{width:44px!important}
  .st{width:34px;height:34px}
  .st i{font-size:12px}
  .st-lbl{font-size:5px}
  .sb-content{padding:10px 8px!important}

  /* Resume scaling */
  #resumeDoc{transform:scale(calc((100vw - 16px) / 793.7))!important;margin-bottom:-480px}
  .preview-area{padding:6px!important}

  /* Form elements */
  .ss-title{font-size:14px}
  .fl{font-size:11px}
  .fi,.inp{font-size:13px;padding:9px 10px}
  textarea.fi{font-size:13px}

  /* Photo upload */
  .photo-uparea{flex-direction:column;text-align:center;padding:10px}
  .photo-ring{width:52px;height:52px}

  /* Preview header */
  .prev-h{gap:5px}
  .prev-t{font-size:14px}
  .prev-a .bdl{font-size:9px;padding:5px 6px}

  /* Modal */
  .mbox{padding:16px;max-width:calc(100vw - 16px);border-radius:10px}

  /* Auth */
  .auth-card{padding:20px 16px;max-width:calc(100vw - 20px)}
  .auth-logo h1{font-size:30px}
  .auth-nav .anb{font-size:10px;padding:5px 10px}

  /* Import result */
  .import-result-card{width:calc(100vw - 20px)!important;max-width:none!important}

  /* Bottom nav â€” slightly bigger touch targets */
  .mob-nav-btn i{font-size:17px}
  .mob-nav-btn span{font-size:7.5px}
  .mob-nav{padding:5px 0 env(safe-area-inset-bottom,5px)}

  /* Quick actions above bottom nav */
  #quickActions{bottom:64px;right:10px}

  /* Chinko */
  #chinkoBtn{bottom:72px!important}
}

/* â”€â”€ Landscape phone fix â”€â”€ */
@media(max-height:500px) and (max-width:900px){
  .app-body{height:calc(100vh - 48px)!important}
  .sidebar{height:calc(100vh - 48px)!important;top:48px!important}
  #resumeDoc{margin-bottom:-200px}
  .tour-dialog{max-height:80vh;overflow-y:auto}
}

@media print{.sidebar,.app-hdr,.app-ft,.prev-h,#chinkoBtn,#chinkoPanel{display:none!important}.preview-area{padding:0!important}.r-frame{box-shadow:none!important}}

/* â”€â”€ V3 ENHANCEMENTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.cust-sec{background:var(--white,#fff);border:1.5px solid var(--sand);border-radius:12px;padding:13px;margin-bottom:12px}
.cust-sec-t{font-size:9.5px;font-weight:800;text-transform:uppercase;letter-spacing:.8px;color:var(--brown);margin-bottom:10px;display:flex;align-items:center;gap:7px;padding-bottom:7px;border-bottom:1px solid var(--sand)}
.cust-sec-t i{color:var(--caramel)}
.ph-grid{display:grid;grid-template-columns:1fr 1fr;gap:6px;margin-bottom:8px}
.ph-opt{border:1.5px solid var(--sand);border-radius:8px;padding:9px 6px;cursor:pointer;transition:.2s;text-align:center;background:var(--white,#fff)}
.ph-opt:hover{border-color:var(--caramel);background:rgba(196,149,106,.06);transform:translateY(-1px)}
.ph-icon{font-size:18px;margin-bottom:4px}
.ph-nm{font-size:9.5px;font-weight:700;color:var(--dark);text-transform:uppercase;letter-spacing:.4px}
.ph-ds{font-size:9px;color:var(--brown);margin-top:1px}
.upr-zone{border:2px dashed var(--sand);border-radius:10px;padding:18px;text-align:center;cursor:pointer;transition:.2s;background:rgba(196,149,106,.02);margin-bottom:9px}
.upr-zone:hover,.upr-zone.dragover{border-color:var(--caramel);background:rgba(196,149,106,.07);transform:scale(1.01);}
.upr-zone i{font-size:26px;color:var(--caramel);display:block;margin-bottom:6px}
.upr-zone .uz-t{font-weight:700;font-size:12px;color:var(--dark);margin-bottom:2px}
.upr-zone .uz-s{font-size:10px;color:var(--brown)}
.rec-charts-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin:13px 0}
.rec-chart-card{background:var(--white,#fff);border:1.5px solid var(--sand);border-radius:10px;padding:12px}
.rec-chart-title{font-size:9.5px;font-weight:800;text-transform:uppercase;letter-spacing:.6px;color:var(--brown);margin-bottom:8px;display:flex;align-items:center;gap:5px}
.rec-chart-title i{color:var(--caramel)}
.miss-wrap{background:rgba(192,96,58,.06);border:1.5px solid rgba(192,96,58,.22);border-radius:10px;padding:12px;margin-bottom:10px}
.miss-title{font-size:9.5px;font-weight:800;text-transform:uppercase;letter-spacing:.6px;color:var(--rust,#C0603A);margin-bottom:8px}
.match-wrap{background:rgba(122,140,110,.06);border:1.5px solid rgba(122,140,110,.22);border-radius:10px;padding:12px;margin-bottom:10px}
.match-title{font-size:9.5px;font-weight:800;text-transform:uppercase;letter-spacing:.6px;color:var(--sage,#7A8C6E);margin-bottom:8px}
.miss-chip{display:inline-flex;align-items:center;gap:4px;padding:3px 9px;background:rgba(192,96,58,.1);border:1px solid rgba(192,96,58,.3);border-radius:20px;font-size:10px;font-weight:700;color:var(--rust,#C0603A);margin:2px;cursor:pointer;transition:.15s}
.miss-chip:hover{background:rgba(192,96,58,.2)}
.match-chip{display:inline-flex;align-items:center;gap:4px;padding:3px 9px;background:rgba(122,140,110,.1);border:1px solid rgba(122,140,110,.3);border-radius:20px;font-size:10px;font-weight:700;color:var(--sage,#7A8C6E);margin:2px}
.rec-matrix{width:100%;font-size:10px;border-collapse:collapse}
.rec-matrix td,.rec-matrix th{padding:4px 7px;border-bottom:1px solid var(--sand);text-align:left}
.rec-matrix th{font-weight:800;color:var(--brown);font-size:9px;text-transform:uppercase;letter-spacing:.5px}
.vz-stat{background:var(--white,#fff);border-radius:12px;padding:18px 14px;text-align:center;border:1.5px solid var(--sand);box-shadow:0 2px 8px rgba(61,35,20,.08)}
.vz-n{font-family:'Cormorant Garamond',serif;font-size:44px;font-weight:700;display:block;line-height:1}
.vz-l{font-size:9px;font-weight:700;text-transform:uppercase;letter-spacing:.6px;color:var(--brown);margin-top:3px;display:block}
.vz-bar{height:4px;background:var(--sand);border-radius:2px;margin-top:8px;overflow:hidden}
.vz-fi{height:100%;border-radius:2px;transition:width 1.5s ease}
.sb-nav-sec{display:none}
/* â”€â”€ CUSTOMIZATION UPLOAD FIX â”€â”€ */
.import-result-card{background:linear-gradient(135deg,var(--beige),var(--sand));border-radius:12px;padding:14px;margin-top:10px;color:var(--dark);animation:slideUp .3s ease;}
.import-field-row{display:flex;align-items:center;gap:8px;padding:5px 0;border-bottom:1px solid rgba(196,149,106,.15);}
.import-field-row:last-child{border-bottom:none;}
.import-field-lbl{font-size:9px;font-weight:800;text-transform:uppercase;letter-spacing:.6px;color:var(--caramel);min-width:70px;flex-shrink:0;}
.import-field-val{font-size:11px;color:var(--dark);opacity:.9;flex:1;}
.import-badge{display:inline-flex;align-items:center;gap:3px;background:rgba(122,140,110,.25);border:1px solid rgba(122,140,110,.35);border-radius:20px;padding:2px 8px;font-size:9px;font-weight:700;color:#a8d4b0;}
.import-badge.warn{background:rgba(212,168,83,.15);border-color:rgba(212,168,83,.3);color:var(--gold);}
.parse-section{margin-top:11px;}
.parse-sec-title{font-size:9px;font-weight:800;text-transform:uppercase;letter-spacing:.8px;color:var(--caramel);margin-bottom:6px;}
.parse-item{background:rgba(255,255,255,.06);border-radius:6px;padding:7px 9px;margin-bottom:5px;font-size:11px;color:var(--dark);line-height:1.5;border-left:2px solid var(--caramel);}
.import-actions{display:flex;gap:6px;margin-top:10px;}
.import-btn{flex:1;padding:7px 10px;border-radius:8px;font-size:11px;font-weight:700;cursor:pointer;transition:.2s;border:1.5px solid;font-family:"DM Sans",sans-serif;}
.import-btn.apply{background:var(--caramel);border-color:var(--caramel);color:#fff;}.import-btn.apply:hover{background:var(--amber);}
.import-btn.clr{background:transparent;border-color:rgba(196,149,106,.3);color:var(--caramel);}.import-btn.clr:hover{border-color:var(--caramel);}
/* fs-btn styling */
.fs-btn{width:28px;height:28px;border:1.5px solid var(--sand);border-radius:6px;background:var(--cream);cursor:pointer;font-size:14px;font-weight:700;color:var(--dark);display:flex;align-items:center;justify-content:center;transition:.2s;}.fs-btn:hover{border-color:var(--caramel);background:rgba(196,149,106,.08);}

/* â•â•â• COMMAND PALETTE â•â•â• */
#cmdPalette{position:fixed;inset:0;z-index:9500;display:none;align-items:flex-start;justify-content:center;padding-top:min(18vh,140px);background:rgba(2,6,14,.65);backdrop-filter:blur(6px)}
#cmdPalette.show{display:flex}
.cmd-box{width:100%;max-width:520px;background:linear-gradient(145deg,#fdf6ec,#fff9f0);border-radius:16px;box-shadow:0 28px 64px rgba(0,0,0,.5),0 0 0 1px rgba(202,164,106,.25);animation:tourSlideIn .2s ease;overflow:hidden}
.cmd-search-wrap{display:flex;align-items:center;gap:10px;padding:14px 18px;border-bottom:1.5px solid #e8dfd2}
.cmd-search-wrap i{color:#9a7a52;font-size:15px;flex-shrink:0}
.cmd-search-input{flex:1;border:none;outline:none;font-family:"DM Sans",sans-serif;font-size:15px;font-weight:500;background:transparent;color:#1a1a2e}
.cmd-search-input::placeholder{color:#b0a590}
.cmd-kbd{font-size:9px;font-weight:800;background:#e8e0d4;color:#7a6a55;padding:3px 7px;border-radius:5px;letter-spacing:.4px;flex-shrink:0}
.cmd-list{max-height:320px;overflow-y:auto;padding:6px}
.cmd-list::-webkit-scrollbar{width:3px}.cmd-list::-webkit-scrollbar-thumb{background:#d6cfc4}
.cmd-item{display:flex;align-items:center;gap:12px;padding:10px 14px;border-radius:10px;cursor:pointer;transition:.15s;color:#2a2a3a}
.cmd-item:hover,.cmd-item.active{background:rgba(202,164,106,.12);color:#1a1a2e}
.cmd-item i{width:18px;text-align:center;color:#9a7a52;font-size:13px;flex-shrink:0}
.cmd-item-text{flex:1;font-size:13px;font-weight:600}
.cmd-item-kbd{font-size:9px;font-weight:700;color:#b0a590;letter-spacing:.3px}
.cmd-empty{padding:24px;text-align:center;font-size:13px;color:#b0a590;font-style:italic}
.cmd-footer{padding:8px 14px;border-top:1.5px solid #e8dfd2;display:flex;gap:14px;align-items:center;justify-content:center}
.cmd-footer span{font-size:9px;font-weight:700;color:#9a7a52;display:flex;align-items:center;gap:4px}
.cmd-footer kbd{display:inline-flex;align-items:center;justify-content:center;min-width:18px;height:18px;background:#e8e0d4;color:#6a5a45;font-size:8px;font-weight:800;padding:0 5px;border-radius:4px;font-family:"DM Sans",sans-serif}

/* â•â•â• AUTO-SAVE INDICATOR â•â•â• */
.save-status{display:flex;align-items:center;gap:5px;font-size:10px;font-weight:700;color:rgba(253,246,236,.45);letter-spacing:.3px;white-space:nowrap;transition:.3s}
.save-status i{font-size:9px}
.save-status.saving{color:var(--gold)}
.save-status.saved{color:rgba(168,212,176,.7)}
.save-status.unsaved{color:rgba(232,156,106,.6)}
@keyframes savePulse{0%{transform:scale(1)}50%{transform:scale(1.2)}100%{transform:scale(1)}}
.save-status.saving i{animation:savePulse .6s ease infinite}

/* â•â•â• UNDO / REDO â•â•â• */
.hbtn.undo-redo{padding:4px 7px;font-size:12px;background:transparent;border-color:rgba(255,255,255,.08);color:var(--brown)}
.hbtn.undo-redo:hover{border-color:var(--caramel);color:var(--caramel)}
.hbtn.undo-redo:disabled{opacity:.25;pointer-events:none}

/* â•â•â• CONFETTI â•â•â• */
.confetti-container{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:9999;overflow:hidden}
.confetti-piece{position:absolute;top:-10px;width:10px;height:10px;border-radius:2px;animation:confettiFall 2.8s ease-out forwards}
@keyframes confettiFall{0%{transform:translateY(0) rotate(0deg) scale(1);opacity:1}80%{opacity:1}100%{transform:translateY(100vh) rotate(720deg) scale(.3);opacity:0}}
.milestone-toast{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%) scale(0);background:linear-gradient(145deg,#fdf6ec,#fff9f0);border-radius:20px;padding:28px 36px;text-align:center;box-shadow:0 28px 64px rgba(0,0,0,.45);z-index:9800;animation:milestoneIn .5s cubic-bezier(.16,1,.3,1) forwards}
@keyframes milestoneIn{from{transform:translate(-50%,-50%) scale(0);opacity:0}to{transform:translate(-50%,-50%) scale(1);opacity:1}}
.milestone-toast .mt-icon{font-size:42px;margin-bottom:8px}
.milestone-toast .mt-title{font-family:"Cormorant Garamond",serif;font-size:22px;font-weight:700;color:#1a1a2e;margin-bottom:4px}
.milestone-toast .mt-sub{font-size:12px;color:#7a6a55}

/* â•â•â• PASSWORD TOGGLE â•â•â• */
.pwd-wrap{position:relative}
.pwd-wrap .inp{padding-right:36px}
.pwd-toggle{position:absolute;right:8px;top:50%;transform:translateY(-50%);background:none;border:none;cursor:pointer;color:#b0a590;font-size:13px;padding:4px;transition:.2s}
.pwd-toggle:hover{color:#7a6a55}

/* â•â•â• WORD COUNTER â•â•â• */
.char-counter{display:flex;align-items:center;justify-content:space-between;margin-top:-6px;margin-bottom:8px;padding:0 2px}
.char-counter .cc-count{font-size:10px;font-weight:700;letter-spacing:.3px;transition:.3s}
.char-counter .cc-count.ok{color:var(--sage)}
.char-counter .cc-count.warn{color:var(--gold)}
.char-counter .cc-count.over{color:#e06060}
.char-counter .cc-hint{font-size:9px;color:var(--brown);font-style:italic}

/* â•â•â• DARK / LIGHT THEME TOGGLE â•â•â• */
body{transition:background .35s,color .35s}
body.light-theme{--cream:#faf7f2;--beige:#f0ebe2;--sand:#e0d8c8;--caramel:#b78a53;--amber:#9a7040;--brown:#7a6a55;--dark:#1a1a2e;--gold:#b78a53;--rust:#9a7a52;--sage:#7b8d74;--white:#ffffff;--sw:rgba(61,35,20,.08);--sd:rgba(0,0,0,.1);--gh:linear-gradient(135deg,#f8f3eb 0%,#f0ebe2 45%,#e8e0d4 100%)}
body.light-theme .app-hdr{background:#f0ebe2;box-shadow:0 3px 20px rgba(0,0,0,.08)}
body.light-theme .brand{color:#1a1a2e}
body.light-theme .brand em{color:#b78a53}
body.light-theme .hbtn.ol{color:#7a6a55;border-color:rgba(122,106,85,.25)}
body.light-theme .hbtn.dg{color:#c0603a;border-color:rgba(192,96,58,.2)}
body.light-theme .hbtn.tour-btn{color:#b78a53;background:rgba(183,138,83,.1);border-color:rgba(183,138,83,.3)}
body.light-theme .av{background:#e8e0d4;color:#1a1a2e;border-color:#b78a53}
body.light-theme .sbadge.free{background:rgba(122,106,85,.12);color:#7a6a55}
body.light-theme #toast{background:#fff;color:#1a1a2e;box-shadow:0 4px 16px rgba(0,0,0,.12)}
body.light-theme .sb-rail{background:#f0ebe2;border-color:#e0d8c8}
body.light-theme .st{color:#7a6a55}
body.light-theme .st.on,body.light-theme .st:hover{color:#b78a53;background:rgba(183,138,83,.1)}
body.light-theme .sb-content{background:#fff}
body.light-theme .ss-title{color:#1a1a2e}
body.light-theme .fl{color:#7a6a55}
body.light-theme .fi{background:#faf7f2;border-color:#e0d8c8;color:#1a1a2e}
body.light-theme .fi:focus{border-color:#b78a53}
body.light-theme .preview-area{background:#f0ebe2}
body.light-theme .drag-h{background:#e0d8c8}
body.light-theme .drag-h:hover{background:#b78a53}
body.light-theme .app-ft{background:#f0ebe2;color:#7a6a55}
body.light-theme .app-ft em{color:#b78a53}
body.light-theme .qa-fab{background:#b78a53}
body.light-theme .qa-panel{background:#fff;border-color:#e0d8c8}
body.light-theme .qa-btn{color:#1a1a2e}
body.light-theme .qa-btn:hover{background:#f0ebe2;color:#b78a53}
body.light-theme .sdd-m{background:#fff;border-color:#e0d8c8}
body.light-theme .sdd-i{color:#1a1a2e}
body.light-theme .sdd-i:hover{background:#f0ebe2;color:#b78a53}
body.light-theme .save-status{color:rgba(26,26,46,.4)}
body.light-theme .save-status.saved{color:rgba(123,141,116,.8)}
body.light-theme .hbtn.undo-redo{border-color:rgba(0,0,0,.08);color:#7a6a55}
body.light-theme .rsz-btn{background:#fff;color:#7a6a55;border-color:#e0d8c8}
body.light-theme .rsz-btn.active{background:#f0ebe2;color:#1a1a2e;border-color:#e0d8c8}
body.light-theme .prev-t{color:#1a1a2e}
body.light-theme .bdl{color:#7a6a55;border-color:rgba(122,106,85,.2)}
body.light-theme .bdl:hover{border-color:#b78a53;color:#b78a53}
body.light-theme .bdl.out{background:rgba(183,138,83,.1);border-color:rgba(183,138,83,.25);color:#b78a53}
body.light-theme .ch-hd{background:linear-gradient(135deg,#1a1f30,#0d1421)}
body.light-theme #chinkoPanel{background:#fff;border-color:#e0d8c8}
body.light-theme .ats-c{background:rgba(183,138,83,.08);border-color:rgba(183,138,83,.2)}
body.light-theme .qcard{background:#faf7f2;border-color:#e0d8c8}
body.light-theme .chart-c{background:#fff;border-color:#e0d8c8}
body.light-theme .sub-hero h1{color:#1a1a2e}
body.light-theme .sub-hero p{color:#7a6a55}
body.light-theme .plan-c{background:#fff;border-color:#e0d8c8}
.theme-toggle{position:relative;width:42px;height:22px;border-radius:20px;border:1.5px solid rgba(202,164,106,.4);background:rgba(202,164,106,.12);cursor:pointer;transition:.3s;display:flex;align-items:center;padding:0 3px;flex-shrink:0}
.theme-toggle::after{content:'ðŸŒ™';position:absolute;left:2px;width:16px;height:16px;border-radius:50%;background:var(--gold);transition:.3s;display:flex;align-items:center;justify-content:center;font-size:9px;box-shadow:0 1px 4px rgba(0,0,0,.2)}
body.light-theme .theme-toggle{background:rgba(183,138,83,.15);border-color:rgba(183,138,83,.3)}
body.light-theme .theme-toggle::after{content:'â˜€ï¸';left:calc(100% - 18px);background:#f59e0b}

/* â•â•â• SECTION ANIMATIONS â•â•â• */
.ss{opacity:0;transform:translateY(10px);transition:opacity .3s ease,transform .3s ease}
.ss.on{opacity:1;transform:translateY(0)}
.st{transition:all .2s ease}
.st.on{position:relative}
.st.on::after{content:'';position:absolute;left:0;top:50%;transform:translateY(-50%);width:3px;height:60%;background:var(--caramel);border-radius:0 3px 3px 0}
@keyframes sectionGlow{from{box-shadow:0 0 0 0 rgba(202,164,106,.3)}to{box-shadow:0 0 0 0 transparent}}

/* â•â•â• MULTI RESUME â•â•â• */
.resume-dd{position:relative;display:inline-flex}
.resume-dd-btn{padding:3px 10px;border-radius:7px;font-family:"DM Sans",sans-serif;font-size:10px;font-weight:700;cursor:pointer;border:1.5px solid rgba(202,164,106,.3);background:rgba(202,164,106,.08);color:var(--gold);display:flex;align-items:center;gap:5px;white-space:nowrap;transition:.2s;max-width:140px;overflow:hidden;text-overflow:ellipsis}
.resume-dd-btn:hover{border-color:var(--caramel);background:rgba(202,164,106,.15)}
.resume-dd-menu{position:absolute;top:calc(100% + 6px);left:0;background:linear-gradient(145deg,#fdf6ec,#fff9f0);border:1.5px solid #e0d8c8;border-radius:12px;box-shadow:0 16px 40px rgba(0,0,0,.35);min-width:240px;z-index:400;display:none;animation:slideUp .2s ease;overflow:hidden}
.resume-dd.open .resume-dd-menu{display:block}
.rdd-header{padding:10px 14px;border-bottom:1px solid #e8dfd2;font-family:"Cormorant Garamond",serif;font-size:14px;font-weight:700;color:#1a1a2e}
.rdd-list{max-height:200px;overflow-y:auto;padding:4px}
.rdd-item{display:flex;align-items:center;gap:8px;padding:8px 12px;border-radius:8px;cursor:pointer;transition:.15s;font-size:12px;font-weight:600;color:#2a2a3a}
.rdd-item:hover{background:rgba(202,164,106,.1)}
.rdd-item.active{background:rgba(202,164,106,.15);color:#1a1a2e}
.rdd-item i{color:#9a7a52;font-size:11px;width:16px;text-align:center;flex-shrink:0}
.rdd-item-name{flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.rdd-item-del{opacity:0;color:#c0603a;font-size:10px;cursor:pointer;padding:2px 4px;transition:.2s}
.rdd-item:hover .rdd-item-del{opacity:.7}
.rdd-item-del:hover{opacity:1!important}
.rdd-actions{padding:6px 10px;border-top:1px solid #e8dfd2;display:flex;gap:6px}
.rdd-act{flex:1;padding:6px 8px;border-radius:7px;font-size:10px;font-weight:700;cursor:pointer;border:1.5px solid #e0d8c8;background:#fff;color:#2a2a3a;text-align:center;transition:.2s;font-family:"DM Sans",sans-serif}
.rdd-act:hover{border-color:#caa46a;color:#caa46a;background:rgba(202,164,106,.05)}
.rdd-act.primary{background:linear-gradient(135deg,#1a1f30,#0d1421);color:#e0b980;border-color:#1a1f30}

/* keyboard shortcut hint */
.kb-hint{position:fixed;bottom:16px;left:16px;z-index:550;display:flex;align-items:center;gap:6px;background:var(--beige);border:1.5px solid var(--sand);border-radius:10px;padding:6px 12px;cursor:pointer;transition:.2s;box-shadow:0 4px 16px var(--sw)}
.kb-hint:hover{border-color:var(--caramel);background:rgba(196,149,106,.12)}
.kb-hint i{color:var(--caramel);font-size:12px}
.kb-hint span{font-size:10px;font-weight:700;color:var(--brown)}
body.light-theme .kb-hint{background:#fff;border-color:#e0d8c8;box-shadow:0 4px 16px rgba(0,0,0,.08)}
</style>
</head>
<body>
<div id="toast"></div>
<!-- AUTH SCREEN -->
<div id="authScreen" class="screen active">
<nav class="auth-nav">
  <div class="brand">Ely<em>ssor</em></div>
  <div style="display:flex;gap:8px">
    <button class="anb ol" onclick="showATab('login')">Sign In</button>
    <button class="anb sd" onclick="showATab('signup')">Get Started Free</button>
  </div>
</nav>
<div class="auth-hero">
<div class="auth-card">
  <div class="auth-logo"><h1>Ely<em>ssor</em></h1><p>Where careers are crafted. Where futures begin.</p></div>
  <div class="atabs">
    <button class="atab on" id="abt-login" onclick="showATab('login')">Sign In</button>
    <button class="atab" id="abt-signup" onclick="showATab('signup')">Create Account</button>
    <button class="atab" id="abt-recruiter" onclick="showATab('recruiter')">Recruiter</button>
  </div>
  <div id="af-login" class="af on">
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:12px">
      <button class="oauth-btn" onclick="oauthLogin('google')"><svg width="14" height="14" viewBox="0 0 24 24"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/></svg> Google</button>
      <button class="oauth-btn" onclick="oauthLogin('github')"><svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z"/></svg> GitHub</button>
    </div>
    <div style="text-align:center;font-size:10px;font-weight:700;color:#c4b8a4;text-transform:uppercase;letter-spacing:1.5px;margin:10px 0;position:relative"><span style="background:#fffdf8;padding:0 10px;position:relative;z-index:1">or email</span><div style="position:absolute;top:50%;left:0;right:0;height:1px;background:#e0d8c8"></div></div>
    <label class="lbl">Email</label>
    <input class="inp" id="li-email" type="email" placeholder="you@email.com">
    <label class="lbl">Password</label>
    <div class="pwd-wrap"><input class="inp" id="li-pass" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" onkeydown="if(event.key==='Enter')doLogin()"><button class="pwd-toggle" type="button" onclick="togglePwd('li-pass',this)"><i class="fas fa-eye"></i></button></div>
    <button class="btn-p" onclick="doLogin()"><i class="fas fa-sign-in-alt"></i> Sign In to Elyssor</button>
    <div class="guest-l"><a onclick="goGuest()">Continue as Guest (Free) â†’</a></div>
  </div>
  <div id="af-signup" class="af">
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:12px">
      <button class="oauth-btn" onclick="oauthSignup('google')"><svg width="14" height="14" viewBox="0 0 24 24"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/></svg> Google</button>
      <button class="oauth-btn" onclick="oauthSignup('github')"><svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z"/></svg> GitHub</button>
    </div>
    <div style="text-align:center;font-size:10px;font-weight:700;color:#c4b8a4;letter-spacing:1.5px;margin:10px 0">â€” or email â€”</div>
    <label class="lbl">Full Name</label>
    <input class="inp" id="su-name" placeholder="Alexandra Chen">
    <div class="inp-row">
      <div><label class="lbl">Email</label><input class="inp" id="su-email" type="email" placeholder="you@email.com"></div>
      <div><label class="lbl">Password</label><div class="pwd-wrap"><input class="inp" id="su-pass" type="password" placeholder="Min 6 chars"><button class="pwd-toggle" type="button" onclick="togglePwd('su-pass',this)"><i class="fas fa-eye"></i></button></div></div>
    </div>
    <label class="lbl" style="margin-bottom:7px">I am a...</label>
    <div class="utype-g">
      <div class="utype sel" id="ut-s" onclick="selUT(this,'student')"><i class="fas fa-user-graduate"></i><span>Student/Fresher</span></div>
      <div class="utype" id="ut-p" onclick="selUT(this,'professional')"><i class="fas fa-briefcase"></i><span>Professional</span></div>
      <div class="utype" id="ut-c" onclick="selUT(this,'career-change')"><i class="fas fa-sync-alt"></i><span>Career Change</span></div>
    </div>
    <label class="lbl">Primary Field</label>
    <select class="inp" id="su-field" style="appearance:auto">
      <option value="">Select your field...</option>
      <option>Software Engineering</option><option>Data Science &amp; Analytics</option>
      <option>UI/UX &amp; Product Design</option><option>Marketing &amp; Growth</option>
      <option>Finance &amp; Accounting</option><option>Management &amp; Leadership</option>
      <option>Healthcare &amp; Medical</option><option>Education &amp; Research</option>
      <option>Engineering (Mech/Civil/Elec)</option><option>Content &amp; Creative Writing</option>
      <option>Sales &amp; Business Development</option><option>Cybersecurity</option><option>Other</option>
    </select>
    <button class="btn-p" onclick="doSignup()"><i class="fas fa-rocket"></i> Create My Elyssor Account</button>
    <div class="guest-l"><a onclick="goGuest()">Skip &amp; continue as Guest â†’</a></div>
  </div>
  <div id="af-recruiter" class="af">
    <div style="background:linear-gradient(135deg,#1a1f30,#0d1421);border-radius:10px;padding:12px;margin-bottom:14px;color:#e0b980">
      <div style="font-family:'Cormorant Garamond',serif;font-size:15px;font-weight:700;margin-bottom:3px">ðŸŽ¯ Recruiter Portal</div>
      <div style="font-size:11px;opacity:.78;color:#a6b3c8">AI-powered resume analysis for hiring teams.</div>
    </div>
    <label class="lbl">Company Email</label><input class="inp" id="re-email" type="email" placeholder="hr@company.com">
    <label class="lbl">Company Name</label><input class="inp" id="re-company" placeholder="Acme Corp">
    <label class="lbl">Password</label><div class="pwd-wrap"><input class="inp" id="re-pass" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"><button class="pwd-toggle" type="button" onclick="togglePwd('re-pass',this)"><i class="fas fa-eye"></i></button></div>
    <button class="btn-p" onclick="doRecLogin()"><i class="fas fa-building"></i> Access Recruiter Dashboard</button>
  </div>
</div>
</div>
</div>

<!-- APP SCREEN -->
<div id="appScreen" class="screen">
<header class="app-hdr">
  <div class="hd-left">
    <button class="hbtn mbtn" id="mb-menu" title="Menu"><i class="fas fa-bars"></i></button>
    <button class="hbtn mbtn" id="mb-preview" title="Preview"><i class="fas fa-eye"></i></button>
  <div class="brand">Ely<em>ssor</em></div>
  </div>
  <div class="hd-mid">
    <div class="resume-dd" id="resumeDD">
      <button class="resume-dd-btn" onclick="toggleResumeDD()" data-tooltip="Switch between resumes"><i class="fas fa-file-alt"></i> <span id="resumeDDName">Resume 1</span> <i class="fas fa-chevron-down" style="font-size:7px;margin-left:2px"></i></button>
      <div class="resume-dd-menu">
        <div class="rdd-header">My Resumes</div>
        <div class="rdd-list" id="rddList"></div>
        <div class="rdd-actions">
          <button class="rdd-act primary" onclick="createNewResume()"><i class="fas fa-plus"></i> New</button>
          <button class="rdd-act" onclick="duplicateResume()"><i class="fas fa-copy"></i> Duplicate</button>
          <button class="rdd-act" onclick="renameResume()"><i class="fas fa-pen"></i> Rename</button>
        </div>
      </div>
    </div>
    <span class="sbadge free" id="sub-badge">FREE</span>
    <span id="hd-user" style="font-size:10px;color:rgba(253,246,236,.4);font-family:'Cormorant Garamond',serif;font-style:italic;margin-left:4px"></span>
    <div class="save-status" id="saveStatus"><i class="fas fa-circle-check"></i> <span id="saveStatusText">Ready</span></div>
  </div>
  <div class="hd-r">
    <button class="hbtn undo-redo" id="undoBtn" onclick="doUndo()" disabled data-tooltip="Undo (Ctrl+Z)"><i class="fas fa-undo"></i></button>
    <button class="hbtn undo-redo" id="redoBtn" onclick="doRedo()" disabled data-tooltip="Redo (Ctrl+Shift+Z)"><i class="fas fa-redo"></i></button>
    <div class="theme-toggle" id="themeToggle" onclick="toggleTheme()" data-tooltip="Switch light/dark theme"></div>
    <button class="hbtn tour-btn" id="headerTourBtn" onclick="startTour()" data-tooltip="Take a guided tour of Elyssor"><i class="fas fa-route"></i> Tour</button>
    <button class="hbtn ol" onclick="showScreen('subScreen')" data-tooltip="Upgrade your plan for more features"><i class="fas fa-crown"></i> Upgrade</button>
    <button class="hbtn ol" onclick="autoSave()" data-tooltip="Save your resume progress"><i class="fas fa-save"></i> Save</button>
    <div class="sdd" id="saveDD">
      <button class="hbtn gd" onclick="toggleSDD()" data-tooltip="Download or export your resume"><i class="fas fa-download"></i> Save As <i class="fas fa-chevron-down" style="font-size:7px"></i></button>
      <div class="sdd-m">
        <div class="sdd-i" onclick="dlPDF()"><i class="fas fa-file-pdf"></i> Export PDF</div>
        <div class="sdd-i" onclick="dlJSON()"><i class="fas fa-file-code"></i> Save as JSON</div>
        <div class="sdd-i" onclick="window.print()"><i class="fas fa-print"></i> Print Resume</div>
        <div class="sdd-i" onclick="goViz()"><i class="fas fa-chart-bar"></i> Full Analytics</div>
      </div>
    </div>
    <button class="hbtn ol" onclick="goViz()" data-tooltip="View resume analytics & insights"><i class="fas fa-chart-pie"></i> Analytics</button>
    <div class="av" id="av-el" data-tooltip="Your profile"></div>
    <button class="hbtn dg" onclick="doLogout()" data-tooltip="Sign out of Elyssor"><i class="fas fa-sign-out-alt"></i> Logout</button>
  </div>
</header>
<div class="sb-overlay" id="sb-overlay"></div>
<div class="app-body" id="appBody">
<!-- SIDEBAR -->
<aside class="sidebar" id="mainSidebar">
  <!-- ICON RAIL -->
  <nav class="sb-rail" id="sb-rail">
    <div class="sb-rail-logo">E</div>
    <div class="sb-rail-grp-lbl">Profile</div>
    <button class="st on" onclick="showSec('personal',this)" data-tip="Personal Details"><i class="fas fa-user"></i><span>Personal</span></button>
    <button class="st" onclick="showSec('summary',this)" data-tip="Professional Summary"><i class="fas fa-align-left"></i><span>Summary</span></button>
    <div class="sb-rail-sep"></div>
    <div class="sb-rail-grp-lbl">Resume</div>
    <button class="st" onclick="showSec('exp',this)" data-tip="Work Experience"><i class="fas fa-briefcase"></i><span>Work</span></button>
    <button class="st" onclick="showSec('edu',this)" data-tip="Education"><i class="fas fa-graduation-cap"></i><span>Edu</span></button>
    <button class="st" onclick="showSec('skills',this)" data-tip="Skills"><i class="fas fa-code"></i><span>Skills</span></button>
    <button class="st" onclick="showSec('certs',this)" data-tip="Certifications"><i class="fas fa-certificate"></i><span>Certs</span></button>
    <button class="st" onclick="showSec('proj',this)" data-tip="Projects"><i class="fas fa-folder-open"></i><span>Projects</span></button>
    <button class="st" onclick="showSec('intern',this)" data-tip="Internships"><i class="fas fa-star"></i><span>Intern</span></button>
    <div class="sb-rail-sep"></div>
    <div class="sb-rail-grp-lbl">Tools</div>
    <button class="st" onclick="showSec('design',this)" data-tip="Templates & Design"><i class="fas fa-palette"></i><span>Design</span></button>
    <button class="st" onclick="showSec('customization',this)" data-tip="Customize Resume"><i class="fas fa-sliders-h"></i><span>Custom</span></button>
    <button class="st" onclick="showSec('grammar',this)" data-tip="Grammar Check"><i class="fas fa-spell-check"></i><span>Grammar</span></button>
    <button class="st" onclick="showSec('analysis',this)" data-tip="ATS Analysis"><i class="fas fa-chart-bar"></i><span>Analysis</span></button>
    <button class="st" onclick="showSec('courses',this)" data-tip="Courses & Resources"><i class="fas fa-book-open"></i><span>Courses</span></button>
  </nav>
  <!-- CONTENT PANEL -->
  <div class="sb-content" id="sb-content">
  <!-- PERSONAL -->
  <div id="ss-personal" class="ss on">
    <div class="ss-title">Personal Details</div>
    <div class="ss-desc">Your identity â€” make every word count</div>
    <div class="prog-w"><div class="prog-h"><span>Profile Completion</span><span id="pc-pct">0%</span></div><div class="prog-t"><div class="prog-f" id="pc-bar" style="width:0%"></div></div><div class="pc-chips" id="pc-chips"></div></div>
    <label class="fl">Full Name <span class="fr">*</span></label><input class="fi" id="p-name" placeholder="Alexandra Chen" oninput="liveUp()">
    <label class="fl">Professional Title</label><input class="fi" id="p-title" placeholder="Senior Software Engineer" oninput="liveUp()">
    <label class="fl">Target Job Role</label><input class="fi" id="p-target" placeholder="Full Stack Developer" oninput="liveUp();updSug()">
    <div class="frow"><div><label class="fl">Email <span class="fr">*</span></label><input class="fi" id="p-email" type="email" placeholder="alex@email.com" oninput="liveUp()"></div><div><label class="fl">Phone</label><input class="fi" id="p-phone" placeholder="+1 555 0000" oninput="liveUp()"></div></div>
    <div class="frow"><div><label class="fl">Location</label><input class="fi" id="p-loc" placeholder="New York, NY" oninput="liveUp()"></div><div><label class="fl">Nationality</label><input class="fi" id="p-nat" placeholder="American" oninput="liveUp()"></div></div>
    <div class="frow"><div><label class="fl">LinkedIn</label><input class="fi" id="p-li" placeholder="linkedin.com/in/..." oninput="liveUp()"></div><div><label class="fl">GitHub/Portfolio</label><input class="fi" id="p-gh" placeholder="github.com/..." oninput="liveUp()"></div></div>
    <label class="fl">Website</label><input class="fi" id="p-web" placeholder="yoursite.com" oninput="liveUp()">
    <label class="fl">Profile Photo</label>
    <div class="photo-uparea">
      <div class="photo-ring" id="photoRing" onclick="document.getElementById('photoFile').click()" title="Click to upload photo">
        <span id="photoEmoji">ðŸ‘¤</span>
      </div>
      <div class="photo-meta">
        <div class="fl">Upload your photo</div>
        <p>Shown on resume Â· JPG/PNG Â· max 2 MB<br>Click the circle or use the button below</p>
        <div class="photo-btns">
          <button class="pbtn up" onclick="document.getElementById('photoFile').click()"><i class="fas fa-upload"></i> Upload</button>
          <button class="pbtn rm" id="photoRmBtn" onclick="removePhoto()"><i class="fas fa-times"></i> Remove</button>
        </div>
        <input type="file" id="photoFile" accept="image/*" style="display:none" onchange="handlePhoto(event)">
      </div>
    </div>
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:10px">
      <span class="fl" style="margin-bottom:0">Show Photo on Resume</span>
      <label class="tog"><input type="checkbox" id="show-photo" onchange="liveUp()"><span class="tog-sl"></span></label>
    </div>
  </div>
  <!-- SUMMARY -->
  <div id="ss-summary" class="ss">
    <div class="ss-title">Professional Summary</div>
    <div class="ss-desc">AI-powered, ATS-optimized, uniquely yours</div>
    <label class="fl">Summary</label>
    <textarea class="fi" id="p-summary" rows="6" placeholder="Describe your professional identity, key achievements..." oninput="liveUp();inlGram(this);updCharCounter('p-summary','sumCharCount',150,300)"></textarea>
    <div class="char-counter"><span class="cc-count" id="sumCharCount">0 chars</span><span class="cc-hint">Ideal: 150â€“300 characters</span></div>
    <div id="sum-gram-res"></div>
    <button class="btn-a" style="margin-bottom:9px" onclick="genSum()"><i class="fas fa-wand-magic-sparkles"></i> AI Generate Smart Summary</button>
    <div class="frow">
      <div><label class="fl">Tone</label><select class="fsel" id="sum-tone"><option value="professional">Professional</option><option value="confident">Bold &amp; Confident</option><option value="creative">Creative</option><option value="analytical">Data-Driven</option><option value="leadership">Leadership</option></select></div>
      <div><label class="fl">Length</label><select class="fsel" id="sum-len"><option value="short">Short</option><option value="medium" selected>Medium</option><option value="long">Long</option></select></div>
    </div>
  </div>
  <!-- EXPERIENCE -->
  <div id="ss-exp" class="ss"><div class="ss-title">Work Experience</div><div class="ss-desc">Show quantified achievements, not just duties</div><div id="exp-list"></div><button class="btn-a" onclick="openMod('exp')"><i class="fas fa-plus"></i> Add Work Experience</button></div>
  <!-- EDUCATION -->
  <div id="ss-edu" class="ss"><div class="ss-title">Education</div><div class="ss-desc">Your academic foundation</div><div id="edu-list"></div><button class="btn-a" onclick="openMod('edu')"><i class="fas fa-plus"></i> Add Education</button></div>
  <!-- SKILLS -->
  <div id="ss-skills" class="ss">
    <div class="ss-title">Skills</div><div class="ss-desc">Keywords that beat ATS scanners</div>
    <div class="sk-ts"><button class="sk-t on" onclick="showSkC('tech',this)">Technical</button><button class="sk-t" onclick="showSkC('prof',this)">Professional</button><button class="sk-t" onclick="showSkC('tools',this)">Tools</button><button class="sk-t" onclick="showSkC('fw',this)">Frameworks</button></div>
    <div id="skc-tech">
      <div class="chip-grid" id="sk-tech"></div>
      <div class="sk-r"><input class="fi" id="ski-tech" placeholder="Add technical skill..." onkeydown="if(event.key==='Enter')addSk('tech')"><select class="fsel" id="skl-tech" style="width:100px;margin-bottom:0;flex-shrink:0"><option value="95">Expert</option><option value="80" selected>Advanced</option><option value="65">Intermediate</option><option value="45">Beginner</option></select></div>
      <button class="btn-a" onclick="addSk('tech')"><i class="fas fa-plus"></i> Add Technical Skill</button>
      <div class="fl" style="margin:9px 0 5px">Suggested for your role:</div><div class="chip-grid" id="sug-sk-tech"></div>
    </div>
    <div id="skc-prof" style="display:none">
      <div class="chip-grid" id="sk-prof"></div>
      <div class="sk-r"><input class="fi" id="ski-prof" placeholder="Add professional skill..." onkeydown="if(event.key==='Enter')addSk('prof')"><select class="fsel" id="skl-prof" style="width:100px;margin-bottom:0;flex-shrink:0"><option value="95">Expert</option><option value="80" selected>Advanced</option><option value="65">Intermediate</option><option value="45">Beginner</option></select></div>
      <button class="btn-a" onclick="addSk('prof')"><i class="fas fa-plus"></i> Add Professional Skill</button>
      <div class="fl" style="margin:9px 0 5px">Soft &amp; professional skills:</div><div class="chip-grid" id="sug-sk-prof"></div>
    </div>
    <div id="skc-tools" style="display:none">
      <div class="chip-grid" id="sk-tools"></div>
      <div class="sk-r"><input class="fi" id="ski-tools" placeholder="Add tool (Figma, Jira, etc.)..." onkeydown="if(event.key==='Enter')addSk('tools')"><select class="fsel" id="skl-tools" style="width:100px;margin-bottom:0;flex-shrink:0"><option value="95">Expert</option><option value="80" selected>Advanced</option><option value="65">Intermediate</option><option value="45">Beginner</option></select></div>
      <button class="btn-a" onclick="addSk('tools')"><i class="fas fa-plus"></i> Add Tool</button>
    </div>
    <div id="skc-fw" style="display:none">
      <div class="chip-grid" id="sk-fw"></div>
      <div class="sk-r"><input class="fi" id="ski-fw" placeholder="Add framework (React, Django...)..." onkeydown="if(event.key==='Enter')addSk('fw')"><select class="fsel" id="skl-fw" style="width:100px;margin-bottom:0;flex-shrink:0"><option value="95">Expert</option><option value="80" selected>Advanced</option><option value="65">Intermediate</option><option value="45">Beginner</option></select></div>
      <button class="btn-a" onclick="addSk('fw')"><i class="fas fa-plus"></i> Add Framework</button>
    </div>
  </div>
  <!-- CERTS -->
  <div id="ss-certs" class="ss"><div class="ss-title">Certifications</div><div class="ss-desc">Credentials that validate your expertise</div><div id="cert-list"></div><button class="btn-a" onclick="openMod('cert')"><i class="fas fa-plus"></i> Add Certification</button></div>
  <!-- PROJECTS -->
  <div id="ss-proj" class="ss"><div class="ss-title">Projects</div><div class="ss-desc">Tangible proof of your capabilities</div><div id="proj-list"></div><button class="btn-a" onclick="openMod('proj')"><i class="fas fa-plus"></i> Add Project</button></div>
  <!-- INTERNSHIPS -->
  <div id="ss-intern" class="ss">
    <div class="ss-title">Internships</div><div class="ss-desc">Fresher? Internships = gold on your resume</div>
    <div id="intern-list"></div>
    <button class="btn-a" onclick="openMod('intern')" style="margin-bottom:11px"><i class="fas fa-plus"></i> Add Internship</button>
    <div class="sug ok"><div class="sug-t">ðŸ’¡ Fresher Tip</div><div class="sug-txt">Even a 4-week internship shows real-world experience. Academic projects and open-source also count!</div></div>
  </div>
  <!-- GRAMMAR -->
  <div id="ss-grammar" class="ss">
    <div class="ss-title">Grammar &amp; Spell Check</div><div class="ss-desc">Upload a file or check typed content</div>
    <div class="upz" id="gram-upz" onclick="document.getElementById('gram-file').click()" ondrop="handleDrop(event)" ondragover="event.preventDefault();this.style.borderColor='var(--caramel)'" ondragleave="this.style.borderColor='var(--sand)'">
      <i class="fas fa-file-upload"></i>
      <div class="up-t">Upload Resume File</div>
      <div class="up-s">Drag &amp; drop or click Â· TXT, DOC, PDF<br>Auto-corrects spelling &amp; grammar</div>
      <input type="file" id="gram-file" accept=".txt,.doc,.pdf" style="display:none" onchange="handleFileUp(event)">
    </div>
    <div id="gram-res-area"></div>
    <div id="gram-prem" style="display:none" class="sug w"><div class="sug-t">ðŸ”’ Free Limit Reached</div><div class="sug-txt">You've seen 5 of <span id="gram-total">0</span> errors. <a onclick="showScreen('subScreen')" style="color:var(--amber);font-weight:700;cursor:pointer">Upgrade to Pro</a> to fix all.</div></div>
  </div>
  <!-- DESIGN -->
  <div id="ss-design" class="ss">
    <div class="ss-title">Templates &amp; Design</div>
    <div class="ss-desc">70+ professional layouts Â· pixel-perfect</div>
    <div class="tf" id="tmplFilters">
      <button class="tfb on" onclick="filterT('all',this)">All</button>
      <button class="tfb" onclick="filterT('free',this)">Free</button>
      <button class="tfb" onclick="filterT('pro',this)">Pro</button>
      <button class="tfb" onclick="filterT('premium',this)">Premium</button>
      <button class="tfb" onclick="filterT('classic',this)">Classic</button>
      <button class="tfb" onclick="filterT('sidebar',this)">Sidebar</button>
      <button class="tfb" onclick="filterT('twocol',this)">Two-Column</button>
      <button class="tfb" onclick="filterT('creative',this)">Creative</button>
      <button class="tfb" onclick="filterT('minimal',this)">Minimal</button>
      <button class="tfb" onclick="filterT('dark',this)">Dark</button>
    </div>
    <div id="tmpl-sections"></div>
    <div class="fl" style="margin:11px 0 7px">Typography â€” 55 Fonts</div>
    <div class="font-g" id="font-g"></div>
    <div class="fl" style="margin-bottom:7px">Color Palettes</div>
    <div class="pal-g" id="pal-g"></div>
    <div class="fl" style="margin-bottom:7px">Custom Colors</div>
    <div class="cclr">
      <div class="cc-r"><i class="fas fa-circle" style="color:var(--caramel)"></i> Header <input type="color" id="cc-hdr" value="#1a1a2e" onchange="applyC()"></div>
      <div class="cc-r"><i class="fas fa-circle" style="color:var(--gold)"></i> Accent <input type="color" id="cc-acc" value="#d4a853" onchange="applyC()"></div>
      <div class="cc-r"><i class="fas fa-circle" style="color:var(--dark)"></i> Text <input type="color" id="cc-txt" value="#1a1a1a" onchange="applyC()"></div>
      <div class="cc-r"><i class="fas fa-circle" style="color:var(--sand)"></i> BG <input type="color" id="cc-bg" value="#ffffff" onchange="applyC()"></div>
    </div>
    <div class="frow" style="align-items:center">
      <div><label class="fl">Font Size</label><div style="display:flex;align-items:center;gap:6px"><button onclick="chFS(-1)" style="width:25px;height:25px;border:1.5px solid var(--sand);border-radius:5px;background:var(--cream);cursor:pointer">âˆ’</button><span id="fs-val" style="font-size:12px;font-weight:700;min-width:28px;text-align:center">14px</span><button onclick="chFS(1)" style="width:25px;height:25px;border:1.5px solid var(--sand);border-radius:5px;background:var(--cream);cursor:pointer">+</button></div></div>
      <div><label class="fl">Spacing</label><select class="fsel" id="line-sp" style="margin-bottom:0" onchange="applyC()"><option value="1.3">Compact</option><option value="1.5" selected>Normal</option><option value="1.7">Relaxed</option><option value="1.9">Airy</option></select></div>
    </div>
    <div class="fl" style="margin-top:10px;margin-bottom:7px">Decorative Elements</div>
    <div class="elem-g" id="elem-g"></div>
    <div class="fl" style="margin-top:10px;margin-bottom:7px">Section Alignment</div>
    <div style="display:flex;gap:5px"><button onclick="setAl('left',this)" class="tfb on"><i class="fas fa-align-left"></i> Left</button><button onclick="setAl('center',this)" class="tfb"><i class="fas fa-align-center"></i> Center</button><button onclick="setAl('justify',this)" class="tfb"><i class="fas fa-align-justify"></i> Justified</button></div>
    <div class="fl" style="margin-top:10px;margin-bottom:7px">Custom Text Block</div>
    <textarea class="fi" id="custom-text" rows="3" placeholder="Awards, hobbies, languages, volunteer work..." oninput="liveUp()"></textarea>
  </div>
  <!-- ANALYSIS -->
  <div id="ss-analysis" class="ss">
    <div class="ss-title">Resume Analysis</div><div class="ss-desc">AI insights to maximize interviews</div>
    <div class="ats-c"><div class="ats-hd"><i class="fas fa-robot"></i> ATS Compatibility Score</div><div class="ats-r"><div class="ats-ring" id="ats-ring"><span class="ats-n" id="ats-n">0</span></div><div><div class="ats-lbl" id="ats-lbl">Incomplete</div><div class="ats-sub" id="ats-sub">Fill details to improve</div></div></div><div class="ats-bars" id="ats-bars"></div></div>
    <div class="qcard"><div class="q-txt" id="q-txt">Your resume is your first impression â€” make it unforgettable.</div><div class="q-by" id="q-by">Elyssor Career Advisor</div></div>
    <div class="chart-g">
      <div class="chart-c full"><div class="ct"><i class="fas fa-spider"></i> Skills Radar</div><canvas id="c-radar" height="175"></canvas></div>
      <div class="chart-c"><div class="ct"><i class="fas fa-chart-bar"></i> Section Strength</div><canvas id="c-bar" height="145"></canvas></div>
      <div class="chart-c"><div class="ct"><i class="fas fa-chart-pie"></i> Resume Balance</div><canvas id="c-donut" height="145"></canvas></div>
    </div>
    <div class="fl" style="margin-bottom:7px">ðŸ’¡ Improvement Suggestions</div><div id="sug-list"></div>
    <div class="fl" style="margin-top:11px;margin-bottom:7px">ðŸŽ¯ Missing Skills for Your Goal</div><div id="miss-skills"></div>
    <div style="margin-top:12px"><div class="ct"><i class="fas fa-users"></i> Student vs Professional Profile</div><canvas id="c-profile-bar" height="120"></canvas></div>
  </div>
  <!-- CUSTOMIZATION -->
  <div id="ss-customization" class="ss">
    <div class="ss-title">Customization</div>
    <div class="ss-desc">Upload, edit &amp; see changes live in preview</div>

    <!-- UPLOAD CARD -->
    <div class="cust-sec">
      <div class="cust-sec-t"><i class="fas fa-file-import"></i> Import Existing Resume</div>
      <div class="upr-zone" id="upr-zone-cust" onclick="document.getElementById('cust-resume-file').click()" ondrop="handleCustDrop(event)" ondragover="event.preventDefault();this.classList.add('dragover')" ondragleave="this.classList.remove('dragover')">
        <i class="fas fa-cloud-upload-alt"></i>
        <div class="uz-t">Drop your resume or click to upload</div>
        <div class="uz-s">TXT Â· DOC Â· PDF Â· Auto-fills all fields &amp; live preview updates</div>
        <input type="file" id="cust-resume-file" accept=".txt,.doc,.pdf,.docx" style="display:none" onchange="handleCustResumeUp(event)">
      </div>
      <div id="cust-import-result"></div>
    </div>

    <!-- LIVE EDITABLE FIELDS (always visible, synced to preview) -->
    <div class="cust-sec" id="cust-edit-sec">
      <div class="cust-sec-t"><i class="fas fa-pen-nib"></i> Edit Details <span style="font-size:9px;font-weight:600;color:var(--sage);margin-left:6px;text-transform:none;letter-spacing:0">Â· Updates preview instantly</span></div>
      <label class="fl">Full Name</label>
      <input class="fi" id="ce-name" placeholder="Your full name" oninput="syncLive('p-name','ce-name','name')">
      <label class="fl">Professional Title</label>
      <input class="fi" id="ce-title" placeholder="e.g. Senior Software Engineer" oninput="syncLive('p-title','ce-title','title')">
      <div class="frow" style="gap:7px">
        <div><label class="fl">Email</label><input class="fi" id="ce-email" placeholder="you@email.com" oninput="syncLive('p-email','ce-email','email')"></div>
        <div><label class="fl">Phone</label><input class="fi" id="ce-phone" placeholder="+91..." oninput="syncLive('p-phone','ce-phone','phone')"></div>
      </div>
      <div class="frow" style="gap:7px">
        <div><label class="fl">Location</label><input class="fi" id="ce-loc" placeholder="City, Country" oninput="syncLive('p-loc','ce-loc','location')"></div>
        <div><label class="fl">LinkedIn</label><input class="fi" id="ce-li" placeholder="linkedin.com/in/..." oninput="syncLive('p-li','ce-li','linkedin')"></div>
      </div>
      <label class="fl">Professional Summary</label>
      <textarea class="fi" id="ce-summary" rows="5" placeholder="Write your professional summary hereâ€¦ edits appear in preview instantly." oninput="syncLiveTA('p-summary','ce-summary');inlGram(this)"></textarea>
      <!-- SKILLS quick-add -->
      <label class="fl">Add Skills (comma separated)</label>
      <div style="display:flex;gap:6px;margin-bottom:10px">
        <input class="fi" id="ce-skills-inp" placeholder="React, Node.js, Pythonâ€¦" style="margin-bottom:0;flex:1">
        <button class="fs-btn" style="width:auto;padding:0 12px;font-size:11px;font-weight:700;color:var(--caramel);white-space:nowrap" onclick="custAddSkills()"><i class="fas fa-plus"></i> Add</button>
      </div>
      <button class="btn-a" onclick="syncAllCustFields()"><i class="fas fa-eye"></i> Refresh Preview</button>
    </div>

    <!-- TEMPLATE CHANGE (inline, with preview labels) -->
    <div class="cust-sec">
      <div class="cust-sec-t"><i class="fas fa-th-large"></i> Change Template <span style="font-size:9px;font-weight:600;color:var(--sage);margin-left:6px;text-transform:none;letter-spacing:0">Â· Click to switch instantly</span></div>
      <div id="cust-tmpl-grid" style="display:grid;grid-template-columns:1fr 1fr;gap:6px;margin-bottom:6px">
        <!-- filled by JS -->
      </div>
      <button class="btn-a" onclick="showSec('design',document.querySelector('.st[onclick*=design]'))"><i class="fas fa-arrow-right"></i> Browse All 70+ Templates</button>
    </div>

    <!-- COLORS & FONT -->
    <div class="cust-sec">
      <div class="cust-sec-t"><i class="fas fa-fill-drip"></i> Colors &amp; Typography</div>
      <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;margin-bottom:12px">
        <div style="text-align:center">
          <input type="color" id="cust-cc-hdr" value="#1a1a2e" onchange="custApplyC()" style="width:100%;height:38px;border-radius:8px;cursor:pointer;border:2px solid var(--sand);padding:2px">
          <div style="font-size:9px;font-weight:700;color:var(--brown);margin-top:4px;text-transform:uppercase;letter-spacing:.4px">Header</div>
        </div>
        <div style="text-align:center">
          <input type="color" id="cust-cc-acc" value="#d4a853" onchange="custApplyC()" style="width:100%;height:38px;border-radius:8px;cursor:pointer;border:2px solid var(--sand);padding:2px">
          <div style="font-size:9px;font-weight:700;color:var(--brown);margin-top:4px;text-transform:uppercase;letter-spacing:.4px">Accent</div>
        </div>
        <div style="text-align:center">
          <input type="color" id="cust-cc-bg" value="#ffffff" onchange="custApplyC()" style="width:100%;height:38px;border-radius:8px;cursor:pointer;border:2px solid var(--sand);padding:2px">
          <div style="font-size:9px;font-weight:700;color:var(--brown);margin-top:4px;text-transform:uppercase;letter-spacing:.4px">BG</div>
        </div>
      </div>
      <label class="fl">Font Family</label>
      <select class="fsel" id="cust-font-sel" onchange="custApplyFont()">
        <option value="'DM Sans',sans-serif">DM Sans â€” Clean Modern</option>
        <option value="'Cormorant Garamond',serif">Cormorant Garamond â€” Elegant</option>
        <option value="'Playfair Display',serif">Playfair Display â€” Editorial</option>
        <option value="'Raleway',sans-serif">Raleway â€” Professional</option>
        <option value="'Josefin Sans',sans-serif">Josefin Sans â€” Geometric</option>
        <option value="'Lora',serif">Lora â€” Literary</option>
        <option value="'Poppins',sans-serif">Poppins â€” Contemporary</option>
        <option value="'Merriweather',serif">Merriweather â€” Readable</option>
        <option value="'EB Garamond',serif">EB Garamond â€” Classic</option>
        <option value="Georgia,serif">Georgia â€” Trustworthy</option>
        <option value="'Times New Roman',serif">Times New Roman â€” Formal</option>
        <option value="Verdana,sans-serif">Verdana â€” High Legibility</option>
      </select>
      <label class="fl">Font Size</label>
      <div style="display:flex;align-items:center;gap:10px;margin-bottom:10px">
        <button class="fs-btn" onclick="chFS(-1)">âˆ’</button>
        <div style="flex:1;height:4px;background:var(--sand);border-radius:2px">
          <div id="fs-track" style="height:100%;background:linear-gradient(90deg,var(--caramel),var(--gold));border-radius:2px;width:40%;transition:.3s"></div>
        </div>
        <span style="font-size:12px;font-weight:700;color:var(--dark);min-width:30px;text-align:center" id="cust-fs-val">14px</span>
        <button class="fs-btn" onclick="chFS(1)">+</button>
      </div>
    </div>

    <!-- STARTER PROFILES -->
    <div class="cust-sec">
      <div class="cust-sec-t"><i class="fas fa-magic"></i> Load Starter Profile</div>
      <div style="font-size:11px;color:var(--brown);margin-bottom:9px">Jump-start with a pre-filled example:</div>
      <div class="ph-grid">
        <div class="ph-opt" onclick="loadPlaceholder('software')"><div class="ph-icon">ðŸ’»</div><div class="ph-nm">Software Dev</div><div class="ph-ds">Full-stack</div></div>
        <div class="ph-opt" onclick="loadPlaceholder('designer')"><div class="ph-icon">ðŸŽ¨</div><div class="ph-nm">UI/UX Designer</div><div class="ph-ds">Creative</div></div>
        <div class="ph-opt" onclick="loadPlaceholder('data')"><div class="ph-icon">ðŸ“Š</div><div class="ph-nm">Data Scientist</div><div class="ph-ds">Analytics</div></div>
        <div class="ph-opt" onclick="loadPlaceholder('manager')"><div class="ph-icon">ðŸ‘”</div><div class="ph-nm">Manager</div><div class="ph-ds">Executive</div></div>
        <div class="ph-opt" onclick="loadPlaceholder('fresher')"><div class="ph-icon">ðŸŽ“</div><div class="ph-nm">Fresher</div><div class="ph-ds">Entry-level</div></div>
        <div class="ph-opt" onclick="loadPlaceholder('marketing')"><div class="ph-icon">ðŸ“£</div><div class="ph-nm">Marketing</div><div class="ph-ds">Growth</div></div>
      </div>
    </div>
  </div>
  <!-- COURSES -->
  <div id="ss-courses" class="ss">
    <div class="ss-title">Courses &amp; Resources</div><div class="ss-desc" id="course-desc">Curated for your field</div>
    <div id="course-list"></div>
    <div class="fl" style="margin-top:13px;margin-bottom:7px">ðŸš€ Internship Platforms</div><div id="intern-plat"></div>
  </div>
  </div><!-- /sb-content -->
</aside>
<!-- DRAG HANDLE -->
<div class="drag-h" id="dragHandle" title="Drag to resize panels"></div>
<!-- PREVIEW -->
<main class="preview-area" id="previewPanel">
  <div class="prev-h">
    <div class="prev-t">Live Preview</div>
    <div class="rsz-bar" id="rszBar">
      <button class="rsz-btn" id="rsz40" onclick="setLayout(40)" title="Sidebar wider"><i class="fas fa-angle-left"></i><i class="fas fa-angle-left"></i></button>
      <button class="rsz-btn active" id="rsz50" onclick="setLayout(50)" title="Equal split"><i class="fas fa-columns"></i></button>
      <button class="rsz-btn" id="rsz30" onclick="setLayout(30)" title="Preview wider"><i class="fas fa-angle-right"></i><i class="fas fa-angle-right"></i></button>
      <button class="rsz-btn" id="rsz0"  onclick="setLayout(0)"  title="Hide sidebar"><i class="fas fa-expand"></i></button>
      <button class="rsz-btn" id="rsz100" onclick="setLayout(100)" title="Full sidebar"><i class="fas fa-compress"></i></button>
    </div>
    <div class="prev-a">
      <button class="bdl out" onclick="goViz()" data-tooltip="View full resume analytics"><i class="fas fa-chart-pie"></i> Analytics</button>
      <button class="bdl" onclick="dlPDF()" data-tooltip="Download resume as PDF"><i class="fas fa-file-pdf"></i> Export PDF</button>
    </div>
  </div>
  <div class="r-frame"><div id="resumeDoc"></div></div>
</main>
</div>
<footer class="app-ft">
  <div class="ft-l">Ely<em>ssor</em> Â· Professional Resume Builder Â· v3.0</div>
  <div class="ft-r"><button class="ft-lnk" onclick="showScreen('subScreen')" data-tooltip="View pricing plans">Upgrade Plan</button><button class="ft-lnk" onclick="showScreen('recruiterScreen')" data-tooltip="Recruiter resume analyzer">Recruiter Portal</button><button class="ft-lnk" onclick="goViz()" data-tooltip="Charts & resume score">Full Analytics</button><button class="ft-lnk" onclick="startTour()" data-tooltip="Take the guided tour">Help</button></div>
</footer>
<div id="quickActions">
  <button class="qa-fab" id="qa-toggle" data-tooltip="Quick actions"><i class="fas fa-bolt"></i></button>
  <div class="qa-panel" id="qa-panel">
    <button class="qa-btn" data-action="form"><i class="fas fa-pen"></i> Edit Form</button>
    <button class="qa-btn" data-action="preview"><i class="fas fa-file-lines"></i> Preview</button>
    <button class="qa-btn" data-action="save"><i class="fas fa-save"></i> Save Progress</button>
    <button class="qa-btn" data-action="pdf"><i class="fas fa-file-pdf"></i> Export PDF</button>
    <button class="qa-btn" data-action="tour"><i class="fas fa-route"></i> Take Tour</button>
  </div>
</div>
<!-- â•â•â• MOBILE BOTTOM NAV BAR â•â•â• -->
<nav class="mob-nav" id="mobNav">
  <button class="mob-nav-btn active" id="mnEdit" onclick="setMobileView('form')"><i class="fas fa-pen-to-square"></i><span>Edit</span></button>
  <button class="mob-nav-btn" id="mnPreview" onclick="setMobileView('preview')"><i class="fas fa-eye"></i><span>Preview</span></button>
  <button class="mob-nav-btn" id="mnSidebar" onclick="jQuery('#appScreen').toggleClass('sb-open')"><i class="fas fa-bars"></i><span>Sections</span></button>
  <button class="mob-nav-btn" id="mnSave" onclick="autoSave()"><i class="fas fa-save"></i><span>Save</span></button>
  <button class="mob-nav-btn" id="mnExport" onclick="dlPDF()"><i class="fas fa-download"></i><span>Export</span></button>
</nav>
<!-- COMMAND PALETTE -->
<div id="cmdPalette">
  <div class="cmd-box">
    <div class="cmd-search-wrap"><i class="fas fa-search"></i><input class="cmd-search-input" id="cmdInput" placeholder="Type a command or search..." autocomplete="off"><span class="cmd-kbd">ESC</span></div>
    <div class="cmd-list" id="cmdList"></div>
    <div class="cmd-footer"><span><kbd>â†‘â†“</kbd> navigate</span><span><kbd>â†µ</kbd> select</span><span><kbd>Esc</kbd> close</span></div>
  </div>
</div>
<!-- KEYBOARD HINT -->
<div class="kb-hint" id="kbHint" onclick="openCmdPalette()" data-tooltip="Keyboard shortcuts"><i class="fas fa-keyboard"></i><span>Ctrl+K</span></div>
<!-- CONFETTI CONTAINER -->
<div class="confetti-container" id="confettiBox"></div>
<!-- â•â•â• GUIDED TOUR SYSTEM â€” REBUILT â•â•â• -->
<div class="tour-backdrop" id="tourBackdrop"></div>
<div class="tour-spotlight" id="tourSpotlight" style="display:none"></div>
<div class="tour-dialog" id="tourDialog">
  <div class="tour-dialog-hd">
    <div class="tour-dialog-ico" id="tourIco"><i class="fas fa-route"></i></div>
    <div>
      <div class="tour-dialog-step" id="tourStep">Step 1 of 8</div>
      <div class="tour-dialog-title" id="tourTitle">Welcome</div>
    </div>
  </div>
  <div class="tour-dialog-body" id="tourBody">Let's get started.</div>
  <div class="tour-dialog-progress"><div class="tour-dialog-progress-fill" id="tourProgress" style="width:0%"></div></div>
  <div class="tour-dialog-ft">
    <button class="t-skip" id="tourSkip">Skip Tour</button>
    <div class="t-btns">
      <button class="t-back" id="tourBack" disabled><i class="fas fa-arrow-left"></i> Back</button>
      <button class="t-next" id="tourNext">Next <i class="fas fa-arrow-right"></i></button>
    </div>
  </div>
</div>
</div>

<!-- RECRUITER SCREEN -->
<div id="recruiterScreen" class="screen">
<header class="app-hdr">
  <div class="brand">Ely<em>ssor</em> <span style="font-size:11px;color:rgba(253,246,236,.38);font-weight:400">Â· Recruiter</span></div>
  <div class="hd-r"><button class="hbtn ol" onclick="goBack()"><i class="fas fa-arrow-left"></i> Back</button><button class="hbtn dg" onclick="doLogout()"><i class="fas fa-sign-out-alt"></i> Logout</button></div>
</header>
<div class="rec-body">
  <div class="rec-sb">
    <div style="font-family:'Cormorant Garamond',serif;font-size:20px;font-weight:700;color:var(--dark);margin-bottom:3px">Analysis Mode</div>
    <div style="font-size:11px;color:var(--brown);margin-bottom:13px">Choose your analysis type</div>
    <div id="rm-strong" class="sug ok" style="cursor:pointer;padding:11px 12px;margin-bottom:7px" onclick="selRM('strong')">
      <div class="sug-t">ðŸŽ¯ Strong Analysis</div>
      <div style="font-size:11px;color:var(--dark)">Deep keyword &amp; skills match for a <strong>specific role</strong>.</div>
    </div>
    <div id="rm-blank" class="sug" style="cursor:pointer;padding:11px 12px" onclick="selRM('blank')">
      <div class="sug-t">ðŸ” Domain Analysis</div>
      <div style="font-size:11px;color:var(--dark)">Check if resume suits an <strong>industry/domain</strong>.</div>
    </div>
    <div style="margin-top:15px">
      <label class="fl">Hiring for Role</label><input class="fi" id="rec-role" placeholder="e.g. Senior React Developer">
      <label class="fl">Experience Level</label>
      <select class="fsel" id="rec-exp"><option>Any Level</option><option>0-1 Years (Entry)</option><option>2-4 Years (Mid)</option><option>5+ Years (Senior)</option><option>8+ Years (Lead)</option></select>
      <label class="fl">Industry / Domain</label><input class="fi" id="rec-domain" placeholder="e.g. FinTech, Healthcare">
      <label class="fl">Required Skills (comma-separated)</label><input class="fi" id="rec-skills" placeholder="React, Node.js, AWS">
      <label class="fl">Nice-to-have Skills</label><input class="fi" id="rec-nice-skills" placeholder="Docker, GraphQL, Redis">
      <label class="fl">Min. Education Level</label>
      <select class="fsel" id="rec-edu-req"><option>Any</option><option>High School</option><option>Bachelor's Degree</option><option>Master's Degree</option><option>PhD</option></select>
    </div>
  </div>
  <div class="rec-m">
    <div class="a-card">
      <div class="a-t">Upload Candidate Resume</div><div class="a-s">AI-powered analysis against your requirements</div>
      <div class="rec-up" onclick="document.getElementById('rec-file').click()">
        <i class="fas fa-cloud-upload-alt" style="font-size:34px;color:var(--sand);display:block;margin-bottom:7px"></i>
        <div style="font-weight:700;font-size:13px;color:var(--dark);margin-bottom:2px">Drop or Click to Upload</div>
        <div style="font-size:11px;color:var(--brown)">PDF, DOC, TXT supported</div>
        <input type="file" id="rec-file" style="display:none" accept=".pdf,.doc,.txt" onchange="showToast('Resume uploaded â€” click Run Analysis')">
      </div>
      <button class="btn-p" style="width:auto;padding:10px 22px" onclick="runRecA()"><i class="fas fa-search"></i> Run Analysis</button>
    </div>
    <div id="rec-results" style="display:none">
      <div class="a-card">
        <div class="a-t" id="rec-res-title">Analysis Results</div>
        <div class="a-s" id="rec-res-sub"></div>
        <div id="rec-bars" style="margin-top:11px"></div>
      </div>
      <div class="rec-charts-grid">
        <div class="rec-chart-card"><div class="rec-chart-title"><i class="fas fa-spider"></i> Skills Radar</div><canvas id="rec-radar" height="190"></canvas></div>
        <div class="rec-chart-card"><div class="rec-chart-title"><i class="fas fa-chart-pie"></i> Skill Coverage Pie</div><canvas id="rec-pie" height="190"></canvas></div>
        <div class="rec-chart-card"><div class="rec-chart-title"><i class="fas fa-chart-bar"></i> Category Breakdown</div><canvas id="rec-bar" height="190"></canvas></div>
        <div class="rec-chart-card"><div class="rec-chart-title"><i class="fas fa-th"></i> Requirement Matrix</div><div id="rec-matrix" style="overflow-y:auto;max-height:190px"></div></div>
      </div>
      <div class="miss-wrap">
        <div class="miss-title">âš ï¸ Missing Required Skills</div>
        <div id="rec-missing-skills"><span style="font-size:11px;color:var(--brown);font-style:italic">Run analysis to see missing skills</span></div>
      </div>
      <div class="match-wrap">
        <div class="match-title">âœ… Matched Skills Found</div>
        <div id="rec-matching-skills"><span style="font-size:11px;color:var(--brown);font-style:italic">Run analysis to see matches</span></div>
      </div>
      <div class="a-card">
        <div class="a-t">Candidate Resume Preview</div>
        <div class="a-s">Full resume as submitted</div>
        <div id="rec-resume-preview" style="background:#f9f9f7;border:1px solid var(--sand);border-radius:8px;padding:16px;min-height:120px;font-size:12px;line-height:1.7;color:var(--dark)">
          <span style="color:var(--brown);font-style:italic">Upload a resume to preview it here</span>
        </div>
      </div>
      <div id="rec-verdict" style="margin-top:11px"></div>
      <div id="rec-findings" style="display:none"></div>
    </div>
  </div>
</div>
<footer class="app-ft"><div class="ft-l">Ely<em>ssor</em> Â· Recruiter Portal</div><div class="ft-r"><button class="ft-lnk" onclick="goBack()">â† Back to Builder</button></div></footer>
</div>

<!-- SUBSCRIPTION SCREEN -->
<div id="subScreen" class="screen">
<header class="app-hdr"><div class="brand">Ely<em>ssor</em></div><div class="hd-r"><button class="hbtn ol" onclick="goBack()"><i class="fas fa-arrow-left"></i> Back</button><button class="hbtn dg" onclick="doLogout()"><i class="fas fa-sign-out-alt"></i> Logout</button></div></header>
<div class="sub-hero"><h1>Choose Your Plan</h1><p>Invest in your career. Start free, upgrade when ready.</p></div>
<div class="plans-g">
  <div class="plan-c">
    <div class="plan-nm">Free</div><div class="plan-pr">$0<span>/forever</span></div><div class="plan-dc">Perfect for getting started with core features.</div>
    <ul class="plan-fs"><li class="inc"><i class="fas fa-check"></i> 5 Basic Templates</li><li class="inc"><i class="fas fa-check"></i> PDF Export</li><li class="inc"><i class="fas fa-check"></i> ATS Score (Basic)</li><li class="inc"><i class="fas fa-check"></i> 5 Grammar Fixes/month</li><li class="inc"><i class="fas fa-check"></i> Chinko AI Bot</li><li class="exc"><i class="fas fa-times"></i> Advanced Templates</li><li class="exc"><i class="fas fa-times"></i> Unlimited Grammar</li><li class="exc"><i class="fas fa-times"></i> Recruiter Analytics</li></ul>
    <button class="plan-btn fb" onclick="setPlan('free')">Current Plan</button>
  </div>
  <div class="plan-c pop">
    <div class="plan-bg">Most Popular</div>
    <div class="plan-nm">Pro</div><div class="plan-pr">$9<span>/month</span></div><div class="plan-dc">Everything a serious job seeker needs.</div>
    <ul class="plan-fs"><li class="inc"><i class="fas fa-check"></i> 40+ Pro Templates</li><li class="inc"><i class="fas fa-check"></i> Unlimited Grammar Check</li><li class="inc"><i class="fas fa-check"></i> ATS Deep Scan</li><li class="inc"><i class="fas fa-check"></i> AI Summary Generator</li><li class="inc"><i class="fas fa-check"></i> 55 Font Options</li><li class="inc"><i class="fas fa-check"></i> Custom Color Palettes</li><li class="inc"><i class="fas fa-check"></i> File Upload Analysis</li><li class="exc"><i class="fas fa-times"></i> Recruiter Dashboard</li></ul>
    <button class="plan-btn pb" onclick="setPlan('pro')"><i class="fas fa-crown"></i> Upgrade to Pro</button>
  </div>
  <div class="plan-c">
    <div class="plan-nm">Premium</div><div class="plan-pr">$19<span>/month</span></div><div class="plan-dc">Complete career acceleration suite.</div>
    <ul class="plan-fs"><li class="inc"><i class="fas fa-check"></i> All 70+ Templates</li><li class="inc"><i class="fas fa-check"></i> Everything in Pro</li><li class="inc"><i class="fas fa-check"></i> Recruiter Portal</li><li class="inc"><i class="fas fa-check"></i> Full Visualization</li><li class="inc"><i class="fas fa-check"></i> LinkedIn Optimization</li><li class="inc"><i class="fas fa-check"></i> Cover Letter Builder</li><li class="inc"><i class="fas fa-check"></i> Interview Prep AI</li><li class="inc"><i class="fas fa-check"></i> Priority Support</li></ul>
    <button class="plan-btn prb" onclick="setPlan('premium')"><i class="fas fa-star"></i> Go Premium</button>
  </div>
</div>
<footer class="app-ft"><div class="ft-l">Ely<em>ssor</em> Â· 14-day money-back guarantee</div><div class="ft-r"><button class="ft-lnk" onclick="goBack()">â† Back</button></div></footer>
</div>

<!-- VISUALIZATION SCREEN -->
<div id="vizScreen" class="screen">
<header class="app-hdr">
  <div class="brand">Ely<em>ssor</em> <span style="font-size:11px;color:rgba(253,246,236,.38);font-weight:400">Â· Analytics</span></div>
  <div class="hd-r"><button class="hbtn gd" onclick="dlPDF()"><i class="fas fa-file-pdf"></i> Export</button><button class="hbtn ol" onclick="goBack()"><i class="fas fa-arrow-left"></i> Back</button></div>
</header>
<div class="viz-b">
  <div class="viz-t" id="viz-name">Resume Analytics Dashboard</div>
  <div class="viz-s">Complete AI-powered analysis of your resume strength and career readiness</div>
  <div class="viz-g" id="viz-g"></div>
  <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:16px;margin-bottom:20px">
    <div style="background:var(--white);border-radius:12px;padding:16px;border:1.5px solid var(--sand);box-shadow:0 2px 8px rgba(61,35,20,.07)">
      <div style="font-family:'Cormorant Garamond',serif;font-size:16px;font-weight:700;color:var(--dark);margin-bottom:10px"><i class="fas fa-chart-bar" style="color:var(--caramel)"></i> Section Strength</div>
      <canvas id="viz-main" height="180"></canvas>
    </div>
    <div style="background:var(--white);border-radius:12px;padding:16px;border:1.5px solid var(--sand);box-shadow:0 2px 8px rgba(61,35,20,.07)">
      <div style="font-family:'Cormorant Garamond',serif;font-size:16px;font-weight:700;color:var(--dark);margin-bottom:10px"><i class="fas fa-chart-pie" style="color:var(--caramel)"></i> Skills Distribution</div>
      <canvas id="viz-skills-pie" height="180"></canvas>
    </div>
    <div style="background:var(--white);border-radius:12px;padding:16px;border:1.5px solid var(--sand);box-shadow:0 2px 8px rgba(61,35,20,.07)">
      <div style="font-family:'Cormorant Garamond',serif;font-size:16px;font-weight:700;color:var(--dark);margin-bottom:10px"><i class="fas fa-user-graduate" style="color:#B8732A"></i> Student vs Professional</div>
      <canvas id="viz-profile-pie" height="180"></canvas>
    </div>
  </div>
  <div style="background:var(--white);border-radius:12px;padding:18px;box-shadow:0 3px 13px var(--sw);margin-bottom:16px">
    <div style="font-family:'Cormorant Garamond',serif;font-size:19px;font-weight:700;color:var(--dark);margin-bottom:13px"><i class="fas fa-chart-bar" style="color:var(--caramel)"></i> Section-by-Section Analysis</div>
    <canvas id="viz-main" height="88"></canvas>
  </div>
  <div style="background:var(--white);border-radius:12px;padding:18px;box-shadow:0 3px 13px var(--sw)">
    <div style="font-family:'Cormorant Garamond',serif;font-size:19px;font-weight:700;color:var(--dark);margin-bottom:3px"><i class="fas fa-trophy" style="color:var(--gold)"></i> Final Resume Score</div>
    <div style="font-size:12px;color:var(--brown);margin-bottom:16px">Based on completeness, ATS compatibility, and industry standards</div>
    <div id="viz-final"></div>
  </div>
</div>
<footer class="app-ft"><div class="ft-l">Ely<em>ssor</em> Â· Resume Intelligence Dashboard</div><div class="ft-r"><button class="ft-lnk" onclick="goBack()">â† Back to Builder</button></div></footer>
</div>

<!-- MODAL -->
<div id="entryModal" class="modal">
  <div class="mbox">
    <button class="mb-k" onclick="closeMod()"><i class="fas fa-arrow-left"></i></button>
    <div class="mt" id="m-title">Add Entry</div>
    <div id="m-body"></div>
    <div class="mac"><button class="mcl" onclick="closeMod()">Cancel</button><button class="msv" onclick="saveMod()"><i class="fas fa-check"></i> Save</button></div>
  </div>
</div>

<!-- CHINKO BOT -->
<button id="chinkoBtn" onclick="toggleChinko()">ðŸ¤–</button>
<div id="chinkoPanel">
  <div class="ch-hd"><div class="ch-av">ðŸ¤–</div><div><div class="ch-nm">Chinko</div><div class="ch-st">â— AI Resume Guide â€” Always here</div></div><button class="ch-cls" onclick="toggleChinko()"><i class="fas fa-times"></i></button></div>
  <div class="ch-msgs" id="ch-msgs"></div>
  <div class="ch-qr" id="ch-qr"></div>
  <div class="ch-ir"><input class="ch-in" id="ch-inp" placeholder="Ask Chinko anything..." onkeydown="if(event.key==='Enter')sendChinko()"><button class="ch-snd" onclick="sendChinko()"><i class="fas fa-paper-plane"></i></button></div>
</div>
<script>
// ============ ELYSSOR v2 â€” COMPLETE APP ENGINE ============
const A={
  user:null,userType:'student',field:'',plan:'free',isRec:false,
  tmpl:'t01',font:"'DM Sans',sans-serif",fontSize:14,lineSpacing:1.5,
  acH:'#1a1a2e',acA:'#d4a853',acT:'#1a1a1a',acBG:'#ffffff',align:'left',
  personal:{},summary:'',exp:[],edu:[],skills:{tech:[],prof:[],tools:[],fw:[]},
  certs:[],proj:[],intern:[],customText:'',gramUsed:0,recMode:'strong',
  chartRefs:{},elems:[],fs:14
};

// ---- UTILS ----
const $=id=>document.getElementById(id);
function showToast(msg,d=2600){const t=$('toast');t.textContent=msg;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),d);}
function v(id){const e=$(id);return e?e.value.trim():'';}
function sv(id,val){const e=$(id);if(e&&val!==undefined)e.value=val;}

// ---- SCREENS ----
const SCREENS=['authScreen','appScreen','recruiterScreen','subScreen','vizScreen'];
function showScreen(id){
  SCREENS.forEach(s=>{const el=$(s);if(el){el.className='screen'+(s===id?' active':'');}});
  if(id==='vizScreen')setTimeout(buildViz,200);
}
function goBack(){showScreen(A.isRec?'recruiterScreen':'appScreen');}
function goViz(){showScreen('vizScreen');}
function toggleSDD(){$('saveDD').classList.toggle('on');}
document.addEventListener('click',e=>{if(!e.target.closest('#saveDD'))$('saveDD')?.classList.remove('on');});

// ---- PERSISTENT AUTH BACKEND (localStorage as encrypted DB) ----
const DB={
  _k:'elyssor_users_db_v3',
  hash(p){return btoa(unescape(encodeURIComponent(p.split('').map((c,i)=>String.fromCharCode(c.charCodeAt(0)^((i*7+13)%97))).join(''))));},
  get(){try{return JSON.parse(localStorage.getItem(this._k)||'{}')}catch(e){return{}}},
  save(u){localStorage.setItem(this._k,JSON.stringify(u));},
  createUser(d){const u=this.get(),k=d.email.toLowerCase();if(u[k])return{error:'Email already registered'};u[k]={...d,password:this.hash(d.password),id:'u_'+Date.now(),plan:'free',createdAt:new Date().toISOString()};this.save(u);return{ok:true,user:u[k]};},
  verify(email,pass){const u=this.get(),k=email.toLowerCase(),user=u[k];if(!user)return{error:'No account found. Please sign up first!'};if(user.oauthProvider)return{ok:true,user};if(user.password!==this.hash(pass))return{error:'Incorrect password.'};return{ok:true,user};},
  oauthUser(provider,name,email){const u=this.get(),k=email.toLowerCase();if(!u[k])u[k]={name,email:k,password:null,oauthProvider:provider,userType:'professional',field:'',plan:'free',id:'u_'+Date.now()};else u[k].oauthProvider=provider;this.save(u);return{ok:true,user:u[k]};},
  getSession(){try{return JSON.parse(sessionStorage.getItem('elyssor_sess')||'null')}catch(e){return null;}},
  setSession(u){sessionStorage.setItem('elyssor_sess',JSON.stringify({...u,password:'[secure]'}));},
  clearSession(){sessionStorage.removeItem('elyssor_sess');},
  getResume(uid){try{return JSON.parse(localStorage.getItem('elyssor_resume_'+uid)||'null')}catch(e){return null;}},
  saveResume(uid,d){localStorage.setItem('elyssor_resume_'+uid,JSON.stringify(d));}
};

let _ut='student';
function selUT(el,t){_ut=t;document.querySelectorAll('.utype').forEach(u=>u.classList.remove('sel'));el.classList.add('sel');}
function showATab(tab){
  ['login','signup','recruiter'].forEach(t=>{$('af-'+t)?.classList.toggle('on',t===tab);$('abt-'+t)?.classList.toggle('on',t===tab);});
}
function oauthLogin(provider){
  showToast('Connecting to '+(provider==='google'?'Google':'GitHub')+'...', 1400);
  setTimeout(()=>{
    const info={google:{name:'Demo Google User',email:'demo.google@gmail.com'},github:{name:'Demo GitHub User',email:'demo.github@users.noreply.github.com'}};
    const r=DB.oauthUser(provider,info[provider].name,info[provider].email);
    A.user=r.user;A.userType=r.user.userType||'professional';A.field=r.user.field||'';A.plan=r.user.plan||'free';A.isRec=false;
    DB.setSession(r.user);loadState();launchApp();showToast('Signed in with '+(provider==='google'?'Google':'GitHub')+'! âœ“');
  },1100);
}
function oauthSignup(p){oauthLogin(p);}
function doLogin(){
  const email=v('li-email'),pass=v('li-pass');
  if(!email||!pass){showToast('Please fill all fields');return;}
  const r=DB.verify(email,pass);
  if(r.error){showToast('âš  '+r.error);return;}
  A.user=r.user;A.userType=r.user.userType||'student';A.field=r.user.field||'';A.plan=r.user.plan||'free';A.isRec=false;
  DB.setSession(r.user);loadState();launchApp();showToast('Welcome back, '+(r.user.name?.split(' ')[0]||'there')+'! ðŸ‘‹');
}
function doSignup(){
  const name=v('su-name'),email=v('su-email'),pass=v('su-pass'),field=v('su-field');
  if(!name){showToast('Enter your name');return;}
  if(!email||!email.includes('@')){showToast('Enter a valid email');return;}
  if(pass.length<6){showToast('Password must be 6+ chars');return;}
  const r=DB.createUser({name,email,password:pass,userType:_ut,field,oauthProvider:null});
  if(r.error){showToast('âš  '+r.error);return;}
  A.user=r.user;A.userType=_ut;A.field=field;A.plan='free';A.isRec=false;
  DB.setSession(r.user);A.personal={name};launchApp();showToast('Welcome to Elyssor, '+name.split(' ')[0]+'! ðŸš€');
}
function doRecLogin(){
  const email=v('re-email'),company=v('re-company'),pass=v('re-pass');
  if(!email||!company||!pass){showToast('Please fill all fields');return;}
  let r=DB.createUser({name:company+' Recruiter',email,password:pass,userType:'recruiter',field:'Recruiting',oauthProvider:null});
  if(r.error)r=DB.verify(email,pass);
  if(r.error){showToast('âš  '+r.error);return;}
  A.user={name:company+' Recruiter',email,company,id:'rec_'+Date.now()};A.isRec=true;
  DB.setSession(A.user);showScreen('recruiterScreen');showToast('Welcome, '+company+'! ðŸŽ¯');
}
function goGuest(){A.user={name:'Guest',userType:'student',field:'',id:'guest',plan:'free'};A.userType='student';A.plan='free';A.isRec=false;launchApp();}
function doLogout(){if(A.user?.id&&A.user.id!=='guest')DB.saveResume(A.user.id,getState());DB.clearSession();A.user=null;A.isRec=false;showScreen('authScreen');showToast('Logged out');}
function setPlan(p){
  A.plan=p;
  if(A.user?.email){const u=DB.get(),k=A.user.email.toLowerCase();if(u[k]){u[k].plan=p;DB.save(u);}}
  const b=$('sub-badge');if(b){b.textContent=p.toUpperCase();b.className='sbadge '+p;}
  showToast('Switched to '+p.charAt(0).toUpperCase()+p.slice(1)+' plan! âœ¨');goBack();
}

// ---- LAUNCH ----
// â”€â”€ STORAGE with per-user resume â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function getState(){return{personal:A.personal,summary:A.summary,exp:A.exp,edu:A.edu,skills:A.skills,certs:A.certs,proj:A.proj,intern:A.intern,customText:A.customText,photoData:A.photoData,tmpl:A.tmpl,font:A.font,fs:A.fs,acH:A.acH,acA:A.acA,acT:A.acT,acBG:A.acBG,lineSpacing:A.lineSpacing,align:A.align};}

function launchApp(){
  showScreen('appScreen');
  const init=(A.user?.name||'G').split(' ').map(w=>w[0]||'').join('').toUpperCase().slice(0,2);
  const avEl=$('av-el');if(avEl)avEl.textContent=init;
  const hu=$('hd-user');if(hu)hu.textContent=A.user?.name||'';
  const b=$('sub-badge');if(b){b.textContent=(A.plan||'free').toUpperCase();b.className='sbadge '+(A.plan||'free');}
  populateF();buildTmpl();buildFontG();buildPalG();buildElems();
  renderAllLists();renderSkChips();updSug();renderCourses();
  liveUp();updATS();updComp();syncCustFieldsFromMain();setTimeout(buildCharts,400);
  setTimeout(initDragResize, 100);
  renderResumeDD();loadTheme();
  // initial snapshot for undo
  setTimeout(()=>{_undoStack.length=0;_undoStack.push(JSON.stringify(getState()));updUndoRedoBtns();},200);
  // init char counter
  updCharCounter('p-summary','sumCharCount',150,300);
  setTimeout(()=>{
    const fn=(A.user?.name||'there').split(' ')[0];
    const isStu=A.userType==='student';
    addBot('ðŸ‘‹ Hi <strong>'+fn+'</strong>! I\'m <strong>Chinko</strong>, your Elyssor AI guide!<br><br>'+(isStu?'As a <strong>student/fresher</strong>, I\'ll give you tailored tips to make your resume shine â€” internships, projects, entry-level keywords.':'As a <strong>professional</strong>, I\'ll help you craft a senior-level resume that commands attention â€” leadership, metrics, executive presence.')+'<br><br>What would you like help with?');
    setQR(['How to improve ATS score?',isStu?'Best tips for freshers':'How to show leadership?','What is ATS?','Help me write a summary','Which template should I use?','What skills am I missing?']);
  },800);
  setTimeout(()=>{showTourIfFirstLogin();},900);
}

// ---- SIDEBAR ----
function showSec(id,btn){
  document.querySelectorAll('.ss').forEach(s=>s.classList.remove('on'));
  document.querySelectorAll('#sb-rail .st').forEach(t=>t.classList.remove('on'));
  const sec=$('ss-'+id);if(sec)sec.classList.add('on');
  if(btn)btn.classList.add('on');
  // scroll content panel to top
  const sc=$('sb-content');if(sc)sc.scrollTop=0;
  if(id==='analysis'){updATS();buildSugs();buildCharts();}
  if(id==='customization'){syncCustFieldsFromMain();}
}

// ---- FIELDS ----
function populateF(){
  const p=A.personal;
  sv('p-name',p.name);sv('p-title',p.title);sv('p-email',p.email);sv('p-phone',p.phone);
  sv('p-loc',p.location);sv('p-nat',p.nationality);sv('p-li',p.linkedin);
  sv('p-gh',p.github);sv('p-web',p.website);sv('p-target',p.targetRole);
  sv('p-summary',A.summary);sv('custom-text',A.customText);
}
function liveUp(){
  A.personal={name:v('p-name'),title:v('p-title'),email:v('p-email'),phone:v('p-phone'),location:v('p-loc'),nationality:v('p-nat'),linkedin:v('p-li'),github:v('p-gh'),website:v('p-web'),targetRole:v('p-target')};
  A.summary=v('p-summary');A.customText=v('custom-text');
  renderResume();updComp();updQuote();
  pushSnapshot();markUnsaved();checkMilestones();
}

// ---- COMPLETION ----
const pcItems=[
  {k:'name',l:'Name',f:()=>!!A.personal.name},{k:'email',l:'Email',f:()=>!!A.personal.email},
  {k:'title',l:'Title',f:()=>!!A.personal.title},{k:'summary',l:'Summary',f:()=>A.summary.length>50},
  {k:'exp',l:'Work/Intern',f:()=>A.exp.length>0||A.intern.length>0},
  {k:'edu',l:'Education',f:()=>A.edu.length>0},{k:'skills',l:'Skills(5+)',f:()=>allSk().length>=5},
  {k:'contact',l:'Phone',f:()=>!!A.personal.phone},{k:'projects',l:'Projects',f:()=>A.proj.length>0},
];
function updComp(){
  const done=pcItems.filter(i=>i.f()).length,pct=Math.round(done/pcItems.length*100);
  const bar=$('pc-bar'),pctEl=$('pc-pct'),chips=$('pc-chips');
  if(bar)bar.style.width=pct+'%';if(pctEl)pctEl.textContent=pct+'%';
  if(chips)chips.innerHTML=pcItems.map(i=>'<span class="pcc '+(i.f()?'d':'t')+'">'+(i.f()?'âœ“':'+')+'  '+i.l+'</span>').join('');
}
function allSk(){return[...A.skills.tech,...A.skills.prof,...A.skills.tools,...A.skills.fw];}

// ---- ATS ----
function calcATS(){
  const checks=[
    {l:'Name',w:10,has:!!A.personal.name},{l:'Contact',w:10,has:!!A.personal.email&&!!A.personal.phone},
    {l:'Title',w:8,has:!!A.personal.title},{l:'Summary',w:12,has:A.summary.length>50},
    {l:'Experience',w:20,has:A.exp.length>0||A.intern.length>0},
    {l:'Education',w:15,has:A.edu.length>0},{l:'Skills(5+)',w:15,has:allSk().length>=5},
    {l:'Certifications',w:5,has:A.certs.length>0},{l:'Projects',w:5,has:A.proj.length>0},
  ];
  return{score:checks.reduce((s,c)=>s+(c.has?c.w:0),0),checks};
}
function updATS(){
  const{score,checks}=calcATS();
  const ring=$('ats-ring');if(ring)ring.style.background='conic-gradient(#D4A853 '+score*3.6+'deg,rgba(255,255,255,.1) 0deg)';
  const n=$('ats-n');if(n)n.textContent=score;
  const lbl=$('ats-lbl'),sub=$('ats-sub');
  if(lbl){if(score>=85){lbl.textContent='Excellent';sub.textContent='Highly ATS-optimized!';}else if(score>=65){lbl.textContent='Good';sub.textContent='A few improvements needed';}else if(score>=40){lbl.textContent='Average';sub.textContent='Add more sections';}else{lbl.textContent='Needs Work';sub.textContent='Fill in more details';}}
  const bars=$('ats-bars');if(bars)bars.innerHTML=checks.slice(0,5).map(c=>'<div class="ats-br"><div class="ats-bt"><span>'+c.l+'</span><span>'+(c.has?c.w:0)+'/'+c.w+'</span></div><div class="ats-btr"><div class="ats-bfi" style="width:'+(c.has?100:0)+'%;background:'+(c.has?'var(--gold)':'rgba(255,255,255,.18)')+'"></div></div></div>').join('');
}

// ---- SKILL POOLS ----
const SK={
  software:['JavaScript','TypeScript','Python','Java','C++','Go','Node.js','React','Vue.js','Angular','Next.js','GraphQL','REST API','SQL','NoSQL','Docker','Kubernetes','AWS','Azure','GCP','Git','CI/CD','Redis','MongoDB','PostgreSQL','Microservices'],
  data:['Python','R','SQL','Machine Learning','Deep Learning','TensorFlow','PyTorch','Pandas','NumPy','Scikit-learn','Tableau','Power BI','Statistics','Data Visualization','Apache Spark','ETL','A/B Testing','NLP','Computer Vision'],
  design:['Figma','Adobe XD','Sketch','InVision','Prototyping','User Research','Wireframing','UI Design','UX Research','Design Systems','Accessibility','Interaction Design','CSS','HTML','Animation','Usability Testing'],
  marketing:['SEO','SEM','Google Analytics','Content Marketing','Email Marketing','Social Media Marketing','PPC','A/B Testing','HubSpot','Salesforce','Brand Strategy','Market Research','Copywriting','Growth Hacking','Marketing Automation'],
  finance:['Financial Modeling','Excel','Bloomberg','SAP','QuickBooks','Financial Analysis','Risk Management','Investment Analysis','Accounting','Taxation','Auditing','Valuation','Equity Research','Portfolio Management'],
  management:['Project Management','Agile','Scrum','JIRA','Leadership','Strategic Planning','Stakeholder Management','Risk Management','Budget Management','OKRs','Cross-functional Teams','Change Management','Process Optimization'],
  fresher:['Microsoft Office','Google Workspace','Problem Solving','Communication','Teamwork','Adaptability','Research','Presentation Skills','Critical Thinking','Time Management','Python (Basic)','SQL (Basic)'],
  professional:['Leadership','Strategic Thinking','Decision Making','Mentoring','Stakeholder Management','Executive Communication','Budget Planning','Team Building','Change Management','Process Optimization','P&L Management'],
  profSoft:['Communication','Leadership','Problem Solving','Critical Thinking','Adaptability','Teamwork','Time Management','Attention to Detail','Project Coordination','Conflict Resolution'],
};
function getPool(role){
  const r=(role||A.field||'').toLowerCase();
  if(r.includes('develop')||r.includes('engineer')||r.includes('software'))return SK.software;
  if(r.includes('data')||r.includes('analys'))return SK.data;
  if(r.includes('design'))return SK.design;
  if(r.includes('market'))return SK.marketing;
  if(r.includes('financ')||r.includes('account'))return SK.finance;
  if(r.includes('manage')||r.includes('lead'))return SK.management;
  return A.userType==='student'?SK.fresher:SK.professional;
}
function updSug(){
  const role=v('p-target');const pool=getPool(role);
  const have=allSk().map(s=>s.n.toLowerCase());
  const sugs=pool.filter(s=>!have.includes(s.toLowerCase())).slice(0,9);
  const el=$('sug-sk-tech');if(el)el.innerHTML=sugs.map(s=>'<span class="chip chip-s" onclick="qAddSk(\''+s.replace(/'/g,"&#39;")+'\')" style="cursor:pointer"><i class="fas fa-plus" style="font-size:7px"></i> '+s+'</span>').join('');
  const pp=A.userType==='student'?SK.profSoft:SK.professional;
  const phave=A.skills.prof.map(s=>s.n.toLowerCase());
  const psugs=pp.filter(s=>!phave.includes(s.toLowerCase())).slice(0,8);
  const pel=$('sug-sk-prof');if(pel)pel.innerHTML=psugs.map(s=>'<span class="chip chip-s" onclick="qAddSkP(\''+s.replace(/'/g,"&#39;")+'\')" style="cursor:pointer"><i class="fas fa-plus" style="font-size:7px"></i> '+s+'</span>').join('');
}
function qAddSk(n){if(!A.skills.tech.find(s=>s.n===n)){A.skills.tech.push({n,l:75});renderSkChips();liveUp();updATS();updSug();showToast(n+' added!');}}
function qAddSkP(n){if(!A.skills.prof.find(s=>s.n===n)){A.skills.prof.push({n,l:75});renderSkChips();liveUp();updATS();showToast(n+' added!');}}

// ---- SKILLS ----
function showSkC(cat,btn){
  ['tech','prof','tools','fw'].forEach(c=>{const el=$('skc-'+c);if(el)el.style.display=c===cat?'block':'none';});
  document.querySelectorAll('.sk-t').forEach(b=>b.classList.remove('on'));if(btn)btn.classList.add('on');
}
function addSk(cat){
  const iMap={tech:'ski-tech',prof:'ski-prof',tools:'ski-tools',fw:'ski-fw'};
  const lMap={tech:'skl-tech',prof:'skl-prof',tools:'skl-tools',fw:'skl-fw'};
  const inp=$(iMap[cat]);if(!inp)return;
  const name=inp.value.trim();if(!name){showToast('Enter a skill name');return;}
  const level=parseInt($(lMap[cat])?.value||'75');
  if(A.skills[cat].find(s=>s.n.toLowerCase()===name.toLowerCase())){showToast('Already added!');return;}
  A.skills[cat].push({n:name,l:level});inp.value='';
  renderSkChips();liveUp();updATS();updSug();showToast(name+' added âœ“');
}
function removeSk(cat,idx){A.skills[cat].splice(idx,1);renderSkChips();liveUp();updATS();updSug();}
function renderSkChips(){
  [['tech','sk-tech'],['prof','sk-prof'],['tools','sk-tools'],['fw','sk-fw']].forEach(([cat,elId])=>{
    const el=$(elId);if(!el)return;
    const colors={tech:'var(--caramel)',prof:'var(--sage)',tools:'var(--rust)',fw:'var(--amber)'};
    el.innerHTML=A.skills[cat].map((s,i)=>'<span class="chip" onclick="removeSk(\''+cat+'\','+i+')" title="Click to remove" style="border-color:'+colors[cat]+'40">'+s.n+' <i class="fas fa-times"></i> <span style="font-size:7px;opacity:.55">'+s.l+'%</span></span>').join('');
  });
}

// ---- QUOTES ----
const QUOTES=[
  {t:'The most powerful resume is the one that tells the story only you can tell.',by:'Elyssor Career Advisor'},
  {t:'Your resume is not a list of jobs â€” it is a testament to your impact.',by:'Career Intelligence'},
  {t:'Opportunities don\'t happen, you create them. Start with a world-class resume.',by:'Elyssor'},
  {t:'Success is where preparation and opportunity meet. Be ready.',by:'Bobby Unser'},
  {t:'Your career is a product. Your resume is its first marketing campaign.',by:'Elyssor Insights'},
  {t:'Data scientists analyze the world. A great resume analyzes you.',by:'Career Intelligence'},
  {t:'Leaders don\'t just manage teams. They build legacies â€” show yours.',by:'Elyssor'},
  {t:'The best investment you can make is in yourself.',by:'Warren Buffett'},
  {t:'Design is not just what it looks like. It\'s how it works.',by:'Steve Jobs'},
  {t:'Every expert was once a beginner. Your journey starts with one great resume.',by:'Elyssor Career Advisor'},
  {t:'Freshers who quantify impact get 3x more callbacks. Show your numbers.',by:'Elyssor Intelligence'},
  {t:'Your first job shapes your career. Craft a resume that opens the right doors.',by:'Elyssor'},
];
function updQuote(){
  const role=(A.personal.targetRole||A.field||'').toLowerCase();
  let q;
  if(role.includes('data'))q=QUOTES[6];else if(role.includes('design'))q=QUOTES[8];
  else if(A.userType==='student')q=QUOTES[10];else if(role.includes('lead')||role.includes('manage'))q=QUOTES[6];
  else q=QUOTES[Math.floor(Math.random()*QUOTES.length)];
  const qt=$('q-txt'),qb=$('q-by');
  if(qt)qt.textContent=q.t;if(qb)qb.textContent='â€” '+q.by;
}

// ---- SUGGESTIONS ----
function buildSugs(){
  const list=$('sug-list'),miss=$('miss-skills');if(!list)return;
  const p=A.personal,isStu=A.userType==='student',sugs=[];
  if(!p.name)sugs.push({t:'w',title:'Missing Name',txt:'Add your full name â€” it\'s the first thing ATS and recruiters look for.'});
  if(!A.summary||A.summary.length<50)sugs.push({t:'w',title:'Weak or Missing Summary',txt:'A tailored professional summary increases callback rates by up to 40%. Use the AI generator!'});
  if(allSk().length<5)sugs.push({t:'w',title:'Low Skill Count ('+allSk().length+')',txt:'Add at least 10-15 skills to pass ATS filters. Add both technical AND professional skills.'});
  if(!A.exp.length&&!A.intern.length)sugs.push({t:'w',title:isStu?'No Internships/Projects':'No Experience',txt:isStu?'Add internships, academic projects, or volunteer roles. These show practical skills!':'Add work experience â€” even freelance or contract work adds significant credibility.'});
  if(!p.linkedin)sugs.push({t:'',title:'Missing LinkedIn',txt:'78% of recruiters check LinkedIn. Add your profile URL to boost credibility.'});
  if(!A.certs.length)sugs.push({t:'',title:'No Certifications',txt:isStu?'Add free certifications from Google, AWS, or Coursera â€” they are free and highly valued!':'Industry certifications differentiate you from 90% of candidates.'});
  if(!A.proj.length&&isStu)sugs.push({t:'',title:'Add Projects',txt:'For freshers, 2-3 strong projects demonstrate practical skills better than GPA alone.'});
  if(A.exp.length>0&&!A.exp.some(e=>e.desc&&(e.desc.includes('%')||e.desc.match(/\d+/))))sugs.push({t:'',title:'Add Quantified Results',txt:'Resumes with numbers get 40% more interviews. Add metrics: "Increased sales by 35%", "Managed team of 8".'});
  if(sugs.length===0)sugs.push({t:'ok',title:'Great Profile! ðŸŽ‰',txt:'Your resume looks comprehensive. Fine-tune it for each specific job description for best results.'});
  list.innerHTML=sugs.map(s=>'<div class="sug '+s.t+'"><div class="sug-t">'+(s.t==='w'?'âš ï¸':s.t==='ok'?'âœ…':'ðŸ’¡')+' '+s.title+'</div><div class="sug-txt">'+s.txt+'</div></div>').join('');
  if(miss){
    const pool=getPool(A.personal.targetRole);const have=allSk().map(s=>s.n.toLowerCase());
    const missing=pool.filter(n=>!have.includes(n.toLowerCase())).slice(0,8);
    miss.innerHTML=missing.length?missing.map(m=>'<span class="chip chip-s" onclick="qAddSk(\''+m.replace(/'/g,"&#39;")+'\')" style="cursor:pointer"><i class="fas fa-plus" style="font-size:7px"></i> '+m+'</span>').join(''):'<div class="sug ok"><div class="sug-txt">Your skills align well with your target role! ðŸŽ¯</div></div>';
  }
}

// ---- AI SUMMARY ----
function genSum(){
  const p=A.personal,tone=v('sum-tone'),len=v('sum-len');
  const skStr=allSk().slice(0,8).map(s=>s.n).join(', ');
  const isStu=A.userType==='student';
  const expStr=A.exp.length?'with '+A.exp.length+' years of experience':'';
  const internStr=A.intern.length?'including '+A.intern.length+' internship(s)':'';
  let sum='';
  const role=p.targetRole||p.title||'professional';
  const field=A.field||role;
  if(isStu){
    if(tone==='confident')sum='Ambitious and results-driven '+field+' student '+internStr+(skStr?', equipped with expertise in '+skStr:'')+('. Passionate about translating academic excellence and hands-on project experience into real-world impact. Eager to contribute innovative ideas and technical skills to a forward-thinking organization where I can grow and make a meaningful difference.');
    else sum='Dedicated '+field+' student with a strong academic foundation and practical experience through internships and projects'+(skStr?', with proficiency in '+skStr:'')+('. Committed to continuous learning and applying technical knowledge to solve real-world challenges. Seeking opportunities to grow professionally and contribute meaningfully to an innovative team.');
    if(len==='short')sum=sum.split('.').slice(0,2).join('.')+'.';
    if(len==='long')sum+=(' Known for strong communication skills, collaborative mindset, and the ability to quickly adapt to new technologies and environments.');
  } else {
    if(tone==='leadership')sum='Strategic '+role+' '+expStr+' with a proven track record of leading high-performing teams and delivering measurable business outcomes'+(skStr?'. Deep expertise in '+skStr:'')+('. Recognized for transformative leadership, cross-functional collaboration, and the ability to align technical capabilities with organizational objectives to drive sustainable growth.');
    else if(tone==='confident')sum='High-impact '+role+' '+expStr+(skStr?' with mastery of '+skStr:'')+('. A results-obsessed professional who consistently delivers above expectations â€” from architecting scalable solutions to driving revenue growth. Adept at turning complex challenges into competitive advantages in fast-paced, high-growth environments.');
    else if(tone==='analytical')sum='Data-driven '+role+' '+expStr+(skStr?' specializing in '+skStr:'')+('. Leverages analytical thinking and quantitative methods to optimize processes, identify growth opportunities, and deliver measurable results. Combines deep technical expertise with strategic business acumen to drive data-informed decision making.');
    else sum='Seasoned '+role+' '+expStr+(skStr?' with expertise in '+skStr:'')+('. Demonstrated ability to deliver high-quality solutions while collaborating effectively across teams. Passionate about innovation, continuous improvement, and creating lasting value through technical excellence and strategic thinking.');
    if(len==='short')sum=sum.split('.').slice(0,2).join('.')+'.';
    if(len==='long')sum+=(' Recognized for exceptional communication skills, mentorship abilities, and a commitment to fostering inclusive, high-performing team cultures.');
  }
  sv('p-summary',sum);A.summary=sum;renderResume();showToast('AI Summary generated! âœ¨');
}

// ---- GRAMMAR ----
const CORRECTIONS=[
  // Capitalization (only standalone "i")
  {wrong:/\bi am\b/g,right:'I am'},{wrong:/\bi have\b/g,right:'I have'},{wrong:/\bi was\b/g,right:'I was'},
  {wrong:/\bi will\b/g,right:'I will'},{wrong:/\bi can\b/g,right:'I can'},{wrong:/\bi did\b/g,right:'I did'},
  {wrong:/\bi've\b/g,right:"I've"},{wrong:/\bi'm\b/g,right:"I'm"},{wrong:/\bi'd\b/g,right:"I'd"},
  {wrong:/\bi'll\b/g,right:"I'll"},
  // Very common misspellings
  {wrong:/\bteh\b/gi,right:'the'},{wrong:/\brecieve\b/gi,right:'receive'},{wrong:/\boccured\b/gi,right:'occurred'},
  {wrong:/\bseperate\b/gi,right:'separate'},{wrong:/\baccomodate\b/gi,right:'accommodate'},
  {wrong:/\bcommittment\b/gi,right:'commitment'},{wrong:/\bnecesary\b/gi,right:'necessary'},
  {wrong:/\bsucessful\b/gi,right:'successful'},{wrong:/\bmanagment\b/gi,right:'management'},
  {wrong:/\bdevelopement\b/gi,right:'development'},{wrong:/\bacheive\b/gi,right:'achieve'},
  {wrong:/\bexcercise\b/gi,right:'exercise'},{wrong:/\bbeleive\b/gi,right:'believe'},
  {wrong:/\bdefinately\b/gi,right:'definitely'},{wrong:/\bwierd\b/gi,right:'weird'},
  {wrong:/\breccomend\b/gi,right:'recommend'},{wrong:/\barguement\b/gi,right:'argument'},
  {wrong:/\benviroment\b/gi,right:'environment'},{wrong:/\bresponcibility\b/gi,right:'responsibility'},
  {wrong:/\bimplemention\b/gi,right:'implementation'},{wrong:/\bprograming\b/gi,right:'programming'},
  {wrong:/\bcolabrate\b/gi,right:'collaborate'},{wrong:/\bcomunicat/gi,right:'communicat'},
  {wrong:/\bexperianced\b/gi,right:'experienced'},{wrong:/\bknowlege\b/gi,right:'knowledge'},
  {wrong:/\bmaintanance\b/gi,right:'maintenance'},{wrong:/\boptomize\b/gi,right:'optimize'},
  {wrong:/\bperformace\b/gi,right:'performance'},{wrong:/\breponse\b/gi,right:'response'},
  {wrong:/\bstategy\b/gi,right:'strategy'},{wrong:/\btechnolgy\b/gi,right:'technology'},
  // Additional resume-common errors
  {wrong:/\bproficent\b/gi,right:'proficient'},{wrong:/\bprofiecient\b/gi,right:'proficient'},
  {wrong:/\bresposible\b/gi,right:'responsible'},{wrong:/\bresponsibile\b/gi,right:'responsible'},
  {wrong:/\bacheivement\b/gi,right:'achievement'},{wrong:/\bachivment\b/gi,right:'achievement'},
  {wrong:/\banalisis\b/gi,right:'analysis'},{wrong:/\banalze\b/gi,right:'analyze'},
  {wrong:/\bbussiness\b/gi,right:'business'},{wrong:/\bbusines\b/gi,right:'business'},
  {wrong:/\bcalender\b/gi,right:'calendar'},{wrong:/\bcarrer\b/gi,right:'career'},
  {wrong:/\bcompany's\b/g,right:"company's"},{wrong:/\bcompanies's\b/gi,right:"companies'"},
  {wrong:/\bconsistant\b/gi,right:'consistent'},{wrong:/\bdatabse\b/gi,right:'database'},
  {wrong:/\beffecient\b/gi,right:'efficient'},{wrong:/\benginer\b/gi,right:'engineer'},
  {wrong:/\bexcelent\b/gi,right:'excellent'},{wrong:/\bfaciliate\b/gi,right:'facilitate'},
  {wrong:/\bfreelanse\b/gi,right:'freelance'},{wrong:/\bgoverment\b/gi,right:'government'},
  {wrong:/\bimmediatly\b/gi,right:'immediately'},{wrong:/\bindepandent\b/gi,right:'independent'},
  {wrong:/\binnovatve\b/gi,right:'innovative'},{wrong:/\bjudgement\b/gi,right:'judgment'},
  {wrong:/\bliason\b/gi,right:'liaison'},{wrong:/\bmillisecond\b/gi,right:'millisecond'},
  {wrong:/\bneccessary\b/gi,right:'necessary'},{wrong:/\boccasionaly\b/gi,right:'occasionally'},
  {wrong:/\bparallel\b/gi,right:'parallel'},{wrong:/\bpossibilty\b/gi,right:'possibility'},
  {wrong:/\bprofesional\b/gi,right:'professional'},{wrong:/\brefrences\b/gi,right:'references'},
  {wrong:/\bschedual\b/gi,right:'schedule'},{wrong:/\bsignificant\b/gi,right:'significant'},
  {wrong:/\bstregth\b/gi,right:'strength'},{wrong:/\bteamwork\b/gi,right:'teamwork'},
  {wrong:/\bthier\b/gi,right:'their'},{wrong:/\bunderstaning\b/gi,right:'understanding'},
  {wrong:/\butilze\b/gi,right:'utilize'},{wrong:/\bvolunteer\b/gi,right:'volunteer'},
  // Double-word fixes
  {wrong:/\b(the)\s+\1\b/gi,right:'$1'},{wrong:/\b(and)\s+\1\b/gi,right:'$1'},
  {wrong:/\b(to)\s+\1\b/gi,right:'$1'},{wrong:/\b(in)\s+\1\b/gi,right:'$1'},
];
function checkGram(text){
  return CORRECTIONS.filter(c=>c.wrong.test(text)).map(c=>{c.wrong.lastIndex=0;const match=text.match(c.wrong);return{wrong:match?match[0]:c.wrong.toString(),right:c.right.replace(/\\$1/g,match?match[1]:''),rule:'Spelling correction'};});
}
function renderGramResults(errors,container,limit){
  const visible=errors.slice(0,limit);
  if(!errors.length){container.innerHTML='<div class="sug ok"><div class="sug-t">âœ… No Issues Found</div><div class="sug-txt">Great! Grammar looks clean. Your resume preview is up to date.</div></div>';return;}
  let html='<div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:8px">';
  html+='<span style="font-size:12px;font-weight:600;color:var(--dark)">'+errors.length+' issue(s) found</span>';
  html+='<button class="gfix" style="padding:4px 10px;font-size:10px;background:var(--caramel);color:#fff;border-color:var(--caramel)" onclick="fixAllErr()"><i class="fas fa-magic"></i> Fix All + Update Preview</button>';
  html+='</div>';
  html+='<div class="gram-r">'+visible.map((e,i)=>'<div class="gram-e"><div><span class="gw">'+e.wrong+'</span> â†’ <span class="gr">'+e.right+'</span><div style="font-size:10px;color:var(--brown);margin-top:1px">'+e.rule+'</div></div><button class="gfix" onclick="fixErr('+i+')"><i class="fas fa-check"></i> Fix</button></div>').join('')+'</div>';
  container.innerHTML=html;
  window._gramErrors=errors;
}
function fixAllErr(){
  const errs=[...window._gramErrors];
  errs.forEach((_,i)=>{if(window._gramErrors[0])fixErrSilent(0);});
  liveUp();renderResume();
  const area=$('gram-res-area');
  if(area)area.innerHTML='<div class="sug ok"><div class="sug-t">âœ… All '+errs.length+' Issues Fixed!</div><div class="sug-txt">Your resume preview has been updated with all corrections.</div></div>';
  window._gramErrors=[];
  showToast('All grammar issues fixed! Preview updated âœ“');
}
function fixErrSilent(idx){
  const e=window._gramErrors[idx];if(!e)return;
  const re=new RegExp(e.wrong.replace(/[.*+?^${}()|[\]\\]/g,'\\$&'),'gi');
  const fields=['p-name','p-title','p-summary','p-loc'];
  fields.forEach(id=>{const el=$(id);if(el&&re.test(el.value)){re.lastIndex=0;el.value=el.value.replace(re,e.right);}});
  A.exp.forEach(ex=>{if(re.test(ex.desc||'')){re.lastIndex=0;ex.desc=ex.desc.replace(re,e.right);}if(re.test(ex.role||'')){re.lastIndex=0;ex.role=ex.role.replace(re,e.right);}});
  A.edu.forEach(ed=>{if(re.test(ed.degree||'')){re.lastIndex=0;ed.degree=ed.degree.replace(re,e.right);}});
  A.proj.forEach(pr=>{if(re.test(pr.desc||'')){re.lastIndex=0;pr.desc=pr.desc.replace(re,e.right);}});
  A.summary=$('p-summary')?.value||A.summary;
  window._gramErrors.splice(idx,1);
}
function fixErr(idx){
  const e=window._gramErrors[idx];if(!e)return;
  const re=new RegExp(e.wrong.replace(/[.*+?^${}()|[\]\\]/g,'\\$&'),'gi');
  // apply fix to ALL text fields
  const fields=['p-name','p-title','p-summary','p-loc'];
  let fixed=false;
  fields.forEach(id=>{const el=$(id);if(el&&re.test(el.value)){re.lastIndex=0;el.value=el.value.replace(re,e.right);fixed=true;}});
  // also fix in experience/education description fields
  A.exp.forEach(ex=>{if(re.test(ex.desc||'')){re.lastIndex=0;ex.desc=ex.desc.replace(re,e.right);fixed=true;}if(re.test(ex.role||'')){re.lastIndex=0;ex.role=ex.role.replace(re,e.right);fixed=true;}});
  A.edu.forEach(ed=>{if(re.test(ed.degree||'')){re.lastIndex=0;ed.degree=ed.degree.replace(re,e.right);fixed=true;}});
  A.proj.forEach(pr=>{if(re.test(pr.desc||'')){re.lastIndex=0;pr.desc=pr.desc.replace(re,e.right);fixed=true;}});
  // update the stored text if field was fixed
  A.summary=$('p-summary')?.value||A.summary;
  // remove from error list and re-render error list
  window._gramErrors.splice(idx,1);
  window._gramApplied=(window._gramApplied||0)+1;
  const area=$('gram-res-area');
  if(area){
    const remain=window._gramErrors;
    if(!remain.length){
      area.innerHTML='<div class="sug ok" style="margin-top:8px"><div class="sug-t">âœ… All Fixed! Preview Updated</div><div class="sug-txt">All grammar issues corrected. Your resume preview has been updated.</div></div>';
    } else {
      const limit=A.plan==='free'?5:remain.length;
      area.innerHTML='<div style="font-size:12px;font-weight:600;color:var(--dark);margin-bottom:8px">'+remain.length+' issue(s) remaining:</div>';
      renderGramResults(remain,area,limit);
    }
  }
  liveUp();renderResume();
  showToast(fixed?'Fixed: '+e.wrong+' â†’ '+e.right+' Â· Preview updated âœ“':'Applied fix Â· Preview updated âœ“');
}
function inlGram(el){
  if(!el||!el.value)return;
  // Auto-correct as the user types
  const text=el.value;
  let corrected=text;
  let fixCount=0;
  CORRECTIONS.forEach(c=>{
    c.wrong.lastIndex=0;
    if(c.wrong.test(corrected)){
      c.wrong.lastIndex=0;
      corrected=corrected.replace(c.wrong,c.right);
      fixCount++;
    }
  });
  if(fixCount>0&&corrected!==text){
    // Preserve cursor position
    const pos=el.selectionStart||0;
    const diff=corrected.length-text.length;
    el.value=corrected;
    try{el.setSelectionRange(Math.max(0,pos+diff),Math.max(0,pos+diff));}catch(e){}
    // Flash a subtle green border to indicate auto-correction
    el.style.borderColor='var(--sage)';
    setTimeout(()=>{el.style.borderColor='';},800);
  }
  // Show status in grammar result area (only for summary field)
  const res=$('sum-gram-res');
  if(res&&(el.id==='p-summary'||el.id==='ce-summary')){
    if(fixCount>0){
      res.innerHTML='<div style="font-size:10px;font-weight:600;color:var(--sage);padding:4px 0"><i class="fas fa-check-circle" style="color:var(--sage)"></i> Auto-corrected '+fixCount+' issue(s)</div>';
      setTimeout(()=>{if(res)res.innerHTML='';},2500);
    } else {
      res.innerHTML='';
    }
  }
}

// â•â•â• AUTO-FIX GRAMMAR ACROSS ALL FIELDS â•â•â•
function autoFixGrammar(){
  const fields=['p-name','p-title','p-summary','p-loc','ce-name','ce-title','ce-summary','ce-loc'];
  let totalFixes=0;
  fields.forEach(id=>{
    const el=$(id);if(!el||!el.value)return;
    let text=el.value;
    CORRECTIONS.forEach(c=>{
      c.wrong.lastIndex=0;
      if(c.wrong.test(text)){
        c.wrong.lastIndex=0;
        text=text.replace(c.wrong,c.right);
        totalFixes++;
      }
    });
    el.value=text;
  });
  // Also fix in experience/education descriptions
  A.exp.forEach(ex=>{
    if(ex.desc){CORRECTIONS.forEach(c=>{c.wrong.lastIndex=0;if(c.wrong.test(ex.desc)){c.wrong.lastIndex=0;ex.desc=ex.desc.replace(c.wrong,c.right);totalFixes++;}});}
    if(ex.role){CORRECTIONS.forEach(c=>{c.wrong.lastIndex=0;if(c.wrong.test(ex.role)){c.wrong.lastIndex=0;ex.role=ex.role.replace(c.wrong,c.right);totalFixes++;}});}
  });
  A.edu.forEach(ed=>{
    if(ed.acts){CORRECTIONS.forEach(c=>{c.wrong.lastIndex=0;if(c.wrong.test(ed.acts)){c.wrong.lastIndex=0;ed.acts=ed.acts.replace(c.wrong,c.right);totalFixes++;}});}
  });
  A.proj.forEach(pr=>{
    if(pr.desc){CORRECTIONS.forEach(c=>{c.wrong.lastIndex=0;if(c.wrong.test(pr.desc)){c.wrong.lastIndex=0;pr.desc=pr.desc.replace(c.wrong,c.right);totalFixes++;}});}
  });
  A.intern.forEach(it=>{
    if(it.desc){CORRECTIONS.forEach(c=>{c.wrong.lastIndex=0;if(c.wrong.test(it.desc)){c.wrong.lastIndex=0;it.desc=it.desc.replace(c.wrong,c.right);totalFixes++;}});}
  });
  if(A.summary){
    let s=A.summary;
    CORRECTIONS.forEach(c=>{c.wrong.lastIndex=0;if(c.wrong.test(s)){c.wrong.lastIndex=0;s=s.replace(c.wrong,c.right);totalFixes++;}});
    A.summary=s;
  }
  if(totalFixes>0){
    renderResume();
    showToast('Auto-corrected '+totalFixes+' grammar issue(s) âœ“');
  }
}
function handleDrop(e){e.preventDefault();const file=e.dataTransfer.files[0];if(file)processFile(file);}
function handleFileUp(e){const file=e.target.files[0];if(file)processFile(file);}
function processFile(file){
  const reader=new FileReader();
  reader.onload=ev=>{
    const text=ev.target.result;const errors=checkGram(text);
    const area=$('gram-res-area');const prem=$('gram-prem');const total=$('gram-total');
    const limit=A.plan==='free'?5:errors.length;
    if(total)total.textContent=errors.length;
    if(prem)prem.style.display=A.plan==='free'&&errors.length>5?'block':'none';
    area.innerHTML='<div style="font-size:12px;font-weight:600;color:var(--dark);margin-bottom:8px">Found <strong>'+errors.length+'</strong> issue(s) in uploaded file:</div>';
    renderGramResults(errors,area,limit);
    showToast('File analyzed: '+errors.length+' issue(s) found');
  };
  reader.readAsText(file);
}

// ---- TEMPLATES ----
// â”€â”€ TEMPLATE DEFINITIONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// layout values: 'classic'|'sidebar'|'twocol'|'banner'|'card'|'accent'|'minimal'|'dark'|'circle'
const TMPLS=[
 // â”€â”€ FREE (classic layouts) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 {id:'t01',n:'Executive Navy',   tier:'free',cat:'classic', hdr:'#1a1a2e',acc:'#c9aa71',bg:'#ffffff',layout:'classic'},
 {id:'t02',n:'Clean Slate',      tier:'free',cat:'minimal', hdr:'#2c2c2c',acc:'#999999',bg:'#ffffff',layout:'minimal'},
 {id:'t03',n:'Warm Amber',       tier:'free',cat:'classic', hdr:'#3D2314',acc:'#D4A853',bg:'#FDF6EC',layout:'classic'},
 {id:'t04',n:'Forest Sidebar',   tier:'free',cat:'sidebar', hdr:'#2d4a22',acc:'#7A8C6E',bg:'#ffffff',layout:'sidebar'},
 {id:'t05',n:'Rust & Cream',     tier:'free',cat:'classic', hdr:'#C0603A',acc:'#E8D5B7',bg:'#FDF6EC',layout:'banner'},
 // â”€â”€ PRO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 {id:'t06',n:'Ocean Split',      tier:'pro', cat:'twocol',  hdr:'#0c2d48',acc:'#3498db',bg:'#f0f8ff',layout:'twocol'},
 {id:'t07',n:'Royal Plum',       tier:'pro', cat:'creative',hdr:'#4a0e6b',acc:'#a855f7',bg:'#fff',   layout:'card'},
 {id:'t08',n:'Emerald Pro',      tier:'pro', cat:'classic', hdr:'#0d3b2e',acc:'#00a86b',bg:'#f0faf5',layout:'classic'},
 {id:'t09',n:'Saffron Gold',     tier:'pro', cat:'creative',hdr:'#7B4F12',acc:'#F59E0B',bg:'#fffbf0',layout:'accent'},
 {id:'t10',n:'Sand Dune',        tier:'pro', cat:'minimal', hdr:'#8B6914',acc:'#d4a574',bg:'#faf7f0',layout:'minimal'},
 {id:'t11',n:'Hunter Green',     tier:'pro', cat:'sidebar', hdr:'#1B4332',acc:'#52b788',bg:'#f8fdf8',layout:'sidebar'},
 {id:'t12',n:'Charcoal',         tier:'pro', cat:'minimal', hdr:'#1a1a1a',acc:'#e0e0e0',bg:'#ffffff',layout:'minimal'},
 {id:'t13',n:'Indigo Dream',     tier:'pro', cat:'twocol',  hdr:'#3730a3',acc:'#818cf8',bg:'#f5f3ff',layout:'twocol'},
 {id:'t14',n:'Coral Warm',       tier:'pro', cat:'creative',hdr:'#9b2335',acc:'#f97316',bg:'#fff8f3',layout:'banner'},
 {id:'t15',n:'Cedar Wood',       tier:'pro', cat:'classic', hdr:'#5c2e00',acc:'#a0522d',bg:'#fdf8f3',layout:'classic'},
 {id:'t16',n:'Olive Grove',      tier:'pro', cat:'minimal', hdr:'#3d4a00',acc:'#8a9a5b',bg:'#fafaf0',layout:'accent'},
 {id:'t17',n:'Ash Modern',       tier:'pro', cat:'minimal', hdr:'#4b5563',acc:'#d1d5db',bg:'#ffffff',layout:'minimal'},
 {id:'t18',n:'Lavender Mist',    tier:'pro', cat:'sidebar', hdr:'#4c1d95',acc:'#ddd6fe',bg:'#faf8ff',layout:'sidebar'},
 // â”€â”€ PREMIUM â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 {id:'t19',n:'Midnight Dark',    tier:'premium',cat:'dark',    hdr:'#0a0a2e',acc:'#4fc3f7',bg:'#0d1b2a',layout:'dark'},
 {id:'t20',n:'Rose Quartz',      tier:'premium',cat:'creative',hdr:'#8B2252',acc:'#E91E8C',bg:'#fff0f6',layout:'card'},
 {id:'t21',n:'Bronze Elite',     tier:'premium',cat:'classic', hdr:'#4a2c1a',acc:'#cd7f32',bg:'#faf5f0',layout:'classic'},
 {id:'t22',n:'Sapphire',         tier:'premium',cat:'twocol',  hdr:'#0f2460',acc:'#5a9fd4',bg:'#f5f8ff',layout:'twocol'},
 {id:'t23',n:'Teal Luxe',        tier:'premium',cat:'creative',hdr:'#0f4c5c',acc:'#26c6da',bg:'#f0fbfc',layout:'accent'},
 {id:'t24',n:'Copper Blaze',     tier:'premium',cat:'creative',hdr:'#6b2f1a',acc:'#b87333',bg:'#fdf6ee',layout:'banner'},
 {id:'t25',n:'Neon Dark',        tier:'premium',cat:'dark',    hdr:'#0a0a0a',acc:'#00ff88',bg:'#111111',layout:'dark'},
 {id:'t26',n:'Slate Pro',        tier:'premium',cat:'sidebar', hdr:'#2d3748',acc:'#667eea',bg:'#ffffff',layout:'sidebar'},
 {id:'t27',n:'Bottle Green',     tier:'premium',cat:'classic', hdr:'#1a4731',acc:'#4ade80',bg:'#f0fdf4',layout:'classic'},
 {id:'t28',n:'Vermillion',       tier:'premium',cat:'dark',    hdr:'#d42a2a',acc:'#ff8a65',bg:'#1a0505',layout:'dark'},
 {id:'t29',n:'Graphite Pro',     tier:'premium',cat:'twocol',  hdr:'#374151',acc:'#f59e0b',bg:'#f9fafb',layout:'twocol'},
 {id:'t30',n:'Crimson Elite',    tier:'premium',cat:'creative',hdr:'#8B1A1A',acc:'#cc3333',bg:'#fff',   layout:'card'},
];
// Extend to 75 with all 9 layout types
const _extraDefs=[
 ['#2c3e50','#e74c3c','#fff'],['#1abc9c','#16a085','#f0fdf8'],['#8e44ad','#a569bd','#f8f0ff'],
 ['#e67e22','#d35400','#fff8f0'],['#27ae60','#1e8449','#f0fff4'],['#c0392b','#e74c3c','#fff5f5'],
 ['#2c3e50','#f39c12','#fefefe'],['#6c3483','#a569bd','#fdf2ff'],['#17202a','#c9aa71','#fffff8'],
 ['#1a5276','#2e86c1','#f0f8ff'],['#145a32','#1e8449','#f0fdf4'],['#4a235a','#9b59b6','#fdf6ff'],
 ['#1b2631','#85929e','#f8f9fa'],['#784212','#e67e22','#fef9e7'],['#1a5276','#5dade2','#ebf5fb'],
 ['#0e6655','#1abc9c','#e8f8f5'],['#6e2f1a','#e59866','#fdf2e9'],['#1f618d','#2980b9','#eaf2ff'],
 ['#212f3d','#717d7e','#fdfefe'],['#4d5656','#aab7b8','#f2f3f4'],['#2e4057','#048a81','#f0ffff'],
 ['#3b1f2b','#c0392b','#fce4ec'],['#1c2833','#5d6d7e','#f8f9f9'],['#212121','#ffd700','#fffde7'],
 ['#263238','#546e7a','#eceff1'],['#4a148c','#ce93d8','#f3e5f5'],['#1b5e20','#66bb6a','#e8f5e9'],
 ['#bf360c','#ff8a65','#fff3e0'],['#006064','#4dd0e1','#e0f7fa'],['#3e2723','#8d6e63','#fbe9e7'],
 ['#0d47a1','#42a5f5','#e3f2fd'],['#558b2f','#aed581','#f9fbe7'],['#4e342e','#a1887f','#efebe9'],
 ['#880e4f','#f48fb1','#fce4ec'],['#1a237e','#7986cb','#e8eaf6'],['#004d40','#80cbc4','#e0f2f1'],
 ['#311b92','#b39ddb','#ede7f6'],['#e65100','#ffb74d','#fff8e1'],['#37474f','#90a4ae','#eceff1'],
 ['#1c1c1c','#ff4081','#fff0f6'],['#263238','#00bcd4','#e0f7fa'],['#33691e','#8bc34a','#f1f8e9'],
 ['#424242','#bdbdbd','#fafafa'],['#b71c1c','#ef5350','#ffebee'],
];
const _layouts9=['classic','sidebar','twocol','banner','card','accent','minimal','dark','circle'];
const _cats9=['classic','sidebar','twocol','classic','creative','creative','minimal','dark','creative'];
const _tiers4=['pro','pro','premium','free'];
const _names=[
 'Atlas','Meridian','Zenith','Apex','Solstice','Polaris','Orion','Vector','Prism',
 'Helix','Nexus','Cosmos','Lyra','Vega','Sirius','Deneb','Canopus','Aldebaran',
 'Pinnacle','Summit','Legacy','Heritage','Emblem','Prestige','Signature','Pioneer',
 'Luminary','Curator','Maestro','Scholar','Diplomat','Artisan','Visionary','Navigator',
 'Voyager','Sentinel','Horizon','Latitude','Compass','Meridian','Solstice','Equinox',
 'Eclipse','Aurora','Nebula','Comet','Meteor','Quasar','Pulsar','Astro',
];
for(let i=0;i<_extraDefs.length;i++){
 const id='t'+(31+i).toString().padStart(2,'0');
 const c=_extraDefs[i];
 const li=_layouts9[i%9];
 TMPLS.push({id,n:(_names[i]||'Style '+(31+i)),tier:_tiers4[i%4],cat:_cats9[i%9],hdr:c[0],acc:c[1],bg:c[2]||'#fff',layout:li});
}
// â”€â”€ TEMPLATE RENDERING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Generates realistic SVG thumbnail for each template layout
function makeTmplSVG(t){
  const h=t.hdr, a=t.acc, bg=t.bg||'#fff';
  const tc=(bg==='#0d1b2a'||bg==='#111111'||bg==='#1a0505')? '#eeeeee':'#222222';
  const w=100, hh=141; // A4 ratio 1:1.414
  let s='';

  if(t.layout==='sidebar'){
    s=`<rect width="${w}" height="${hh}" fill="${bg}"/>
    <rect width="32" height="${hh}" fill="${h}"/>
    <circle cx="16" cy="18" r="10" fill="${a}" opacity=".55"/>
    <rect x="4" y="31" width="24" height="2.5" rx="1" fill="white" opacity=".85"/>
    <rect x="4" y="36" width="18" height="1.5" rx=".5" fill="white" opacity=".5"/>
    <rect x="4" y="42" width="24" height="1.5" rx=".5" fill="white" opacity=".4"/>
    <rect x="4" y="46" width="20" height="1.5" rx=".5" fill="white" opacity=".35"/>
    <rect x="4" y="54" width="24" height="1.5" rx=".5" fill="white" opacity=".4"/>
    <rect x="4" y="58" width="16" height="1.5" rx=".5" fill="white" opacity=".3"/>
    <rect x="4" y="66" width="24" height="1.5" rx=".5" fill="white" opacity=".4"/>
    <rect x="4" y="70" width="22" height="1.5" rx=".5" fill="white" opacity=".3"/>
    <rect x="4" y="78" width="24" height="1.5" rx=".5" fill="white" opacity=".4"/>
    <rect x="4" y="82" width="20" height="4" rx="2" fill="${a}" opacity=".5"/>
    <rect x="4" y="90" width="24" height="1.5" rx=".5" fill="white" opacity=".35"/>
    <rect x="4" y="94" width="18" height="1.5" rx=".5" fill="white" opacity=".3"/>
    <rect x="36" y="8" width="58" height="6" rx="2" fill="${h}" opacity=".18"/>
    <rect x="36" y="16" width="36" height="3" rx="1" fill="${h}"/>
    <rect x="36" y="21" width="24" height="2" rx="1" fill="${a}"/>
    <rect x="36" y="27" width="58" height="1.5" rx=".5" fill="${tc}" opacity=".15"/>
    <rect x="36" y="30" width="48" height="1.5" rx=".5" fill="${tc}" opacity=".12"/>
    <rect x="36" y="36" width="24" height="2.5" rx="1" fill="${h}"/>
    <rect x="36" y="41" width="58" height="1.5" rx=".5" fill="${tc}" opacity=".15"/>
    <rect x="36" y="44" width="48" height="1.5" rx=".5" fill="${tc}" opacity=".12"/>
    <rect x="36" y="47" width="40" height="1.5" rx=".5" fill="${tc}" opacity=".1"/>
    <rect x="36" y="53" width="24" height="2.5" rx="1" fill="${h}"/>
    <rect x="36" y="58" width="30" height="4" rx="2" fill="${a}" opacity=".35"/>
    <rect x="68" y="58" width="26" height="4" rx="2" fill="${a}" opacity=".25"/>`;
  } else if(t.layout==='twocol'){
    s=`<rect width="${w}" height="${hh}" fill="${bg}"/>
    <rect width="${w}" height="22" fill="${h}"/>
    <rect x="5" y="7" width="44" height="5" rx="1.5" fill="white" opacity=".92"/>
    <rect x="5" y="14" width="30" height="3" rx="1.5" fill="${a}" opacity=".9"/>
    <rect x="56" y="7" width="20" height="2" rx="1" fill="white" opacity=".5"/>
    <rect x="56" y="11" width="16" height="2" rx="1" fill="white" opacity=".45"/>
    <rect x="56" y="15" width="18" height="2" rx="1" fill="white" opacity=".4"/>
    <line x1="50" y1="25" x2="50" y2="${hh}" stroke="${a}" stroke-width=".6" opacity=".3"/>
    <rect x="4" y="27" width="18" height="2.5" rx="1" fill="${h}"/>
    <rect x="52" y="27" width="18" height="2.5" rx="1" fill="${h}"/>
    <rect x="4" y="32" width="42" height="1.5" rx=".5" fill="${tc}" opacity=".15"/>
    <rect x="52" y="32" width="44" height="1.5" rx=".5" fill="${tc}" opacity=".15"/>
    <rect x="4" y="35" width="36" height="1.5" rx=".5" fill="${tc}" opacity=".12"/>
    <rect x="52" y="35" width="40" height="1.5" rx=".5" fill="${tc}" opacity=".12"/>
    <rect x="4" y="42" width="18" height="2.5" rx="1" fill="${h}"/>
    <rect x="52" y="42" width="18" height="2.5" rx="1" fill="${h}"/>
    <rect x="4" y="47" width="42" height="1.5" rx=".5" fill="${tc}" opacity=".15"/>
    <rect x="52" y="47" width="44" height="1.5" rx=".5" fill="${tc}" opacity=".15"/>
    <rect x="4" y="56" width="18" height="2.5" rx="1" fill="${h}"/>
    <rect x="4" y="61" width="16" height="4" rx="2" fill="${a}" opacity=".4"/>
    <rect x="22" y="61" width="14" height="4" rx="2" fill="${a}" opacity=".3"/>
    <rect x="52" y="56" width="18" height="2.5" rx="1" fill="${h}"/>
    <rect x="52" y="61" width="44" height="1.5" rx=".5" fill="${tc}" opacity=".15"/>`;
  } else if(t.layout==='card'){
    s=`<rect width="${w}" height="${hh}" fill="${bg}"/>
    <rect x="4" y="4" width="92" height="36" rx="5" fill="${h}"/>
    <circle cx="22" cy="22" r="12" fill="${a}" opacity=".45"/>
    <rect x="38" y="10" width="50" height="5" rx="2" fill="white" opacity=".9"/>
    <rect x="38" y="18" width="34" height="3" rx="1.5" fill="${a}" opacity=".9"/>
    <rect x="38" y="24" width="22" height="2" rx="1" fill="white" opacity=".5"/>
    <rect x="38" y="29" width="26" height="2" rx="1" fill="white" opacity=".4"/>
    <rect x="4" y="44" width="44" height="26" rx="4" fill="${h}" opacity=".07" stroke="${a}" stroke-width=".5"/>
    <rect x="52" y="44" width="44" height="26" rx="4" fill="${h}" opacity=".07" stroke="${a}" stroke-width=".5"/>
    <rect x="8" y="48" width="16" height="2.5" rx="1" fill="${h}"/>
    <rect x="8" y="53" width="36" height="1.5" rx=".5" fill="${tc}" opacity=".2"/>
    <rect x="8" y="56" width="30" height="1.5" rx=".5" fill="${tc}" opacity=".15"/>
    <rect x="8" y="60" width="34" height="1.5" rx=".5" fill="${tc}" opacity=".12"/>
    <rect x="56" y="48" width="16" height="2.5" rx="1" fill="${h}"/>
    <rect x="56" y="53" width="36" height="1.5" rx=".5" fill="${tc}" opacity=".2"/>
    <rect x="56" y="56" width="28" height="1.5" rx=".5" fill="${tc}" opacity=".15"/>
    <rect x="4" y="74" width="92" height="32" rx="4" fill="${h}" opacity=".06" stroke="${a}" stroke-width=".5"/>
    <rect x="8" y="78" width="16" height="2.5" rx="1" fill="${h}"/>
    <rect x="8" y="83" width="84" height="1.5" rx=".5" fill="${tc}" opacity=".18"/>
    <rect x="8" y="86" width="68" height="1.5" rx=".5" fill="${tc}" opacity=".14"/>
    <rect x="8" y="89" width="76" height="1.5" rx=".5" fill="${tc}" opacity=".12"/>`;
  } else if(t.layout==='banner'){
    s=`<rect width="${w}" height="${hh}" fill="${bg}"/>
    <rect width="${w}" height="30" fill="${h}"/>
    <rect x="0" y="27" width="${w}" height="5" fill="${a}" opacity=".75"/>
    <rect x="6" y="7" width="52" height="7" rx="2" fill="white" opacity=".92"/>
    <rect x="6" y="17" width="34" height="3.5" rx="1.5" fill="${a}" opacity=".9"/>
    <rect x="68" y="9" width="24" height="2" rx="1" fill="white" opacity=".5"/>
    <rect x="68" y="13" width="20" height="2" rx="1" fill="white" opacity=".45"/>
    <rect x="68" y="17" width="22" height="2" rx="1" fill="white" opacity=".4"/>
    <rect x="6" y="38" width="22" height="2.5" rx="1" fill="${h}"/>
    <rect x="6" y="43" width="88" height="1.5" rx=".5" fill="${tc}" opacity=".15"/>
    <rect x="6" y="46" width="74" height="1.5" rx=".5" fill="${tc}" opacity=".12"/>
    <rect x="6" y="53" width="22" height="2.5" rx="1" fill="${h}"/>
    <rect x="6" y="58" width="88" height="1.5" rx=".5" fill="${tc}" opacity=".15"/>
    <rect x="6" y="61" width="64" height="1.5" rx=".5" fill="${tc}" opacity=".12"/>
    <rect x="6" y="67" width="22" height="2.5" rx="1" fill="${h}"/>
    <rect x="6" y="72" width="30" height="4.5" rx="2.5" fill="${a}" opacity=".38"/>
    <rect x="38" y="72" width="30" height="4.5" rx="2.5" fill="${a}" opacity=".28"/>
    <rect x="6" y="82" width="22" height="2.5" rx="1" fill="${h}"/>
    <rect x="6" y="87" width="46" height="1.5" rx=".5" fill="${tc}" opacity=".15"/>
    <rect x="6" y="90" width="38" height="1.5" rx=".5" fill="${tc}" opacity=".12"/>`;
  } else if(t.layout==='accent'){
    s=`<rect width="${w}" height="${hh}" fill="${bg}"/>
    <rect width="7" height="${hh}" fill="${h}"/>
    <rect x="12" y="7" width="52" height="7" rx="2" fill="${h}"/>
    <rect x="12" y="16" width="34" height="3.5" rx="1.5" fill="${a}"/>
    <rect x="12" y="23" width="80" height="1.5" rx=".5" fill="${tc}" opacity=".2"/>
    <rect x="12" y="26" width="68" height="1.5" rx=".5" fill="${tc}" opacity=".15"/>
    <rect x="12" y="32" width="52" height="2" rx="1" fill="${h}" opacity=".75"/>
    <rect x="12" y="37" width="80" height="1.5" rx=".5" fill="${tc}" opacity=".15"/>
    <rect x="12" y="40" width="66" height="1.5" rx=".5" fill="${tc}" opacity=".12"/>
    <rect x="12" y="44" width="60" height="1.5" rx=".5" fill="${tc}" opacity=".1"/>
    <rect x="12" y="50" width="52" height="2" rx="1" fill="${h}" opacity=".75"/>
    <rect x="12" y="55" width="80" height="1.5" rx=".5" fill="${tc}" opacity=".15"/>
    <rect x="12" y="58" width="70" height="1.5" rx=".5" fill="${tc}" opacity=".12"/>
    <rect x="12" y="64" width="52" height="2" rx="1" fill="${h}" opacity=".75"/>
    <rect x="12" y="69" width="32" height="5" rx="2.5" fill="${a}" opacity=".35"/>
    <rect x="46" y="69" width="26" height="5" rx="2.5" fill="${a}" opacity=".25"/>
    <rect x="74" y="69" width="18" height="5" rx="2.5" fill="${a}" opacity=".18"/>
    <rect x="12" y="80" width="52" height="2" rx="1" fill="${h}" opacity=".75"/>
    <rect x="12" y="85" width="80" height="1.5" rx=".5" fill="${tc}" opacity=".15"/>
    <rect x="12" y="88" width="58" height="1.5" rx=".5" fill="${tc}" opacity=".12"/>`;
  } else if(t.layout==='dark'){
    s=`<rect width="${w}" height="${hh}" fill="${h}"/>
    <rect x="0" y="28" width="${w}" height="${hh-28}" fill="${bg==='#0d1b2a'||bg==='#111111'||bg==='#1a0505'?bg:'#111'}"/>
    <circle cx="50" cy="28" r="14" fill="${h}"/>
    <circle cx="50" cy="28" r="12" fill="${a}" opacity=".3"/>
    <rect x="32" y="42" width="36" height="5" rx="2" fill="${a}" opacity=".8"/>
    <rect x="36" y="49" width="28" height="2.5" rx="1" fill="${a}" opacity=".5"/>
    <rect x="8" y="57" width="84" height="1.5" rx=".5" fill="${a}" opacity=".18"/>
    <rect x="8" y="60" width="70" height="1.5" rx=".5" fill="${a}" opacity=".14"/>
    <rect x="8" y="67" width="22" height="2.5" rx="1" fill="${a}" opacity=".7"/>
    <rect x="8" y="72" width="84" height="1.5" rx=".5" fill="${a}" opacity=".18"/>
    <rect x="8" y="75" width="64" height="1.5" rx=".5" fill="${a}" opacity=".14"/>
    <rect x="8" y="82" width="22" height="2.5" rx="1" fill="${a}" opacity=".7"/>
    <rect x="8" y="87" width="32" height="5" rx="2.5" fill="${a}" opacity=".45"/>
    <rect x="42" y="87" width="28" height="5" rx="2.5" fill="${a}" opacity=".3"/>
    <rect x="8" y="98" width="22" height="2.5" rx="1" fill="${a}" opacity=".7"/>
    <rect x="8" y="103" width="52" height="1.5" rx=".5" fill="${a}" opacity=".18"/>`;
  } else if(t.layout==='circle'){
    s=`<rect width="${w}" height="${hh}" fill="${bg}"/>
    <circle cx="18" cy="18" r="14" fill="${h}"/>
    <circle cx="18" cy="18" r="11" fill="${a}" opacity=".4"/>
    <rect x="36" y="10" width="56" height="6" rx="2" fill="${h}"/>
    <rect x="36" y="18" width="38" height="3" rx="1.5" fill="${a}"/>
    <rect x="36" y="23" width="28" height="2" rx="1" fill="${tc}" opacity=".3"/>
    <rect x="4" y="36" width="92" height="1" fill="${a}" opacity=".4"/>
    <rect x="4" y="41" width="22" height="2.5" rx="1" fill="${h}"/>
    <rect x="4" y="46" width="92" height="1.5" rx=".5" fill="${tc}" opacity=".15"/>
    <rect x="4" y="49" width="78" height="1.5" rx=".5" fill="${tc}" opacity=".12"/>
    <rect x="4" y="57" width="22" height="2.5" rx="1" fill="${h}"/>
    <rect x="4" y="62" width="92" height="1.5" rx=".5" fill="${tc}" opacity=".15"/>
    <rect x="4" y="65" width="68" height="1.5" rx=".5" fill="${tc}" opacity=".12"/>
    <rect x="4" y="73" width="22" height="2.5" rx="1" fill="${h}"/>
    <rect x="4" y="78" width="32" height="5" rx="2.5" fill="${a}" opacity=".35"/>
    <rect x="38" y="78" width="28" height="5" rx="2.5" fill="${a}" opacity=".25"/>
    <rect x="68" y="78" width="24" height="5" rx="2.5" fill="${a}" opacity=".18"/>`;
  } else if(t.layout==='minimal'){
    s=`<rect width="${w}" height="${hh}" fill="${bg}"/>
    <rect x="8" y="7" width="46" height="7" rx="1.5" fill="${h}"/>
    <rect x="8" y="16" width="28" height="3" rx="1" fill="${tc}" opacity=".5"/>
    <rect x="8" y="22" width="84" height=".8" fill="${tc}" opacity=".15"/>
    <rect x="8" y="24" width="84" height="1.2" fill="${a}"/>
    <rect x="8" y="27" width="84" height=".8" fill="${tc}" opacity=".1"/>
    <rect x="8" y="32" width="22" height="2" rx="1" fill="${tc}" opacity=".65"/>
    <rect x="8" y="36" width="84" height="1.5" rx=".5" fill="${tc}" opacity=".15"/>
    <rect x="8" y="39" width="72" height="1.5" rx=".5" fill="${tc}" opacity=".12"/>
    <rect x="8" y="44" width="84" height=".8" fill="${tc}" opacity=".1"/>
    <rect x="8" y="48" width="22" height="2" rx="1" fill="${tc}" opacity=".65"/>
    <rect x="8" y="52" width="84" height="1.5" rx=".5" fill="${tc}" opacity=".15"/>
    <rect x="8" y="55" width="64" height="1.5" rx=".5" fill="${tc}" opacity=".12"/>
    <rect x="8" y="62" width="22" height="2" rx="1" fill="${tc}" opacity=".65"/>
    <rect x="8" y="67" width="30" height="4" rx="2" fill="${a}" opacity=".38"/>
    <rect x="42" y="67" width="24" height="4" rx="2" fill="${a}" opacity=".28"/>
    <rect x="68" y="67" width="20" height="4" rx="2" fill="${a}" opacity=".2"/>
    <rect x="8" y="75" width="84" height=".8" fill="${tc}" opacity=".1"/>
    <rect x="8" y="79" width="22" height="2" rx="1" fill="${tc}" opacity=".65"/>
    <rect x="8" y="83" width="84" height="1.5" rx=".5" fill="${tc}" opacity=".15"/>
    <rect x="8" y="86" width="56" height="1.5" rx=".5" fill="${tc}" opacity=".12"/>`;
  } else {
    // classic
    s=`<rect width="${w}" height="${hh}" fill="${bg}"/>
    <rect width="${w}" height="24" fill="${h}"/>
    <circle cx="15" cy="12" r="8" fill="${a}" opacity=".55"/>
    <rect x="27" y="6" width="44" height="5" rx="2" fill="white" opacity=".92"/>
    <rect x="27" y="13" width="30" height="3" rx="1.5" fill="${a}" opacity=".9"/>
    <rect x="72" y="8" width="22" height="2" rx="1" fill="white" opacity=".5"/>
    <rect x="72" y="12" width="18" height="2" rx="1" fill="white" opacity=".45"/>
    <rect x="72" y="16" width="20" height="2" rx="1" fill="white" opacity=".4"/>
    <rect x="4" y="28" width="92" height="1" fill="${a}" opacity=".4"/>
    <rect x="4" y="32" width="22" height="2.5" rx="1" fill="${h}"/>
    <rect x="4" y="37" width="92" height="1.5" rx=".5" fill="${tc}" opacity=".15"/>
    <rect x="4" y="40" width="78" height="1.5" rx=".5" fill="${tc}" opacity=".12"/>
    <rect x="4" y="44" width="84" height="1.5" rx=".5" fill="${tc}" opacity=".1"/>
    <rect x="4" y="50" width="22" height="2.5" rx="1" fill="${h}"/>
    <rect x="4" y="55" width="92" height="1.5" rx=".5" fill="${tc}" opacity=".15"/>
    <rect x="4" y="58" width="68" height="1.5" rx=".5" fill="${tc}" opacity=".12"/>
    <rect x="4" y="66" width="22" height="2.5" rx="1" fill="${h}"/>
    <rect x="4" y="71" width="30" height="5" rx="2.5" fill="${a}" opacity=".4"/>
    <rect x="36" y="71" width="26" height="5" rx="2.5" fill="${a}" opacity=".28"/>
    <rect x="64" y="71" width="22" height="5" rx="2.5" fill="${a}" opacity=".2"/>
    <rect x="4" y="82" width="22" height="2.5" rx="1" fill="${h}"/>
    <rect x="4" y="87" width="92" height="1.5" rx=".5" fill="${tc}" opacity=".15"/>
    <rect x="4" y="90" width="76" height="1.5" rx=".5" fill="${tc}" opacity=".12"/>`;
  }
  return `<svg viewBox="0 0 100 141" xmlns="http://www.w3.org/2000/svg" style="width:100%;height:100%;display:block">${s}</svg>`;
}

let _tmplFilter='all';
function buildTmpl(){
  renderTmplSections(TMPLS);
}

function renderTmplSections(list){
  const wrap=$('tmpl-sections');if(!wrap)return;
  const access=A.plan==='free'?['free']:A.plan==='pro'?['free','pro']:['free','pro','premium'];
  // Group by tier for display
  const groups={free:[],pro:[],premium:[]};
  list.forEach(t=>{ if(groups[t.tier]) groups[t.tier].push(t); });
  const sectionLabels={free:'Free Templates',pro:'Pro Templates',premium:'Premium Templates'};
  let html='';
  ['free','pro','premium'].forEach(tier=>{
    const grp=groups[tier];if(!grp.length)return;
    html+=`<div class="tmpl-section"><div class="tmpl-section-title">${sectionLabels[tier]}</div><div class="tmpl-g">`;
    grp.forEach(t=>{
      const accessible=access.includes(t.tier);
      const svg=makeTmplSVG(t);
      html+=`<div class="tt${A.tmpl===t.id?' on':''}" ${accessible?`onclick="setTmpl('${t.id}')"`:''} title="${t.n}" data-id="${t.id}">
        <div style="flex:1;overflow:hidden;position:relative">${svg}${!accessible?`<div class="tt-lock" onclick="showScreen('subScreen')"><span>ðŸ”’ ${tier.toUpperCase()}</span></div>`:''}</div>
        <div class="tt-foot"><span class="tt-nm">${t.n}</span><span class="tt-bx ${t.tier}">${t.tier}</span></div>
      </div>`;
    });
    html+='</div></div>';
  });
  wrap.innerHTML=html;
}

function filterT(cat,btn){
  document.querySelectorAll('#tmplFilters .tfb').forEach(b=>b.classList.remove('on'));
  if(btn)btn.classList.add('on');
  _tmplFilter=cat;
  const filtered=cat==='all'?TMPLS:TMPLS.filter(t=>t.tier===cat||t.cat===cat||t.layout===cat);
  renderTmplSections(filtered);
}
function setTmpl(id){
  const t=TMPLS.find(t=>t.id===id);if(!t)return;
  A.tmpl=id;A.tmplLayout=t.layout;
  A.acH=t.hdr;A.acA=t.acc;A.acBG=t.bg;
  A.acT=(t.bg==='#0d1b2a'||t.bg==='#111111'||t.bg==='#1a0505')?'#ffffff':'#1a1a1a';
  const hEl=$('cc-hdr'),aEl=$('cc-acc'),bEl=$('cc-bg');
  if(hEl)hEl.value=t.hdr;if(aEl)aEl.value=t.acc;if(bEl)bEl.value=t.bg;
  // update selection highlight
  document.querySelectorAll('.tt').forEach(el=>el.classList.toggle('on',el.dataset.id===id));
  renderResume();showToast('Template: '+t.n+' âœ“');
}

// ---- FONTS ----
const FONTS=[
  {n:'DM Sans',s:'sans-serif',cat:'sans'},{n:'Cormorant Garamond',s:'serif',cat:'serif'},
  {n:'Playfair Display',s:'serif',cat:'serif'},{n:'Raleway',s:'sans-serif',cat:'sans'},
  {n:'Josefin Sans',s:'sans-serif',cat:'sans'},{n:'Lora',s:'serif',cat:'serif'},
  {n:'Nunito',s:'sans-serif',cat:'sans'},{n:'Poppins',s:'sans-serif',cat:'sans'},
  {n:'Outfit',s:'sans-serif',cat:'sans'},{n:'Merriweather',s:'serif',cat:'serif'},
  {n:'EB Garamond',s:'serif',cat:'serif'},{n:'Libre Baskerville',s:'serif',cat:'serif'},
  {n:'Jost',s:'sans-serif',cat:'sans'},{n:'Georgia',s:'serif',cat:'serif'},
  {n:'Garamond',s:'serif',cat:'serif'},{n:'Palatino',s:'serif',cat:'serif'},
  {n:'Times New Roman',s:'serif',cat:'serif'},{n:'Cambria',s:'serif',cat:'serif'},
  {n:'Trebuchet MS',s:'sans-serif',cat:'sans'},{n:'Tahoma',s:'sans-serif',cat:'sans'},
  {n:'Verdana',s:'sans-serif',cat:'sans'},{n:'Century Gothic',s:'sans-serif',cat:'sans'},
  {n:'Helvetica Neue',s:'sans-serif',cat:'sans'},{n:'Lato',s:'sans-serif',cat:'sans'},
  {n:'Montserrat',s:'sans-serif',cat:'sans'},{n:'Open Sans',s:'sans-serif',cat:'sans'},
  {n:'Source Sans Pro',s:'sans-serif',cat:'sans'},{n:'Roboto Slab',s:'serif',cat:'serif'},
  {n:'Crimson Pro',s:'serif',cat:'serif'},{n:'Source Serif 4',s:'serif',cat:'serif'},
  {n:'IBM Plex Serif',s:'serif',cat:'serif'},{n:'IBM Plex Sans',s:'sans-serif',cat:'sans'},
  {n:'Work Sans',s:'sans-serif',cat:'sans'},{n:'Inter',s:'sans-serif',cat:'sans'},
  {n:'Rubik',s:'sans-serif',cat:'sans'},{n:'Karla',s:'sans-serif',cat:'sans'},
  {n:'Ubuntu',s:'sans-serif',cat:'sans'},{n:'Exo 2',s:'sans-serif',cat:'sans'},
  {n:'Arvo',s:'serif',cat:'serif'},{n:'PT Serif',s:'serif',cat:'serif'},
  {n:'PT Sans',s:'sans-serif',cat:'sans'},{n:'Spectral',s:'serif',cat:'serif'},
  {n:'Mulish',s:'sans-serif',cat:'sans'},{n:'Quicksand',s:'sans-serif',cat:'sans'},
  {n:'Cabin',s:'sans-serif',cat:'sans'},{n:'Barlow',s:'sans-serif',cat:'sans'},
  {n:'Titillium Web',s:'sans-serif',cat:'sans'},{n:'Questrial',s:'sans-serif',cat:'sans'},
  {n:'Noto Serif',s:'serif',cat:'serif'},{n:'Noto Sans',s:'sans-serif',cat:'sans'},
  {n:'Readex Pro',s:'sans-serif',cat:'sans'},{n:'Plus Jakarta Sans',s:'sans-serif',cat:'sans'},
  {n:'Fraunces',s:'serif',cat:'serif'},{n:'Big Shoulders Text',s:'sans-serif',cat:'sans'},
];
function buildFontG(){
  const g=$('font-g');if(!g)return;
  g.innerHTML=FONTS.map(f=>'<div class="fo'+(A.font.includes(f.n)?' on':'')+'" onclick="setFont(\''+f.n+'\',\''+f.s+'\')" title="'+f.n+'"><div class="fn" style="font-family:\''+f.n+'\','+f.s+'">' + f.n+'</div><div class="fs">'+f.cat+'</div></div>').join('');
}
function setFont(name,sub){
  A.font="'"+name+"',"+sub;
  document.querySelectorAll('.fo').forEach(f=>f.classList.toggle('on',f.querySelector('.fn')?.textContent===name));
  renderResume();showToast('Font: '+name);
}

// ---- PALETTES ----
const PALS=[
  {c:['#1a1a2e','#c9aa71','#2d1f12','#f5ece0']},{c:['#2d4a22','#7a8c6e','#1b2e13','#f0f5ec']},
  {c:['#3D2314','#D4A853','#7D4E2E','#FDF6EC']},{c:['#0c2d48','#3498db','#061827','#f0f8ff']},
  {c:['#4a0e6b','#a855f7','#2d0840','#f5f0ff']},{c:['#0d3b2e','#00a86b','#071f18','#f0faf5']},
  {c:['#1a1a1a','#e0e0e0','#0a0a0a','#ffffff']},{c:['#8B1A1A','#cc3333','#5a0f0f','#fff5f5']},
  {c:['#5c2e00','#a0522d','#3d1f00','#fdf8f3']},{c:['#0f4c5c','#26c6da','#07303a','#f0fbfc']},
  {c:['#4a2c1a','#cd7f32','#2e1a0f','#faf5f0']},{c:['#0f2460','#5a9fd4','#081540','#f5f8ff']},
];
function buildPalG(){
  const g=$('pal-g');if(!g)return;
  g.innerHTML=PALS.map((p,i)=>'<div class="po'+(i===0?' on':'')+'" onclick="setP('+i+')" title="Palette '+(i+1)+'">'+p.c.map(c=>'<div class="ph" style="background:'+c+'"></div>').join('')+'</div>').join('');
}
function setP(i){
  const p=PALS[i];A.acH=p.c[0];A.acA=p.c[1];A.acT='#1a1a1a';A.acBG=p.c[3];
  $('cc-hdr').value=p.c[0];$('cc-acc').value=p.c[1];$('cc-bg').value=p.c[3];
  document.querySelectorAll('.po').forEach((el,j)=>el.classList.toggle('on',j===i));
  renderResume();showToast('Palette applied âœ“');
}
function applyC(){
  A.acH=$('cc-hdr')?.value||A.acH;A.acA=$('cc-acc')?.value||A.acA;
  A.acT=$('cc-txt')?.value||A.acT;A.acBG=$('cc-bg')?.value||A.acBG;
  A.lineSpacing=parseFloat($('line-sp')?.value||'1.5');renderResume();
}
function chFS(delta){
  A.fs=Math.min(18,Math.max(10,A.fs+delta));
  const el=$('fs-val');if(el)el.textContent=A.fs+'px';
  const el2=$('cust-fs-val');if(el2)el2.textContent=A.fs+'px';
  const tr=$('fs-track');if(tr)tr.style.width=((A.fs-10)/8*100)+'%';
  renderResume();
}
function setAl(al,btn){A.align=al;document.querySelectorAll('#ss-design .tfb').forEach(b=>b.classList.remove('on'));if(btn)btn.classList.add('on');renderResume();}
const ELEMS=['â­','â—','â—†','â–¸','âž¤','ðŸ†','ðŸ“§','ðŸ“ž','ðŸ“','ðŸ”—','|','â€”','â€¢','â€º','Â»','âœ“','â˜…'];
function buildElems(){const g=$('elem-g');if(!g)return;g.innerHTML=ELEMS.map(e=>'<div class="eb" onclick="insertElem(\''+e+'\')" title="Insert element">'+e+'</div>').join('');}
function insertElem(e){const ct=$('custom-text');if(ct){ct.value+=e;A.customText=ct.value;renderResume();}}
</script>
<script>
// ---- MODALS ----
let _modType='',_modIdx=-1;
const MOD_FORMS={
  exp:`<label class="fl">Company <span class="fr">*</span></label><input class="fi" id="mf-company" placeholder="Google Inc.">
       <div class="frow"><div><label class="fl">Role <span class="fr">*</span></label><input class="fi" id="mf-role" placeholder="Software Engineer"></div><div><label class="fl">Type</label><select class="fsel" id="mf-type"><option>Full-time</option><option>Part-time</option><option>Contract</option><option>Freelance</option></select></div></div>
       <div class="frow"><div><label class="fl">Start Date</label><input class="fi" id="mf-start" type="month"></div><div><label class="fl">End Date</label><input class="fi" id="mf-end" type="month" placeholder="Present"></div></div>
       <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:10px"><span class="fl" style="margin-bottom:0">Currently working here</span><label class="tog"><input type="checkbox" id="mf-current" onchange="this.closest('.mbox').querySelector('#mf-end').disabled=this.checked"><span class="tog-sl"></span></label></div>
       <label class="fl">Location</label><input class="fi" id="mf-loc" placeholder="San Francisco, CA / Remote">
       <label class="fl">Key Achievements (be specific &amp; quantified)</label><textarea class="fi" id="mf-desc" rows="4" placeholder="â€¢ Led a team of 5 engineers to deliver X, resulting in 30% performance improvement&#10;â€¢ Architected scalable microservices handling 1M+ daily requests&#10;â€¢ Reduced deployment time by 60% through CI/CD pipeline optimization" oninput="inlGram(this)"></textarea>`,
  
  edu:`<label class="fl">Institution <span class="fr">*</span></label><input class="fi" id="mf-inst" placeholder="Massachusetts Institute of Technology">
       <div class="frow"><div><label class="fl">Degree <span class="fr">*</span></label><select class="fsel" id="mf-deg"><option>High School Diploma</option><option>Associate's</option><option>Bachelor's</option><option>Master's</option><option>PhD</option><option>MBA</option><option>Certificate</option><option>Diploma</option></select></div><div><label class="fl">Field of Study</label><input class="fi" id="mf-field" placeholder="Computer Science"></div></div>
       <div class="frow"><div><label class="fl">Start Year</label><input class="fi" id="mf-sy" type="number" placeholder="2020"></div><div><label class="fl">End Year</label><input class="fi" id="mf-ey" type="number" placeholder="2024"></div></div>
       <div class="frow"><div><label class="fl">GPA / Grade</label><input class="fi" id="mf-gpa" placeholder="3.9/4.0 or First Class"></div><div><label class="fl">Location</label><input class="fi" id="mf-eloc" placeholder="Cambridge, MA"></div></div>
       <label class="fl">Notable Achievements / Activities</label><textarea class="fi" id="mf-acts" rows="3" placeholder="Dean's List, Computer Society President, Hackathon Winner..."></textarea>`,
  
  cert:`<label class="fl">Certification Name <span class="fr">*</span></label><input class="fi" id="mf-cname" placeholder="AWS Certified Solutions Architect â€“ Professional">
        <div class="frow"><div><label class="fl">Issuer <span class="fr">*</span></label><input class="fi" id="mf-ciss" placeholder="Amazon Web Services"></div><div><label class="fl">Date</label><input class="fi" id="mf-cdate" type="month"></div></div>
        <div class="frow"><div><label class="fl">Credential ID</label><input class="fi" id="mf-cid" placeholder="AWS-12345"></div><div><label class="fl">Expiry</label><input class="fi" id="mf-cexp" type="month"></div></div>
        <label class="fl">Credential URL</label><input class="fi" id="mf-curl" placeholder="https://credentials.aws.com/...">`,
  
  proj:`<label class="fl">Project Name <span class="fr">*</span></label><input class="fi" id="mf-pname" placeholder="AI-Powered Resume Analyzer">
        <label class="fl">Tech Stack / Technologies Used</label><input class="fi" id="mf-ptech" placeholder="React, Node.js, TensorFlow, PostgreSQL">
        <div class="frow"><div><label class="fl">Duration</label><input class="fi" id="mf-pdur" placeholder="Jan 2024 â€“ Mar 2024"></div><div><label class="fl">Role</label><input class="fi" id="mf-prole" placeholder="Lead Developer"></div></div>
        <label class="fl">Description &amp; Impact</label><textarea class="fi" id="mf-pdesc" rows="3" placeholder="Built a full-stack AI resume analyzer that improved job match accuracy by 40%..."></textarea>
        <div class="frow"><div><label class="fl">GitHub / Code</label><input class="fi" id="mf-pgit" placeholder="github.com/..."></div><div><label class="fl">Live Demo</label><input class="fi" id="mf-plive" placeholder="yourproject.com"></div></div>`,
  
  intern:`<label class="fl">Company <span class="fr">*</span></label><input class="fi" id="mf-icomp" placeholder="Microsoft">
          <div class="frow"><div><label class="fl">Role <span class="fr">*</span></label><input class="fi" id="mf-irole" placeholder="Software Engineer Intern"></div><div><label class="fl">Type</label><select class="fsel" id="mf-itype"><option>Paid Internship</option><option>Unpaid Internship</option><option>Virtual Internship</option><option>Research Internship</option></select></div></div>
          <div class="frow"><div><label class="fl">Start</label><input class="fi" id="mf-istart" type="month"></div><div><label class="fl">End</label><input class="fi" id="mf-iend" type="month"></div></div>
          <label class="fl">What you built / achieved</label><textarea class="fi" id="mf-idesc" rows="3" placeholder="Developed a feature used by 10K+ users, received return offer, worked with senior engineers on..."></textarea>
          <label class="fl">Stipend (optional)</label><input class="fi" id="mf-istip" placeholder="$2500/month">`,
};
function openMod(type,idx=-1){
  _modType=type;_modIdx=idx;
  const titles={exp:'Work Experience',edu:'Education',cert:'Certification',proj:'Project',intern:'Internship'};
  $('m-title').textContent=(idx>=0?'Edit ':'Add ')+titles[type];
  $('m-body').innerHTML=MOD_FORMS[type]||'';
  if(idx>=0){
    const d=type==='exp'?A.exp[idx]:type==='edu'?A.edu[idx]:type==='cert'?A.certs[idx]:type==='proj'?A.proj[idx]:A.intern[idx];
    if(d)prefillMod(type,d);
  }
  $('entryModal').classList.add('on');
}
function closeMod(){$('entryModal').classList.remove('on');}
function prefillMod(type,d){
  if(type==='exp'){sv('mf-company',d.company);sv('mf-role',d.role);sv('mf-start',d.start);sv('mf-end',d.end);sv('mf-loc',d.loc);sv('mf-desc',d.desc);sv('mf-type',d.type);}
  else if(type==='edu'){sv('mf-inst',d.inst);sv('mf-deg',d.deg);sv('mf-field',d.field);sv('mf-sy',d.sy);sv('mf-ey',d.ey);sv('mf-gpa',d.gpa);sv('mf-eloc',d.loc);sv('mf-acts',d.acts);}
  else if(type==='cert'){sv('mf-cname',d.name);sv('mf-ciss',d.issuer);sv('mf-cdate',d.date);sv('mf-cid',d.cid);sv('mf-curl',d.url);}
  else if(type==='proj'){sv('mf-pname',d.name);sv('mf-ptech',d.tech);sv('mf-pdur',d.dur);sv('mf-prole',d.role);sv('mf-pdesc',d.desc);sv('mf-pgit',d.git);sv('mf-plive',d.live);}
  else if(type==='intern'){sv('mf-icomp',d.company);sv('mf-irole',d.role);sv('mf-istart',d.start);sv('mf-iend',d.end);sv('mf-idesc',d.desc);}
}
function saveMod(){
  let d;
  if(_modType==='exp'){
    if(!v('mf-company')||!v('mf-role')){showToast('Company & Role are required');return;}
    d={company:v('mf-company'),role:v('mf-role'),start:v('mf-start'),end:v('mf-end')||'Present',loc:v('mf-loc'),desc:v('mf-desc'),type:v('mf-type')};
    if(_modIdx>=0)A.exp[_modIdx]=d;else A.exp.push(d);
  } else if(_modType==='edu'){
    if(!v('mf-inst')){showToast('Institution is required');return;}
    d={inst:v('mf-inst'),deg:v('mf-deg'),field:v('mf-field'),sy:v('mf-sy'),ey:v('mf-ey'),gpa:v('mf-gpa'),loc:v('mf-eloc'),acts:v('mf-acts')};
    if(_modIdx>=0)A.edu[_modIdx]=d;else A.edu.push(d);
  } else if(_modType==='cert'){
    if(!v('mf-cname')){showToast('Certification name is required');return;}
    d={name:v('mf-cname'),issuer:v('mf-ciss'),date:v('mf-cdate'),cid:v('mf-cid'),url:v('mf-curl')};
    if(_modIdx>=0)A.certs[_modIdx]=d;else A.certs.push(d);
  } else if(_modType==='proj'){
    if(!v('mf-pname')){showToast('Project name is required');return;}
    d={name:v('mf-pname'),tech:v('mf-ptech'),dur:v('mf-pdur'),role:v('mf-prole'),desc:v('mf-pdesc'),git:v('mf-pgit'),live:v('mf-plive')};
    if(_modIdx>=0)A.proj[_modIdx]=d;else A.proj.push(d);
  } else if(_modType==='intern'){
    if(!v('mf-icomp')||!v('mf-irole')){showToast('Company & Role are required');return;}
    d={company:v('mf-icomp'),role:v('mf-irole'),start:v('mf-istart'),end:v('mf-iend'),desc:v('mf-idesc'),type:v('mf-itype'),stipend:v('mf-istip')};
    if(_modIdx>=0)A.intern[_modIdx]=d;else A.intern.push(d);
  }
  closeMod();renderAllLists();liveUp();updATS();updComp();showToast('Saved! âœ“');
}
function renderAllLists(){
  renderList('exp-list',A.exp,'exp');renderList('edu-list',A.edu,'edu');
  renderList('cert-list',A.certs,'cert');renderList('proj-list',A.proj,'proj');
  renderList('intern-list',A.intern,'intern');
}
function renderList(elId,arr,type){
  const el=$(elId);if(!el)return;
  el.innerHTML=arr.map((d,i)=>{
    const t=type==='exp'?d.company:type==='edu'?d.inst:type==='cert'?d.name:type==='proj'?d.name:d.company;
    const s=type==='exp'?d.role:type==='edu'?d.deg+(d.field?' in '+d.field:''):type==='cert'?d.issuer:type==='proj'?d.tech:d.role;
    return'<div class="ec"><div class="ec-h"><div><div class="ec-t">'+t+'</div><div class="ec-s">'+s+'</div></div><div class="ec-acts"><button class="icb ed" onclick="openMod(\''+type+'\','+i+')"><i class="fas fa-pen"></i></button><button class="icb dl" onclick="delItem(\''+type+'\','+i+')"><i class="fas fa-trash"></i></button></div></div></div>';
  }).join('');
}
function delItem(type,idx){
  if(type==='exp')A.exp.splice(idx,1);else if(type==='edu')A.edu.splice(idx,1);
  else if(type==='cert')A.certs.splice(idx,1);else if(type==='proj')A.proj.splice(idx,1);
  else if(type==='intern')A.intern.splice(idx,1);
  renderAllLists();liveUp();updATS();updComp();showToast('Entry removed');
}

// ---- COURSES ----
const COURSES_DB={
  'Software Engineering':[{ico:'â˜ï¸',t:'AWS Cloud Practitioner',p:'Amazon Web Services Â· Free to $300',url:'aws.amazon.com/certification'},{ico:'âš›ï¸',t:'The Complete React Guide',p:'Udemy Â· ~$15',url:'udemy.com'},{ico:'ðŸ',t:'Python for Everybody',p:'Coursera / University of Michigan Â· Free audit',url:'coursera.org'},{ico:'ðŸ³',t:'Docker & Kubernetes Complete Course',p:'Udemy Â· ~$15',url:'udemy.com'},{ico:'ðŸ”§',t:'Full Stack Web Dev Bootcamp',p:'Udemy Â· ~$15',url:'udemy.com'}],
  'Data Science & Analytics':[{ico:'ðŸ“Š',t:'Google Data Analytics Certificate',p:'Coursera Â· ~$200 or free audit',url:'coursera.org'},{ico:'ðŸ¤–',t:'Machine Learning Specialization',p:'Coursera / Andrew Ng Â· Free audit',url:'coursera.org'},{ico:'ðŸ“ˆ',t:'Python for Data Science',p:'IBM / Coursera Â· Free audit',url:'coursera.org'},{ico:'ðŸ“‰',t:'Tableau Desktop Specialist',p:'Tableau Â· $250',url:'tableau.com'},{ico:'ðŸ’¡',t:'Deep Learning Specialization',p:'deeplearning.ai Â· Free audit',url:'deeplearning.ai'}],
  'UI/UX & Product Design':[{ico:'ðŸŽ¨',t:'Google UX Design Certificate',p:'Coursera Â· ~$200',url:'coursera.org'},{ico:'ðŸ–Œï¸',t:'Figma Complete Course 2024',p:'Udemy Â· ~$15',url:'udemy.com'},{ico:'ðŸ“±',t:'Product Design with InVision',p:'InVision Academy Â· Free',url:'invisionapp.com'},{ico:'ðŸ†',t:'Interaction Design Specialization',p:'UC San Diego / Coursera',url:'coursera.org'}],
  'Marketing & Growth':[{ico:'ðŸ”',t:'Google Digital Marketing & E-commerce',p:'Coursera / Google Â· Free',url:'coursera.org'},{ico:'ðŸ“£',t:'HubSpot Marketing Certification',p:'HubSpot Academy Â· Free',url:'academy.hubspot.com'},{ico:'ðŸ“Š',t:'Facebook Blueprint Certification',p:'Meta Â· Free',url:'facebook.com/blueprint'},{ico:'ðŸš€',t:'Growth Hacking Course',p:'CXL Institute Â· ~$99/mo',url:'cxl.com'}],
  'Finance & Accounting':[{ico:'ðŸ’°',t:'Financial Modeling & Valuation',p:'Wall Street Prep Â· ~$499',url:'wallstreetprep.com'},{ico:'ðŸ“‘',t:'CFA Level 1 Prep',p:'Kaplan Schweser Â· ~$300',url:'kaplanschweser.com'},{ico:'ðŸ¦',t:'Corporate Finance Fundamentals',p:'Coursera / Wharton Â· Free audit',url:'coursera.org'}],
  'default':[{ico:'ðŸ’¬',t:'Communication & Leadership',p:'Coursera / Wharton Â· Free audit',url:'coursera.org'},{ico:'ðŸ“‹',t:'Project Management Professional (PMP)',p:'PMI Â· ~$400',url:'pmi.org'},{ico:'ðŸŽ¯',t:'Critical Thinking & Problem Solving',p:'Coursera / Microsoft Â· Free',url:'coursera.org'},{ico:'ðŸŒ',t:'LinkedIn Learning Premium',p:'LinkedIn Â· $30/month',url:'linkedin.com/learning'}],
};
const PLATFORMS=[
  {ico:'ðŸ’¼',n:'LinkedIn Jobs',d:'#1 platform for professional roles'},
  {ico:'ðŸŽ“',n:'Internshala',d:'India\'s top internship platform'},
  {ico:'ðŸ¦„',n:'Wellfound (AngelList)',d:'Startup jobs & internships'},
  {ico:'ðŸ“Œ',n:'Indeed',d:'Millions of jobs worldwide'},
  {ico:'ðŸ”',n:'Glassdoor',d:'Jobs + company reviews'},
  {ico:'ðŸ¢',n:'Company Career Pages',d:'Apply directly for best results'},
];
function renderCourses(){
  const field=A.field||'default';
  const courses=COURSES_DB[field]||COURSES_DB['default'];
  const el=$('course-list'),desc=$('course-desc');
  if(desc)desc.textContent='Curated for '+(field!=='default'?field:'your field');
  if(el)el.innerHTML=courses.map(c=>'<div class="ccard" onclick="window.open(\'https://\'+\''+c.url+'\',\'_blank\')"><div class="ccico" style="background:var(--beige)">'+c.ico+'</div><div><div class="ct1">'+c.t+'</div><div class="cp1">'+c.p+'</div></div><i class="fas fa-external-link-alt" style="margin-left:auto;font-size:9px;color:var(--sand)"></i></div>').join('');
  const pEl=$('intern-plat');
  if(pEl)pEl.innerHTML=PLATFORMS.map(p=>'<div class="ccard"><div class="ccico" style="background:var(--beige)">'+p.ico+'</div><div><div class="ct1">'+p.n+'</div><div class="cp1">'+p.d+'</div></div></div>').join('');
}

// ---- RESUME RENDER ----
function renderResume(){
  const doc=$('resumeDoc');if(!doc)return;
  const p=A.personal,h=A.acH,a=A.acA,bg=A.acBG,tc=A.acT,fs=A.fs,ls=A.lineSpacing,al=A.align;
  const tmplObj=TMPLS.find(t=>t.id===A.tmpl)||TMPLS[0];
  const layout=tmplObj?.layout||'classic';
  const isSidebar=layout==='sidebar';
  const isTwoCol=layout==='twocol';
  const isDark=layout==='dark'||bg==='#0d1b2a'||bg==='#111111'||bg==='#1a0505';
  const skAll=allSk();
  const _showPh=$('show-photo')?.checked;
  const photoHTML=_showPh
    ? (A.photoData
        ? '<img src="'+A.photoData+'" style="width:80px;height:80px;border-radius:50%;object-fit:cover;border:3px solid '+a+';flex-shrink:0">'
        : '<div style="width:80px;height:80px;border-radius:50%;background:'+a+'22;border:3px solid '+a+';display:flex;align-items:center;justify-content:center;font-size:26px;font-weight:700;color:'+h+';flex-shrink:0">'+(p.name?p.name[0].toUpperCase():'A')+'</div>')
    : '';
  // â”€â”€ build section HTML helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const sec=(title,body)=>body?`<div style="margin-bottom:18px">
    <div style="font-size:${fs-1}px;font-weight:800;text-transform:uppercase;letter-spacing:1.6px;color:${h};border-bottom:2px solid ${a};padding-bottom:4px;margin-bottom:9px">${title}</div>
    ${body}</div>`:'';
  const secSB=(title,body)=>body?`<div style="margin-bottom:14px">
    <div style="font-size:${fs-2}px;font-weight:800;text-transform:uppercase;letter-spacing:1.4px;color:${a};padding-bottom:3px;margin-bottom:6px">${title}</div>
    ${body}</div>`:'';

  // â”€â”€ Experience â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const expHTML=A.exp.length?sec('Work Experience',A.exp.map(e=>`
    <div style="margin-bottom:13px">
      <div style="display:flex;justify-content:space-between;align-items:flex-start">
        <div>
          <div style="font-weight:700;font-size:${fs+1}px;color:${tc}">${e.role}</div>
          <div style="color:${a};font-size:${fs}px;font-weight:600">${e.company}${e.loc?' Â· '+e.loc:''}</div>
        </div>
        <div style="font-size:${fs-2}px;color:${tc}99;white-space:nowrap;margin-left:10px">${e.start||''}${e.end?' â€“ '+e.end:''}</div>
      </div>
      ${e.desc?`<div style="font-size:${fs-1}px;color:${tc}cc;margin-top:5px;line-height:${ls};text-align:${al};white-space:pre-line">${e.desc}</div>`:''}
    </div>`).join('')):'';

  const internSec=A.intern.length?sec(A.exp.length?'Internships':'Work Experience',A.intern.map(e=>`
    <div style="margin-bottom:12px">
      <div style="display:flex;justify-content:space-between">
        <div><div style="font-weight:700;font-size:${fs+1}px;color:${tc}">${e.role}</div>
        <div style="color:${a};font-size:${fs}px;font-weight:600">${e.company}${e.type?' Â· '+e.type:''}</div></div>
        <div style="font-size:${fs-2}px;color:${tc}99">${e.start||''}${e.end?' â€“ '+e.end:''}</div>
      </div>
      ${e.desc?`<div style="font-size:${fs-1}px;color:${tc}cc;margin-top:4px;line-height:${ls}">${e.desc}</div>`:''}
    </div>`).join('')):'';

  const eduHTML=A.edu.length?sec('Education',A.edu.map(e=>`
    <div style="margin-bottom:10px">
      <div style="display:flex;justify-content:space-between">
        <div>
          <div style="font-weight:700;font-size:${fs+1}px;color:${tc}">${e.deg}${e.field?' in '+e.field:''}</div>
          <div style="color:${a};font-size:${fs}px">${e.inst}${e.loc?' Â· '+e.loc:''}</div>
        </div>
        <div style="font-size:${fs-2}px;color:${tc}99">${e.sy||''}${e.ey?' â€“ '+e.ey:''}</div>
      </div>
      ${e.gpa?`<div style="font-size:${fs-2}px;color:${tc}99;margin-top:1px">GPA: ${e.gpa}</div>`:''}
      ${e.acts?`<div style="font-size:${fs-2}px;color:${tc}cc;margin-top:2px">${e.acts}</div>`:''}
    </div>`).join('')):'';

  const skGroups=[{l:'Technical Skills',d:A.skills.tech},{l:'Professional Skills',d:A.skills.prof},{l:'Tools',d:A.skills.tools},{l:'Frameworks',d:A.skills.fw}].filter(g=>g.d.length);
  const skBody=skGroups.map(g=>`<div style="margin-bottom:8px">
    <div style="font-size:${fs-2}px;font-weight:700;color:${h};text-transform:uppercase;letter-spacing:.7px;margin-bottom:4px">${g.l}</div>
    <div style="display:flex;flex-wrap:wrap;gap:4px">${g.d.map(s=>`<span style="background:${a}18;color:${h};border:1px solid ${a}44;border-radius:20px;padding:2px 9px;font-size:${fs-2}px;font-weight:600">${s.n}</span>`).join('')}</div>
    </div>`).join('');
  const skHTML=skGroups.length?sec('Skills',skBody):'';

  const certHTML=A.certs.length?sec('Certifications',A.certs.map(c=>`
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:7px;padding:5px 0;border-bottom:1px solid ${a}22">
      <div><div style="font-weight:700;font-size:${fs}px;color:${tc}">${c.name}</div>
      <div style="font-size:${fs-1}px;color:${a}">${c.issuer}</div></div>
      <div style="font-size:${fs-2}px;color:${tc}99">${c.date||''}</div>
    </div>`).join('')):'';

  const projHTML=A.proj.length?sec('Projects',A.proj.map(pr=>`
    <div style="margin-bottom:12px">
      <div style="display:flex;justify-content:space-between;align-items:flex-start">
        <div>
          <div style="font-weight:700;font-size:${fs+1}px;color:${tc}">${pr.name}${pr.role?` <span style="color:${a};font-weight:600;font-size:${fs}px">Â· ${pr.role}</span>`:''}</div>
          ${pr.tech?`<div style="font-size:${fs-2}px;color:${a};margin-top:1px">${pr.tech}</div>`:''}
        </div>
        <div style="font-size:${fs-2}px;color:${tc}99">${pr.dur||''}</div>
      </div>
      ${pr.desc?`<div style="font-size:${fs-1}px;color:${tc}cc;margin-top:4px;line-height:${ls}">${pr.desc}</div>`:''}
      ${pr.git||pr.live?`<div style="margin-top:4px;display:flex;gap:10px">${pr.git?`<a href="https://${pr.git}" style="font-size:${fs-2}px;color:${a}">GitHub â†—</a>`:''}${pr.live?`<a href="https://${pr.live}" style="font-size:${fs-2}px;color:${a}">Live â†—</a>`:''}</div>`:''}
    </div>`).join('')):'';

  const customHTML=A.customText?sec('Additional',`<div style="font-size:${fs}px;color:${tc}cc;line-height:${ls};text-align:${al}">${A.customText}</div>`):'';

  // â”€â”€ CONTACT LINE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const contactLine=[
    p.email?`<span>âœ‰ ${p.email}</span>`:'',p.phone?`<span>âœ† ${p.phone}</span>`:'',
    p.location?`<span>ðŸ“ ${p.location}</span>`:'',p.linkedin?`<span>ðŸ”— ${p.linkedin}</span>`:'',
    p.github?`<span>ðŸ’» ${p.github}</span>`:'',p.website?`<span>ðŸŒ ${p.website}</span>`:''
  ].filter(Boolean).join('<span style="opacity:.4;margin:0 4px">Â·</span>');

  // â”€â”€ SIDEBAR LAYOUT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  if(isSidebar){
    const sbSkBody=skGroups.map(g=>`<div style="margin-bottom:9px"><div style="font-size:${fs-3}px;font-weight:700;color:${a};text-transform:uppercase;letter-spacing:.6px;margin-bottom:3px">${g.l}</div><div style="display:flex;flex-wrap:wrap;gap:3px">${g.d.map(s=>`<span style="background:rgba(255,255,255,.12);color:#fff;border-radius:20px;padding:1px 7px;font-size:${fs-3}px;font-weight:600">${s.n}</span>`).join('')}</div></div>`).join('');
    doc.innerHTML=`<div id="resume-content" style="font-family:${A.font};background:${bg};color:${tc};font-size:${fs}px;line-height:${ls};display:flex;min-height:960px">
      <div style="width:210px;flex-shrink:0;background:${h};padding:20px 16px;color:#fff">
        ${photoHTML?`<div style="margin:0 auto 14px;width:72px;height:72px;border-radius:50%;overflow:hidden;border:3px solid ${a}">${photoHTML.replace(/width:80px.*?flex-shrink:0/,'width:72px;height:72px;object-fit:cover;border:none;flex-shrink:0')}</div>`:'<div style="margin:0 auto 14px;width:60px;height:60px;border-radius:50%;background:${a}33;border:3px solid ${a};display:flex;align-items:center;justify-content:center;font-size:22px;font-weight:700">${p.name?p.name[0].toUpperCase():"A"}</div>'}
        <div style="text-align:center;margin-bottom:16px">
          <div style="font-size:${fs+4}px;font-weight:700;color:#fff">${p.name||'Your Name'}</div>
          ${p.title?`<div style="font-size:${fs-1}px;color:${a};margin-top:3px;font-weight:600">${p.title}</div>`:''}
        </div>
        <div style="height:1px;background:${a};opacity:.3;margin-bottom:14px"></div>
        ${secSB('Contact','<div style="font-size:'+String(fs-2)+'px;display:flex;flex-direction:column;gap:4px;opacity:.9">'+(p.email?'<div>'+p.email+'</div>':'')+(p.phone?'<div>'+p.phone+'</div>':'')+(p.location?'<div>'+p.location+'</div>':'')+(p.linkedin?'<div>'+p.linkedin+'</div>':'')+(p.github?'<div>'+p.github+'</div>':'')+'</div>')}
        ${skGroups.length?secSB('Skills',sbSkBody):''}
        ${A.certs.length?secSB('Certifications',A.certs.map(c=>'<div style="margin-bottom:6px"><div style="font-weight:700;font-size:'+String(fs-2)+'px">'+c.name+'</div><div style="opacity:.7;font-size:'+String(fs-3)+'px">'+c.issuer+'</div></div>').join('')):''}
      </div>
      <div style="flex:1;padding:24px 26px;min-width:0">
        ${p.title||p.targetRole?`<div style="margin-bottom:16px"><div style="font-size:${fs+2}px;font-weight:700;color:${h}">${p.title||p.targetRole}</div><div style="height:2px;background:${a};width:50px;margin-top:5px;border-radius:1px"></div></div>`:''}
        ${A.summary?`<div style="margin-bottom:16px;font-size:${fs}px;color:${tc}bb;line-height:${ls};font-style:italic">${A.summary}</div>`:''}
        ${expHTML}${internSec}${eduHTML}${projHTML}${customHTML}
      </div>
    </div>`;
    return;
  }

  // â”€â”€ TWO-COLUMN LAYOUT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  if(isTwoCol){
    doc.innerHTML=`<div id="resume-content" style="font-family:${A.font};background:${bg};color:${tc};font-size:${fs}px;line-height:${ls};min-height:960px">
      <div style="background:${h};padding:22px 28px;color:#fff">
        <div style="display:flex;align-items:center;gap:16px">
          ${photoHTML||`<div style="width:72px;height:72px;border-radius:50%;background:${a}33;border:3px solid ${a};display:flex;align-items:center;justify-content:center;font-size:24px;font-weight:700;flex-shrink:0">${p.name?p.name[0].toUpperCase():"A"}</div>`}
          <div>
            <div style="font-size:${fs+12}px;font-weight:700;letter-spacing:-.5px">${p.name||'Your Name'}</div>
            ${p.title?`<div style="font-size:${fs+2}px;color:${a};font-weight:600;margin-top:2px">${p.title}</div>`:''}
            <div style="font-size:${fs-1}px;opacity:.7;margin-top:4px">${contactLine}</div>
          </div>
        </div>
      </div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:0;padding:0">
        <div style="padding:20px 18px 20px 24px;border-right:1.5px solid ${a}22">
          ${expHTML}${internSec}${projHTML}
        </div>
        <div style="padding:20px 24px 20px 18px">
          ${A.summary?sec('Profile',`<div style="font-size:${fs}px;color:${tc}bb;line-height:${ls};font-style:italic">${A.summary}</div>`):''}
          ${eduHTML}${skHTML}${certHTML}${customHTML}
        </div>
      </div>
    </div>`;
    return;
  }

  // â”€â”€ DEFAULT (classic / banner / accent / minimal / dark / card) â”€â”€
  doc.innerHTML=`<div id="resume-content" style="font-family:${A.font};background:${bg};color:${tc};min-height:960px;font-size:${fs}px;line-height:${ls}">
    <div style="background:${h};padding:26px 32px;color:#fff;position:relative;overflow:hidden">
      ${isDark?`<div style="position:absolute;top:-30px;right:-30px;width:120px;height:120px;border-radius:50%;background:${a};opacity:.08"></div><div style="position:absolute;bottom:-20px;left:40%;width:80px;height:80px;border-radius:50%;background:${a};opacity:.06"></div>`:''}
      <div style="display:flex;align-items:center;gap:18px;position:relative">
        ${photoHTML||`<div style="width:76px;height:76px;border-radius:50%;background:${a}33;border:3px solid ${a};display:flex;align-items:center;justify-content:center;font-size:24px;font-weight:700;flex-shrink:0">${p.name?p.name[0].toUpperCase():"A"}</div>`}
        <div style="flex:1">
          <h1 style="font-size:${fs+13}px;font-weight:700;letter-spacing:-.5px;margin-bottom:2px">${p.name||'Your Name'}</h1>
          ${p.title?`<div style="font-size:${fs+2}px;opacity:.82;margin-bottom:6px;font-weight:300">${p.title}</div>`:''}
          <div style="display:flex;flex-wrap:wrap;gap:12px;font-size:${fs-1}px;opacity:.78">${contactLine}</div>
        </div>
      </div>
    </div>
    <div style="padding:22px 32px">
      ${A.summary?`<div style="margin-bottom:18px;padding:13px 16px;background:${a}11;border-left:3px solid ${a};border-radius:0 6px 6px 0"><div style="font-size:${fs+1}px;font-style:italic;color:${tc}cc;line-height:${ls};text-align:${al}">${A.summary}</div></div>`:''}
      ${expHTML}${internSec}${eduHTML}${skHTML}${projHTML}${certHTML}${customHTML}
    </div>
  </div>`;
}


// ---- CHARTS ----
let chartInst={};
function buildCharts(){
  const warmColors=['rgba(196,149,106,.85)','rgba(212,168,83,.85)','rgba(192,96,58,.85)','rgba(122,140,110,.85)','rgba(125,78,46,.85)','rgba(61,35,20,.75)'];
  const warmBorders=['#C4956A','#D4A853','#C0603A','#7A8C6E','#7D4E2E','#3D2314'];
  const opts={responsive:true,plugins:{legend:{display:false},tooltip:{backgroundColor:'rgba(61,35,20,.9)',titleColor:'#D4A853',bodyColor:'#FDF6EC'}}};
  // Radar
  const rc=$('c-radar');if(rc){
    const skNames=allSk().slice(0,8).map(s=>s.n);
    const skVals=allSk().slice(0,8).map(s=>s.l);
    if(chartInst.radar)chartInst.radar.destroy();
    if(skNames.length>=3){
      chartInst.radar=new Chart(rc,{type:'radar',data:{labels:skNames,datasets:[{data:skVals,backgroundColor:'rgba(196,149,106,.25)',borderColor:'#C4956A',borderWidth:2,pointBackgroundColor:'#D4A853',pointRadius:4}]},options:{...opts,scales:{r:{backgroundColor:'rgba(196,149,106,.04)',grid:{color:'rgba(196,149,106,.2)'},pointLabels:{color:'#7D4E2E',font:{size:10,weight:'700'}},ticks:{display:false},angleLines:{color:'rgba(196,149,106,.2)'},min:0,max:100}}}});
    }
  }
  // Bar
  const bc=$('c-bar');if(bc){
    const{checks}=calcATS();
    if(chartInst.bar)chartInst.bar.destroy();
    chartInst.bar=new Chart(bc,{type:'bar',data:{labels:checks.map(c=>c.l),datasets:[{data:checks.map(c=>c.has?c.w:0),backgroundColor:warmColors,borderColor:warmBorders,borderWidth:1.5,borderRadius:5}]},options:{...opts,scales:{x:{ticks:{color:'#7D4E2E',font:{size:9}},grid:{display:false}},y:{ticks:{color:'#7D4E2E',font:{size:9}},grid:{color:'rgba(196,149,106,.12)'}}}}});
  }
  // Donut
  const dc=$('c-donut');if(dc){
    const vals=[A.exp.length>0?1:0,A.edu.length>0?1:0,allSk().length>0?1:0,A.certs.length>0?1:0,A.proj.length>0?1:0,A.summary.length>0?1:0];
    const lbls=['Experience','Education','Skills','Certs','Projects','Summary'];
    if(chartInst.donut)chartInst.donut.destroy();
    chartInst.donut=new Chart(dc,{type:'doughnut',data:{labels:lbls,datasets:[{data:vals,backgroundColor:warmColors,borderColor:'#FDF6EC',borderWidth:2}]},options:{...opts,plugins:{legend:{display:true,position:'bottom',labels:{color:'#7D4E2E',font:{size:9},padding:6,boxWidth:12}}},cutout:'62%'}});
  }
}

// ---- VISUALIZATION DASHBOARD ----
let vizCharts={};
function buildViz(){
  const{score,checks}=calcATS();const p=A.personal;
  const name=(p.name||'Your Resume');
  const vn=$('viz-name');if(vn)vn.textContent=name+' â€” Analytics';
  const skCount=allSk().length;const totalExp=A.exp.length+A.intern.length;
  const warmC=['rgba(196,149,106,.85)','rgba(212,168,83,.85)','rgba(192,96,58,.85)','rgba(122,140,110,.85)','rgba(125,78,46,.85)','rgba(212,168,83,.65)'];
  const warmB=['#C4956A','#D4A853','#C0603A','#7A8C6E','#7D4E2E','#B8732A'];
  // Grid cards
  const grid=$('viz-g');
  if(grid){grid.innerHTML=`
    <div class="vc"><div class="vc-t"><i class="fas fa-star"></i> ATS Score</div><span class="vn" style="color:${score>=65?'var(--sage)':score>=40?'var(--amber)':'var(--rust)'};">${score}</span><span class="vl">out of 100</span><div class="vbar"><div class="vfi" id="vf-ats"></div></div></div>
    <div class="vc"><div class="vc-t"><i class="fas fa-code"></i> Total Skills</div><span class="vn" style="color:var(--caramel)">${skCount}</span><span class="vl">skills added</span><div class="vbar"><div class="vfi" id="vf-sk"></div></div></div>
    <div class="vc"><div class="vc-t"><i class="fas fa-briefcase"></i> Work/Internships</div><span class="vn" style="color:var(--amber)">${totalExp}</span><span class="vl">entries</span><div class="vbar"><div class="vfi" id="vf-exp"></div></div></div>
    <div class="vc wide"><div class="vc-t"><i class="fas fa-spider"></i> Skill Proficiency Radar</div><canvas id="viz-radar" height="160"></canvas></div>
    <div class="vc">
      <div class="vc-t"><i class="fas fa-check-circle"></i> Section Status</div>
      ${[['Experience',A.exp.length>0||A.intern.length>0],['Education',A.edu.length>0],['Skills',skCount>=5],['Summary',A.summary.length>50],['Certifications',A.certs.length>0],['Projects',A.proj.length>0]].map(([l,ok])=>'<div class="sc-r"><div class="sc-l">'+l+'</div><div class="sc-tr"><div class="sc-fi" id="vsf-'+l.toLowerCase().slice(0,4)+'" style="width:'+(ok?'100':'20')+'%;background:'+(ok?'var(--sage)':'var(--rust)')+'"></div></div><div class="sc-p">'+(ok?'âœ“':'â€”')+'</div></div>').join('')}
    </div>
    <div class="vc"><div class="vc-t"><i class="fas fa-chart-pie"></i> Balance</div><canvas id="viz-donut" height="140"></canvas></div>
  `;}
  // Animate bars
  setTimeout(()=>{
    const vfa=$('vf-ats');if(vfa)vfa.style.width=score+'%';
    const vfsk=$('vf-sk');if(vfsk)vfsk.style.width=Math.min(100,skCount*6)+'%';
    const vfex=$('vf-exp');if(vfex)vfex.style.width=Math.min(100,totalExp*25)+'%';
  },200);
  // Radar
  const vrc=$('viz-radar');if(vrc){
    const skNames=allSk().slice(0,8).map(s=>s.n);const skVals=allSk().slice(0,8).map(s=>s.l);
    if(vizCharts.radar)vizCharts.radar.destroy();
    if(skNames.length>=3){vizCharts.radar=new Chart(vrc,{type:'radar',data:{labels:skNames,datasets:[{data:skVals,backgroundColor:'rgba(196,149,106,.22)',borderColor:'#C4956A',borderWidth:2,pointBackgroundColor:'#D4A853',pointRadius:4}]},options:{responsive:true,plugins:{legend:{display:false}},scales:{r:{backgroundColor:'rgba(196,149,106,.04)',grid:{color:'rgba(196,149,106,.2)'},pointLabels:{color:'#7D4E2E',font:{size:10,weight:'700'}},ticks:{display:false},min:0,max:100}}}});}
  }
  // Donut
  const vdc=$('viz-donut');if(vdc){
    const vals=[A.exp.length?1:0,A.edu.length?1:0,skCount>0?1:0,A.certs.length?1:0,A.proj.length?1:0,A.summary.length?1:0];
    if(vizCharts.donut)vizCharts.donut.destroy();
    vizCharts.donut=new Chart(vdc,{type:'doughnut',data:{labels:['Experience','Education','Skills','Certs','Projects','Summary'],datasets:[{data:vals,backgroundColor:warmC,borderColor:'#FDF6EC',borderWidth:2}]},options:{responsive:true,plugins:{legend:{display:true,position:'bottom',labels:{color:'#7D4E2E',font:{size:9},padding:6,boxWidth:10}}},cutout:'58%'}});
  }
  // Main bar chart
  const vmc=$('viz-main');if(vmc){
    const sects=[['Name',p.name?100:0],['Email',p.email?100:0],['Summary',A.summary.length>50?100:Math.round(A.summary.length/50*100)],['Skills',Math.min(100,skCount*7)],['Experience',Math.min(100,A.exp.length*30)],['Internship',Math.min(100,A.intern.length*50)],['Education',Math.min(100,A.edu.length*100)],['Projects',Math.min(100,A.proj.length*50)],['Certs',Math.min(100,A.certs.length*50)],['LinkedIn',p.linkedin?100:0]];
    if(vizCharts.main)vizCharts.main.destroy();
    vizCharts.main=new Chart(vmc,{type:'bar',data:{labels:sects.map(s=>s[0]),datasets:[{label:'Completion %',data:sects.map(s=>s[1]),backgroundColor:warmC,borderColor:warmB,borderWidth:2,borderRadius:6}]},options:{responsive:true,plugins:{legend:{display:false},tooltip:{backgroundColor:'rgba(61,35,20,.9)',titleColor:'#D4A853',bodyColor:'#FDF6EC'}},scales:{x:{ticks:{color:'#7D4E2E',font:{weight:'700'}},grid:{display:false}},y:{min:0,max:100,ticks:{color:'#7D4E2E',callback:v=>v+'%'},grid:{color:'rgba(196,149,106,.12)'}}}}});
  }
  // Final score
  const fin=$('viz-final');if(fin){
    const cats=[['ATS Compatibility',score,'Based on resume completeness'],['Skills Depth',Math.min(100,skCount*5),'Technical & professional skills'],['Content Quality',A.summary.length>100?85:A.summary.length>30?60:20,'Summary & achievement quality'],['Work Evidence',Math.min(100,(A.exp.length+A.intern.length)*30),'Experience & internship entries'],['Professional Assets',Math.min(100,(A.certs.length+A.proj.length)*25),'Certifications & projects'],];
    const overall=Math.round(cats.reduce((s,c)=>s+c[1],0)/cats.length);
    fin.innerHTML=`<div style="text-align:center;margin-bottom:20px"><span style="font-family:'Cormorant Garamond',serif;font-size:64px;font-weight:700;color:${overall>=70?'var(--sage)':overall>=50?'var(--amber)':'var(--rust)'}">${overall}</span><span style="font-size:14px;color:var(--brown)">/100</span><div style="font-size:13px;font-weight:700;color:var(--brown);margin-top:2px">${overall>=80?'Outstanding Resume ðŸ†':overall>=65?'Strong Resume â­':overall>=50?'Good Resume ðŸ‘':overall>=35?'Developing Resume ðŸ“ˆ':'Needs Attention ðŸ”§'}</div></div>`+cats.map(c=>'<div class="sc-r"><div class="sc-l">'+c[0]+'</div><div class="sc-tr"><div class="sc-fi" style="width:'+c[1]+'%;background:linear-gradient(90deg,var(--caramel),var(--gold))"></div></div><div class="sc-p">'+c[1]+'</div></div>').join('');
  }

  // Skills Distribution Pie
  const spc=$('viz-skills-pie');if(spc){
    const skT=[A.skills.tech.length,A.skills.prof.length,A.skills.tools.length,A.skills.fw.length];
    if(vizCharts.skPie)vizCharts.skPie.destroy();
    vizCharts.skPie=new Chart(spc,{type:'pie',data:{labels:['Technical','Professional','Tools','Frameworks'],datasets:[{data:skT.some(x=>x>0)?skT:[1,1,1,1],backgroundColor:warmC.slice(0,4),borderWidth:1,borderColor:'#fff'}]},options:{responsive:true,plugins:{legend:{position:'bottom',labels:{font:{size:9},padding:6}}}}});
  }
  // Student vs Professional Pie
  const ppc=$('viz-profile-pie');if(ppc){
    const stuS=Math.min(100,A.intern.length*30+A.proj.length*20+A.edu.length*20+(A.skills.tech.length*5));
    const proS=Math.min(100,A.exp.length*30+(A.skills.tech.length*4)+(A.summary.length>80?15:0)+A.certs.length*10);
    if(vizCharts.profPie)vizCharts.profPie.destroy();
    vizCharts.profPie=new Chart(ppc,{type:'pie',data:{labels:['Student Profile','Professional Profile'],datasets:[{data:[stuS||50,proS||50],backgroundColor:['rgba(196,149,106,.8)','rgba(122,140,110,.8)'],borderWidth:2,borderColor:'#fff'}]},options:{responsive:true,plugins:{legend:{position:'bottom',labels:{font:{size:10},padding:8}}}}});
  }
}

// ---- RECRUITER ----
let _recMode='strong';
function selRM(mode){
  _recMode=mode;A.recMode=mode;
  const strong=$('rm-strong'),blank=$('rm-blank');
  if(strong&&blank){
    strong.className='sug'+(mode==='strong'?' ok':'');
    blank.className='sug'+(mode==='blank'?' ok':'');
  }
  showToast(mode==='strong'?'Strong Analysis: Specific role matching':'Domain Analysis: Industry fitness check');
}
function runRecA(){
  const role=v('rec-role'),skills=v('rec-skills'),niceRaw=v('rec-nice-skills'),expReq=v('rec-exp'),eduReq=v('rec-edu-req');
  if(!role){showToast('Enter a job title/role to analyze');return;}
  const required=skills?skills.split(',').map(s=>s.trim()).filter(Boolean):['JavaScript','React','Node.js','SQL','Communication'];
  const nice=niceRaw?niceRaw.split(',').map(s=>s.trim()).filter(Boolean):[];
  const candSk=allSk();const candSkL=candSk.map(s=>s.n.toLowerCase());
  const matched=required.filter(s=>candSkL.some(c=>c.includes(s.toLowerCase())||s.toLowerCase().includes(c)));
  const missing=required.filter(s=>!candSkL.some(c=>c.includes(s.toLowerCase())||s.toLowerCase().includes(c)));
  const niceMatched=nice.filter(s=>candSkL.some(c=>c.includes(s.toLowerCase())));
  const matchPct=required.length?Math.round(matched.length/required.length*100):0;
  const expScore=Math.min(100,(A.exp.length*28)+(A.intern.length*15)+(A.edu.length*12));
  const eduScore=A.edu.length?(eduReq==='Any'||eduReq===''?90:eduReq.includes("Bachelor")&&A.edu.some(e=>e.deg.includes("Bachelor")||e.deg.includes("Master")||e.deg==='MBA'||e.deg==='PhD')?100:70):0;
  const overall=Math.min(100,Math.round(matchPct*0.55+expScore*0.25+eduScore*0.1+calcATS().score*0.1));
  const res=$('rec-results');if(res)res.style.display='block';
  const rtl=$('rec-res-title');if(rtl)rtl.textContent='Analysis: '+role+' Candidate';
  const rsub=$('rec-res-sub');if(rsub)rsub.textContent='Required skills match: '+matchPct+'% Â· Experience score: '+expScore+'% Â· Overall fit: '+overall+'/100';
  const barsEl=$('rec-bars');
  if(barsEl)barsEl.innerHTML=[
    {l:'Required Skills Match',v:matchPct,c:'#7A8C6E'},{l:'Nice-to-have Skills',v:nice.length?Math.round(niceMatched.length/nice.length*100):0,c:'#C4956A'},
    {l:'Experience Depth',v:expScore,c:'#D4A853'},{l:'Education Match',v:eduScore,c:'#B8732A'},{l:'Overall Fit',v:overall,c:'#3D2314'}
  ].map(b=>'<div class="str-b"><div class="str-l">'+b.l+'</div><div class="str-tr"><div class="str-fi" style="width:'+b.v+'%;background:'+b.c+'"></div></div><span style="font-size:10px;font-weight:700;color:var(--dark);min-width:32px;text-align:right">'+b.v+'%</span></div>').join('');
  // Missing & Matching chips
  const missEl=$('rec-missing-skills');
  if(missEl)missEl.innerHTML=missing.length?missing.map(s=>'<span class="miss-chip"><i class="fas fa-times" style="font-size:8px"></i> '+s+'</span>').join(''):'<span style="font-size:11px;color:var(--sage);font-weight:700">âœ… All required skills found!</span>';
  const matchEl=$('rec-matching-skills');
  if(matchEl)matchEl.innerHTML=matched.length?matched.map(s=>'<span class="match-chip"><i class="fas fa-check" style="font-size:8px"></i> '+s+'</span>').join('') + (niceMatched.length?' <span style="font-size:10px;color:var(--brown);margin-left:5px">+'+niceMatched.length+' nice-to-have</span>':''):'<span style="font-size:11px;color:var(--rust);font-style:italic">No matching skills found</span>';
  // Resume preview
  const prev=$('rec-resume-preview');
  if(prev)prev.innerHTML='<div style="font-family:monospace;font-size:11px;line-height:1.6"><strong>'+((A.personal.name||'Candidate')+'\n'+(A.personal.title||'')+'\n'+(A.personal.email||'')+(A.personal.phone?' Â· '+A.personal.phone:'')+'\n\n'+['=== SKILLS ===',candSk.slice(0,12).map(s=>s.n+' ('+s.l+'%)').join(', '),'\n=== EXPERIENCE ===',A.exp.map(e=>e.role+' @ '+e.company+' ('+e.start+' â€“ '+e.end+')').join('\n'),A.intern.map(e=>e.role+' @ '+e.company+' (intern)').join('\n'),'\n=== EDUCATION ===',A.edu.map(e=>e.deg+(e.field?' in '+e.field:'')+' Â· '+e.inst).join('\n')].join('\n')).replace(/\n/g,'<br>')+'</strong></div>';
  // Destroy old charts
  ['_rRadar','_rPie','_rBar'].forEach(k=>{if(window[k])try{window[k].destroy();}catch(e){}});
  setTimeout(()=>{
    const ctx=id=>{const c=$(id);return c?c.getContext('2d'):null;};
    const skillLabels=candSk.slice(0,6).map(s=>s.n.substring(0,12));
    const skillData=candSk.slice(0,6).map(s=>s.l);
    if(ctx('rec-radar')){try{window._rRadar=new Chart(ctx('rec-radar'),{type:'radar',data:{labels:skillLabels.length?skillLabels:['Add Skills'],datasets:[{label:'Level',data:skillData.length?skillData:[0],backgroundColor:'rgba(196,149,106,.22)',borderColor:'#C4956A',borderWidth:2,pointBackgroundColor:'#D4A853'}]},options:{responsive:true,plugins:{legend:{display:false}},scales:{r:{beginAtZero:true,max:100,ticks:{font:{size:8}},pointLabels:{color:'#7D4E2E',font:{size:9}}}}}});}catch(e){}}
    if(ctx('rec-pie')){try{window._rPie=new Chart(ctx('rec-pie'),{type:'pie',data:{labels:['Required Found','Missing Required','Nice-to-have Found'],datasets:[{data:[matched.length,missing.length,niceMatched.length||0.001],backgroundColor:['rgba(122,140,110,.8)','rgba(192,96,58,.8)','rgba(212,168,83,.8)'],borderWidth:1}]},options:{responsive:true,plugins:{legend:{position:'bottom',labels:{font:{size:9},padding:6}}}}});}catch(e){}}
    const skByType=[A.skills.tech.length,A.skills.prof.length,A.skills.tools.length,A.skills.fw.length];
    if(ctx('rec-bar')){try{window._rBar=new Chart(ctx('rec-bar'),{type:'bar',data:{labels:['Technical','Professional','Tools','Frameworks'],datasets:[{data:skByType,backgroundColor:['rgba(196,149,106,.75)','rgba(122,140,110,.75)','rgba(192,96,58,.75)','rgba(212,168,83,.75)'],borderRadius:5}]},options:{responsive:true,plugins:{legend:{display:false}},scales:{y:{beginAtZero:true,ticks:{font:{size:8}}},x:{ticks:{font:{size:8}}}}}});}catch(e){}}
    const matEl=$('rec-matrix');
    if(matEl)matEl.innerHTML='<table class="rec-matrix"><tr><th>Requirement</th><th>Status</th></tr>'+required.map(r=>'<tr><td>'+r+'</td><td style="color:'+(matched.includes(r)?'var(--sage)':'var(--rust)')+'font-weight:700">'+(matched.includes(r)?'âœ“ Found':'âœ— Missing')+'</td></tr>').join('')+nice.map(n=>'<tr><td style="opacity:.7">'+n+' (nice)</td><td style="color:'+(niceMatched.includes(n)?'var(--sage)':'var(--sand)')+'">'+( niceMatched.includes(n)?'âœ“':'â€”')+'</td></tr>').join('')+'</table>';
  },300);
  // Verdict
  const vEl=$('rec-verdict');
  if(vEl){const isStrong=overall>=80,isMid=overall>=60;
    const clr=isStrong?'var(--sage)':isMid?'var(--amber,#B8732A)':'var(--rust)';
    const label=isStrong?'âœ… Strong Match':isMid?'âš¡ Consider for Role':'âš ï¸ Not Recommended';
    const msg=isStrong?'Excellent alignment with the '+role+' role. All required skills present. Recommend advancing to interview stage.':isMid?'Moderate alignment. Candidate has '+matched.length+'/'+required.length+' required skills. Consider for screening interview.':'Significant skill gaps for '+role+'. Missing: '+missing.slice(0,3).join(', ')+'. Recommend skill development first.';
    vEl.innerHTML='<div class="a-card" style="border-color:'+clr+'44"><div style="display:flex;align-items:center;gap:12px"><div style="font-size:36px;font-family:\'Cormorant Garamond\',serif;font-weight:700;color:'+clr+'">'+overall+'%</div><div><div style="font-weight:800;font-size:14px;color:'+clr+'">'+label+'</div><div style="font-size:11px;color:var(--dark);margin-top:3px;line-height:1.5">'+msg+'</div></div></div></div>';}
  showToast('Analysis complete! Fit score: '+overall+'% âœ“');
}

// ---- CHINKO AI BOT ----
const CHINKO_KB={
  'ats score':{title:'ðŸŽ¯ ATS Score Guide',body:'Your <strong>ATS Score</strong> measures how well your resume passes automated screening. Key factors:<br>â€¢ <strong>Keywords:</strong> Match job description exactly<br>â€¢ <strong>Sections:</strong> Name, contact, summary, experience, education, skills<br>â€¢ <strong>Format:</strong> Clean text, no tables, no graphics in ATS zone<br>â€¢ <strong>Completeness:</strong> Fill ALL sections for max points<br>ðŸ’¡ <em>Pro tip: Tailor keywords for each specific job application!</em>'},
  'ats':{title:'ðŸ¤– What is ATS?',body:'<strong>ATS (Applicant Tracking System)</strong> is software companies use to automatically screen resumes before humans see them.<br><br>â€¢ 75% of large companies use ATS<br>â€¢ 98% of Fortune 500 companies use it<br>â€¢ A resume rejected by ATS never reaches a human<br><br>To beat ATS: use the right keywords, keep formatting clean, and fill all sections completely.'},
  'template':{title:'ðŸ“‹ Choosing Templates',body:'Choose templates strategically:<br><br>â€¢ <strong>Finance/Law/Corporate:</strong> Classic Navy, Charcoal Elite â€” conservative &amp; professional<br>â€¢ <strong>Tech/Engineering:</strong> Ocean Blue, Emerald Pro â€” clean and modern<br>â€¢ <strong>Design/Creative:</strong> Rose Quartz, Copper Blaze â€” creative flair<br>â€¢ <strong>Students/Freshers:</strong> Warm Amber, Arctic White â€” clean, readable<br><br>ðŸ’¡ Free users get 5 templates. Upgrade for 40+ Pro templates!'},
  'fresher':{title:'ðŸŽ“ Fresher Resume Tips',body:'As a fresher, focus on:<br><br>âœ… <strong>Projects:</strong> 2-3 strong academic/personal projects beat no experience<br>âœ… <strong>Internships:</strong> Even 1-month internships add huge value<br>âœ… <strong>Skills:</strong> List ALL technical skills including tools from classes<br>âœ… <strong>Certifications:</strong> Free certs from Google, AWS, Coursera = credibility<br>âœ… <strong>GPA:</strong> Include if 3.5+/4.0<br>âœ… <strong>Activities:</strong> Clubs, competitions, hackathons, open-source<br><br>ðŸ’¡ A well-structured fresher resume can beat experienced candidates with poor resumes!'},
  'summary':{title:'âœï¸ Writing a Powerful Summary',body:'Your professional summary is the #1 most-read section. Formula:<br><br><strong>[Role] + [Years/Background] + [Top Skills] + [Key Achievement] + [Career Goal]</strong><br><br>Example for developer:<br><em>"Results-driven Full Stack Developer with 3 years building scalable web applications using React and Node.js. Delivered 40% performance improvements at XYZ Corp. Passionate about clean architecture and team-driven development."</em><br><br>ðŸ’¡ Use the <strong>AI Generate</strong> button for a personalized summary!'},
  'skills':{title:'ðŸ› ï¸ Skills Strategy',body:'Strategic skills section tips:<br><br>â€¢ Add <strong>Technical + Professional + Tools + Frameworks</strong> separately<br>â€¢ Include <strong>15-20 skills</strong> minimum for strong ATS performance<br>â€¢ Use <strong>exact keywords</strong> from job descriptions<br>â€¢ Rate honestly â€” ATS doesn\'t see ratings, but interviews do<br>â€¢ <strong>Freshers:</strong> Include even basic skills from courses<br>â€¢ <strong>Pros:</strong> Focus on senior/specialized skills<br><br>ðŸ’¡ Click "Suggested for your role" to get AI-recommended skills!'},
  'grammar':{title:'ðŸ“ Grammar Check',body:'Elyssor\'s Grammar Checker automatically detects:<br><br>â€¢ Spelling errors (recieve â†’ receive)<br>â€¢ Case issues (i â†’ I)<br>â€¢ Common word mistakes<br>â€¢ Typos and inconsistencies<br><br><strong>Free plan:</strong> See 5 errors<br><strong>Pro/Premium:</strong> Unlimited corrections + file upload<br><br>ðŸ’¡ Upload your existing resume file in the Grammar section for a full scan!'},
  'leadership':{title:'ðŸ’¼ Showcasing Leadership',body:'For professionals, leadership presence is critical:<br><br>âœ… <strong>Quantify team size:</strong> "Led team of 12 engineers"<br>âœ… <strong>Show impact:</strong> "Reduced costs by $2M annually"<br>âœ… <strong>Strategic language:</strong> "Architected," "Spearheaded," "Drove"<br>âœ… <strong>Cross-functional work:</strong> Mention teams you collaborated with<br>âœ… <strong>Mentorship:</strong> List if you coached or mentored others<br><br>ðŸ’¡ Use action verbs: Led, Spearheaded, Orchestrated, Drove, Transformed!'},
  'pdf':{title:'ðŸ“„ PDF Export',body:'Export your resume as PDF:<br><br>1. Click <strong>Export PDF</strong> in the preview area<br>2. Your resume will be generated as a clean PDF<br>3. Or use <strong>Save As â†’ Export PDF</strong> in the header<br>4. For print: use Save As â†’ Print<br><br>ðŸ’¡ Always save as PDF (not Word) for job applications â€” it preserves formatting perfectly!'},
  'internship':{title:'ðŸš€ Finding Internships',body:'Top platforms to find internships:<br><br>ðŸŽ“ <strong>Internshala</strong> â€” India\'s #1 for students<br>ðŸ’¼ <strong>LinkedIn Jobs</strong> â€” Set alerts for internships<br>ðŸ¦„ <strong>Wellfound/AngelList</strong> â€” Startup internships<br>ðŸ“Œ <strong>Indeed</strong> â€” All types, global<br>ðŸ¢ <strong>Company Career Pages</strong> â€” Apply directly<br><br>ðŸ’¡ Cold email strategy: Research companies you love, find hiring managers on LinkedIn, and send a brief, personalized message!'},
  'upgrade':{title:'ðŸ‘‘ Elyssor Plans',body:'<strong>Free:</strong> 5 templates, 5 grammar fixes, basic ATS, Chinko bot<br><br><strong>Pro ($9/month):</strong><br>â€¢ 40+ professional templates<br>â€¢ Unlimited grammar checking<br>â€¢ AI summary generator<br>â€¢ File upload analysis<br>â€¢ 55 fonts + custom palettes<br><br><strong>Premium ($19/month):</strong><br>â€¢ All 70+ templates<br>â€¢ Recruiter portal access<br>â€¢ Full visualization suite<br>â€¢ LinkedIn optimization<br>â€¢ Cover letter builder<br><br>ðŸ’¡ Click "Upgrade" in the header to choose your plan!'},
};
function addBot(html){
  const msgs=$('ch-msgs');if(!msgs)return;
  const el=document.createElement('div');el.className='mb';el.innerHTML=html;msgs.appendChild(el);msgs.scrollTop=msgs.scrollHeight;
}
function addUser(txt){
  const msgs=$('ch-msgs');if(!msgs)return;
  const el=document.createElement('div');el.className='mu';el.textContent=txt;msgs.appendChild(el);msgs.scrollTop=msgs.scrollHeight;
}
function setQR(qs){
  const qr=$('ch-qr');if(!qr)return;
  qr.innerHTML=qs.map(q=>'<button class="qrb" onclick="sendQ(\''+q.replace(/'/g,"&#39;")+'\')">' +q+'</button>').join('');
}
function sendQ(q){addUser(q);$('ch-qr').innerHTML='';respondChinko(q);}
function toggleChinko(){const p=$('chinkoPanel');p?.classList.toggle('on');}
function sendChinko(){const inp=$('ch-inp');if(!inp||!inp.value.trim())return;const msg=inp.value.trim();inp.value='';addUser(msg);respondChinko(msg);}
function respondChinko(msg){
  const lc=msg.toLowerCase();
  const msgs=$('ch-msgs');if(!msgs)return;
  const typing=document.createElement('div');typing.className='mb';
  typing.innerHTML='<span class="tdot"></span><span class="tdot"></span><span class="tdot"></span>';
  msgs.appendChild(typing);msgs.scrollTop=msgs.scrollHeight;
  setTimeout(()=>{
    typing.remove();
    let resp=null;
    for(const[key,val]of Object.entries(CHINKO_KB)){if(lc.includes(key)){resp=val;break;}}
    if(lc.includes('improve')||lc.includes('better')){addBot('ðŸ’¡ <strong>Top ways to improve your Elyssor resume:</strong><br><br>1. Fill all sections completely (Personal, Summary, Skills, Experience/Internship)<br>2. Add 15+ skills â€” including technical, professional, and tools<br>3. Write a tailored summary using the AI Generator<br>4. Add quantified achievements: "Increased X by Y%"<br>5. Include certifications (free ones count!)<br>6. Add 2-3 projects with descriptions<br>7. Check ATS score in the Analysis tab<br><br>ðŸ’¡ Your current ATS score is <strong>'+calcATS().score+'/100</strong>. Click Analysis tab for details!');setQR(['Help me write a summary','Which skills am I missing?','How to get ATS 80+?']);}
    else if(lc.includes('hello')||lc.includes('hi')||lc.includes('hey')){addBot('ðŸ‘‹ Hello! I\'m <strong>Chinko</strong>, your AI resume guide. I can help you with ATS optimization, templates, writing tips, internships, and career advice.<br><br>What would you like to work on today?');setQR(['Improve my ATS score','Help with summary','Template recommendations']);}
    else if(resp)addBot('<strong>'+resp.title+'</strong><br><br>'+resp.body);
    else addBot('ðŸ¤– Great question! Here\'s my advice:<br><br>Your resume currently has <strong>'+allSk().length+' skills</strong> and an <strong>ATS score of '+calcATS().score+'/100</strong>.<br><br>'+( A.userType==='student'?'As a student, focus on adding internships, projects, and certifications to stand out. Use the AI summary generator for a professional summary!':'As a professional, focus on quantifying achievements and showcasing leadership impact. Tailor your summary for each application!')+'<br><br>Visit the <strong>Analysis</strong> tab for detailed AI suggestions!');
  },800+Math.random()*400);
}


// â”€â”€ CUSTOMIZATION TAB â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function syncCustFieldsFromMain(){
  sv('ce-name',A.personal.name);sv('ce-title',A.personal.title);
  sv('ce-email',A.personal.email);sv('ce-phone',A.personal.phone);
  sv('ce-loc',A.personal.location);sv('ce-li',A.personal.linkedin);
  sv('ce-summary',A.summary);
  sv('cust-cc-hdr',A.acH);sv('cust-cc-acc',A.acA);sv('cust-cc-bg',A.acBG);
  const cfs=$('cust-fs-val');if(cfs)cfs.textContent=A.fs+'px';
  const cfs2=$('cust-font-sel');if(cfs2)cfs2.value=A.font;
  // build template grid on first open
  if(!window._custTmplBuilt){buildCustTmplGrid();window._custTmplBuilt=true;}
  else highlightCustTmpl();
}
function syncCustField(mId,cId){const e=$(mId);if(e)e.value=v(cId);liveUp();}
function syncCustFieldTA(mId,cId){const e=$(mId);if(e)e.value=$('ce-summary')?.value||'';liveUp();}
function syncAllCustFields(){
  // push all cust fields to main form
  const map=[['p-name','ce-name'],['p-title','ce-title'],['p-email','ce-email'],['p-phone','ce-phone'],['p-loc','ce-loc'],['p-li','ce-li'],['p-summary','ce-summary']];
  map.forEach(([main,ce])=>{const v2=v(ce);if(v2!==undefined&&v2!==null&&v2!=='')sv(main,v2);});
  liveUp();renderResume();showToast('Preview refreshed âœ“');
}
function syncLive(mainId,ceId,field){
  // immediately sync to main field + update preview
  const val=v(ceId);
  sv(mainId,val);
  if(field&&A.personal)A.personal[field]=val;
  renderResume();
}
function syncLiveTA(mainId,ceId){
  const val=v(ceId);
  sv(mainId,val);
  A.summary=val;
  renderResume();
}
function custAddSkills(){
  const inp=$('ce-skills-inp');if(!inp)return;
  const raw=inp.value;if(!raw.trim())return;
  raw.split(',').forEach(s=>{const t=s.trim();if(t&&!A.skills.tech.find(x=>x.n===t))A.skills.tech.push({n:t,l:80});});
  inp.value='';renderSkChips();renderResume();updATS();showToast('Skills added to resume âœ“');
}
function buildCustTmplGrid(){
  const grid=$('cust-tmpl-grid');if(!grid||!window.TMPLS)return;
  // show first 12 templates
  const shown=TMPLS.slice(0,12);
  grid.innerHTML=shown.map(t=>`<div onclick="custPickTmpl('${t.id}')" class="cust-tmpl-thumb" id="ctt-${t.id}" style="border:2px solid var(--sand);border-radius:8px;padding:8px 6px;cursor:pointer;transition:.2s;text-align:center;background:var(--white)">
    <div style="font-size:9px;font-weight:800;text-transform:uppercase;color:var(--dark);letter-spacing:.3px">${t.name||t.id}</div>
    <div style="font-size:8px;color:var(--brown);margin-top:2px">${t.category||'Classic'}</div>
    <div style="font-size:8px;margin-top:3px">${t.tier==='free'?'<span style="color:var(--sage)">Free</span>':t.tier==='pro'?'<span style="color:var(--amber)">Pro</span>':'<span style="color:var(--caramel)">Premium</span>'}</div>
  </div>`).join('');
  // mark current
  highlightCustTmpl();
}
function custPickTmpl(id){
  A.tmpl=id;sv('tmpl-sel',id);renderResume();highlightCustTmpl();showToast('Template changed â€” preview updated âœ“');
}
function highlightCustTmpl(){
  document.querySelectorAll('.cust-tmpl-thumb').forEach(el=>{
    const id=el.id.replace('ctt-','');
    el.style.borderColor=id===A.tmpl?'var(--caramel)':'var(--sand)';
    el.style.background=id===A.tmpl?'rgba(196,149,106,.1)':'var(--white)';
  });
}
function custApplyC(){
  A.acH=$('cust-cc-hdr')?.value||A.acH;A.acA=$('cust-cc-acc')?.value||A.acA;A.acBG=$('cust-cc-bg')?.value||A.acBG;
  sv('cc-hdr',A.acH);sv('cc-acc',A.acA);sv('cc-bg',A.acBG);
  renderResume();showToast('Colors applied âœ“');
}
function custApplyFont(){const s=$('cust-font-sel');if(s){A.font=s.value;renderResume();showToast('Font applied âœ“');}}
function handleCustResumeUp(e){const f=e.target.files[0];if(f)processCustResume(f);}
function handleCustDrop(e){e.preventDefault();document.getElementById('upr-zone-cust')?.classList.remove('dragover');const f=e.dataTransfer.files[0];if(f)processCustResume(f);}

// â•â•â• PDF TEXT EXTRACTION via pdf.js â•â•â•
async function extractTextFromPDF(file){
  if(!window.pdfjsLib){showToast('PDF library not loaded â€” try TXT format');return '';}
  const arrayBuffer=await file.arrayBuffer();
  const pdf=await pdfjsLib.getDocument({data:arrayBuffer}).promise;
  let fullText='';
  for(let i=1;i<=pdf.numPages;i++){
    const page=await pdf.getPage(i);
    const content=await page.getTextContent();
    const pageText=content.items.map(item=>item.str).join(' ');
    fullText+=pageText+'\n';
  }
  return fullText;
}

// â•â•â• IMPROVED RESUME PARSER â•â•â•
function parseResumeText(text){
    const lines=text.split('\n').map(l=>l.trim()).filter(l=>l.length>1);
  const parsed={name:'',email:'',phone:'',linkedin:'',github:'',website:'',location:'',title:'',summary:'',skills:[],expEntries:[],eduEntries:[],rawExp:[],rawEdu:[]};

    // Email
    const em=text.match(/([\w.+-]+@[\w-]+\.[\w.]+)/);if(em)parsed.email=em[1];
  // Phone â€” support international formats
  const ph=text.match(/(?:phone|mobile|cell|tel|contact)?[:\s]*([+]?[\d][\d\s()\-.]{7,16}\d)/i);if(ph)parsed.phone=ph[1].trim();
    // LinkedIn
  const li=text.match(/(?:https?:\/\/)?(?:www\.)?linkedin\.com\/in\/([\w-]+)/i);if(li)parsed.linkedin='linkedin.com/in/'+li[1];
    // GitHub
  const gh=text.match(/(?:https?:\/\/)?(?:www\.)?github\.com\/([\w-]+)/i);if(gh)parsed.github='github.com/'+gh[1];
  // Website
  const web=text.match(/(?:website|portfolio|site)[:\s]*(https?:\/\/[\w.-]+\.\w+[\w/.-]*)/i);if(web)parsed.website=web[1];

  // Name: first non-email, non-phone, non-URL substantial line
  for(const ln of lines){
    if(ln.length>2&&ln.length<55&&!/[@\d+().]/.test(ln)&&!/http/i.test(ln)&&!/resume|curriculum|cv|page|objective/i.test(ln)&&!/^\d/.test(ln)){
      parsed.name=ln.replace(/[^a-zA-Z\s.''-]/g,'').trim();break;
    }
  }

  // Title: look for common job title patterns or the line after name
  const titlePatterns=/(?:software|senior|junior|lead|full[\s-]?stack|front[\s-]?end|back[\s-]?end|data|product|project|ui[\s\/]?ux|web|mobile|devops|cloud|machine learning|ml|ai|marketing|sales|business|operations|human|hr|finance|graphic|visual|content|digital|seo|engineer|developer|designer|manager|analyst|scientist|architect|consultant|specialist|coordinator|associate|director|intern|fresher|graduate)/i;
  let nameFound=false;
  for(const ln of lines){
    if(ln===parsed.name||ln.includes(parsed.name)){nameFound=true;continue;}
    if(nameFound&&ln.length>3&&ln.length<80&&titlePatterns.test(ln)&&!/[@]/.test(ln)){parsed.title=ln;break;}
    if(nameFound&&!parsed.title&&ln.length>3&&ln.length<80&&!/[@\d]/.test(ln)&&!/http/i.test(ln)&&!/phone|email|address|linkedin|github/i.test(ln)){parsed.title=ln;break;}
  }

  // Location â€” multiple patterns
  const locPatterns=[
    /(?:location|address|city)[:\s]*([A-Za-z][A-Za-z\s,]+(?:,\s*[A-Za-z]{2,}))/i,
    /([A-Z][a-zA-Z\s]+,\s*[A-Z]{2}(?:\s+\d{5})?)/,
    /([A-Z][a-zA-Z]+,\s*[A-Z][a-zA-Z]+(?:\s*,\s*[A-Z][a-zA-Z]+)?)/
  ];
  for(const pat of locPatterns){const m=text.match(pat);if(m){parsed.location=m[1].trim();break;}}

  // Summary: longest paragraph between 60-600 chars that's not a heading
  const paras=text.split(/\n{2,}/).map(p=>p.replace(/\n/g,' ').trim());
  let bestSummary='';
  for(const p of paras){
    if(p.length>50&&p.length<600&&!p.includes('@')&&!/^[â€¢\-*]/.test(p)&&!/^(experience|education|skills|certification|project)/i.test(p)){
      if(p.length>bestSummary.length)bestSummary=p;
    }
  }
  parsed.summary=bestSummary;

  // Skills: detect from multiple patterns
  const skillSectionRegex=/(?:skills?|technologies|technical\s+skills?|tools|expertise|competenc|proficienc)[:\s|â€“-]*\n?([\s\S]{10,600}?)(?=\n{2}|experience|education|certification|project|work\s+history|employment|$)/gi;
  let skMatch;
  while((skMatch=skillSectionRegex.exec(text))!==null){
    const block=skMatch[1];
    block.split(/[,|â€¢Â·\n;]+/).forEach(s=>{
      const t=s.replace(/[:\-â€“]/g,'').trim();
      if(t.length>1&&t.length<35&&!/^\d+$/.test(t)&&!/skills?|technologies|tools/i.test(t)){
        if(!parsed.skills.includes(t))parsed.skills.push(t);
      }
    });
  }

  // Experience: try to extract structured entries
  const expSectionRegex=/(?:(?:work\s+)?experience|employment(?:\s+history)?|professional\s+experience|career\s+history)\s*\n([\s\S]{20,2000}?)(?=\n\s*(?:education|skills?|certification|project|award|language|interest|hobbies|reference|volunteer)\b|$)/gi;
  const expMatch=expSectionRegex.exec(text);
  if(expMatch){
    const block=expMatch[1];
    // Try to find date-separated entries
    const entryPattern=/(.+?)[\s|â€“-]+(\d{4}[\s\-â€“/]*(present|\d{4}|current))/gi;
    let entry;
    const rawLines=block.split('\n').filter(l=>l.trim().length>3);

    // Try structured parsing: look for role + company + dates pattern
    let currentEntry=null;
    for(const line of rawLines){
      const dateMatch=line.match(/(\w+[\s\/]+\d{4})\s*[-â€“]\s*(present|\w+[\s\/]+\d{4}|current)/i);
      if(dateMatch||/^\s*[A-Z]/.test(line)&&line.length<80&&(line.includes(' at ')||line.includes(' - ')||line.includes('|'))){
        if(currentEntry&&(currentEntry.role||currentEntry.company)){
          parsed.expEntries.push(currentEntry);
        }
        currentEntry={role:'',company:'',start:'',end:'',loc:'',desc:''};
        if(dateMatch){
          currentEntry.start=dateMatch[1];
          currentEntry.end=dateMatch[2];
          const beforeDates=line.replace(dateMatch[0],'').trim().replace(/[|â€“-]+$/,'').trim();
          if(beforeDates.includes(' at ')){
            const parts=beforeDates.split(' at ');
            currentEntry.role=parts[0].trim();
            currentEntry.company=parts.slice(1).join(' at ').trim();
          } else if(beforeDates.includes(' | ')){
            const parts=beforeDates.split(' | ');
            currentEntry.role=parts[0].trim();
            currentEntry.company=parts.slice(1).join(' | ').trim();
          } else {
            currentEntry.role=beforeDates;
          }
        } else {
          currentEntry.role=line.trim();
        }
      } else if(currentEntry){
        if(!currentEntry.company&&line.length<80&&!/^[â€¢\-*]/.test(line)){
          currentEntry.company=line.trim();
        } else {
          currentEntry.desc+=(currentEntry.desc?'\n':'')+line.trim();
        }
      }
    }
    if(currentEntry&&(currentEntry.role||currentEntry.company)){
      parsed.expEntries.push(currentEntry);
    }
    // Fallback: raw lines
    rawLines.slice(0,6).forEach(l=>parsed.rawExp.push(l.trim()));
  }

  // Education: extract structured entries
  const eduSectionRegex=/(?:education|academic|qualifications?)\s*\n([\s\S]{10,1000}?)(?=\n\s*(?:experience|skills?|certification|project|work|employment|award|language|interest|hobbies|reference)\b|$)/gi;
  const eduMatch=eduSectionRegex.exec(text);
  if(eduMatch){
    const block=eduMatch[1];
    const rawLines=block.split('\n').filter(l=>l.trim().length>3);
    let currentEdu=null;
    for(const line of rawLines){
      const degreeMatch=line.match(/(bachelor|master|b\.?[stae]|m\.?[stae]|ph\.?d|mba|diploma|associate|b\.?tech|m\.?tech|b\.?e|m\.?e|b\.?sc|m\.?sc|b\.?com|m\.?com|b\.?a|m\.?a)/i);
      const yearMatch=line.match(/(\d{4})\s*[-â€“]\s*(\d{4}|present|current)/i);
      if(degreeMatch||yearMatch||(line.length<100&&/university|college|institute|school/i.test(line))){
        if(currentEdu&&(currentEdu.inst||currentEdu.deg))parsed.eduEntries.push(currentEdu);
        currentEdu={inst:'',deg:'',field:'',sy:'',ey:'',gpa:'',loc:'',acts:''};
        if(/university|college|institute|school/i.test(line)){
          currentEdu.inst=line.replace(/\d{4}[\s\-â€“]*\d{0,4}/g,'').trim();
        }
        if(degreeMatch){
          currentEdu.deg=line.replace(/\d{4}[\s\-â€“]*\d{0,4}/g,'').trim();
          if(!currentEdu.inst)currentEdu.inst=line.replace(degreeMatch[0],'').replace(/\d{4}[\s\-â€“]*\d{0,4}/g,'').replace(/[-â€“|,]+/g,' ').trim();
        }
        if(yearMatch){currentEdu.sy=yearMatch[1];currentEdu.ey=yearMatch[2];}
      } else if(currentEdu){
        if(!currentEdu.inst&&/university|college|institute|school/i.test(line))currentEdu.inst=line.trim();
        else if(!currentEdu.field&&line.length<80)currentEdu.field=line.trim();
        const gpaM=line.match(/(?:gpa|cgpa|grade|percentage)[:\s]*([\d.]+(?:\s*\/\s*[\d.]+)?%?)/i);
        if(gpaM)currentEdu.gpa=gpaM[1];
      }
    }
    if(currentEdu&&(currentEdu.inst||currentEdu.deg))parsed.eduEntries.push(currentEdu);
    rawLines.slice(0,4).forEach(l=>parsed.rawEdu.push(l.trim()));
  }

  return parsed;
}

// â•â•â• MAIN RESUME PROCESSING â•â•â•
async function processCustResume(file){
  const res=$('cust-import-result');
  if(res)res.innerHTML='<div class="import-result-card" style="text-align:center;padding:20px"><div style="font-size:22px;margin-bottom:6px">â³</div><div style="font-size:12px;color:var(--caramel)">Parsing your resume...</div></div>';

  let text='';
  const ext=file.name.split('.').pop().toLowerCase();

  try{
    if(ext==='pdf'){
      // Use PDF.js for proper PDF extraction
      if(!window.pdfjsLib){
        if(res)res.innerHTML='<div class="import-result-card" style="text-align:center;padding:20px"><div style="font-size:22px;margin-bottom:6px">âš ï¸</div><div style="font-size:13px;font-weight:700;color:var(--dark)">PDF library is loading...</div><div style="font-size:11px;color:var(--brown);margin-top:4px">Please wait a moment and try again.</div></div>';
        return;
      }
      text=await extractTextFromPDF(file);
      if(!text||text.trim().length<20){
        if(res)res.innerHTML='<div class="import-result-card" style="text-align:center;padding:20px"><div style="font-size:22px;margin-bottom:6px">âš ï¸</div><div style="font-size:13px;font-weight:700;color:var(--dark)">Could not extract text from PDF</div><div style="font-size:11px;color:var(--brown);margin-top:4px">This PDF may be scanned/image-based. Please try a TXT or DOC file, or copy-paste your resume text directly into the fields below.</div></div>';
        return;
      }
    } else {
      // TXT / DOC â€” read as text
      text=await new Promise((resolve,reject)=>{
        const r=new FileReader();
        r.onload=ev=>resolve(ev.target.result);
        r.onerror=()=>reject(new Error('File read error'));
        r.readAsText(file);
      });
    }
  }catch(err){
    if(res)res.innerHTML='<div class="import-result-card" style="text-align:center;padding:20px"><div style="font-size:22px;margin-bottom:6px">âŒ</div><div style="font-size:13px;font-weight:700;color:var(--dark)">Could not read file</div><div style="font-size:11px;color:var(--brown);margin-top:4px">'+err.message+'. Try a TXT file or paste content directly.</div></div>';
    return;
  }

  // Parse the extracted text
  const parsed=parseResumeText(text);

  // --- AUTO-FILL MAIN FORM FIELDS ---
    if(parsed.name){sv('p-name',parsed.name);sv('ce-name',parsed.name);}
    if(parsed.email){sv('p-email',parsed.email);sv('ce-email',parsed.email);}
    if(parsed.phone){sv('p-phone',parsed.phone);sv('ce-phone',parsed.phone);}
    if(parsed.linkedin){sv('p-li',parsed.linkedin);sv('ce-li',parsed.linkedin);}
    if(parsed.github)sv('p-gh',parsed.github);
  if(parsed.website)sv('p-web',parsed.website);
    if(parsed.location){sv('p-loc',parsed.location);sv('ce-loc',parsed.location);}
    if(parsed.title){sv('p-title',parsed.title);sv('ce-title',parsed.title);}
    if(parsed.summary){sv('p-summary',parsed.summary);sv('ce-summary',parsed.summary);}

  // Add skills to the skills array
  if(parsed.skills.length>0){
    parsed.skills.slice(0,20).forEach(s=>{
      if(s&&!A.skills.tech.find(x=>x.n.toLowerCase()===s.toLowerCase()))
        A.skills.tech.push({n:s,l:80});
    });
  }

  // Add experience entries to A.exp
  if(parsed.expEntries.length>0){
    parsed.expEntries.forEach(entry=>{
      if(entry.role||entry.company){
        A.exp.push({
          role:entry.role||'',
          company:entry.company||'',
          start:entry.start||'',
          end:entry.end||'Present',
          loc:entry.loc||'',
          desc:entry.desc||'',
          type:'Full-time'
        });
      }
    });
  }

  // Add education entries to A.edu
  if(parsed.eduEntries.length>0){
    parsed.eduEntries.forEach(entry=>{
      if(entry.inst||entry.deg){
        A.edu.push({
          inst:entry.inst||'',
          deg:entry.deg||'',
          field:entry.field||'',
          sy:entry.sy||'',
          ey:entry.ey||'',
          gpa:entry.gpa||'',
          loc:entry.loc||'',
          acts:entry.acts||''
        });
      }
    });
  }

  // Update everything
  liveUp();renderSkChips();renderAllLists();updATS();updComp();renderResume();

  // Run grammar check on all imported text
  autoFixGrammar();

  // --- RENDER PARSED RESULT CARD ---
    const fieldRows=[
      {l:'Name',v:parsed.name,ok:!!parsed.name},
      {l:'Email',v:parsed.email,ok:!!parsed.email},
      {l:'Phone',v:parsed.phone,ok:!!parsed.phone},
      {l:'Title',v:parsed.title,ok:!!parsed.title},
      {l:'Location',v:parsed.location,ok:!!parsed.location},
      {l:'LinkedIn',v:parsed.linkedin,ok:!!parsed.linkedin},
      {l:'GitHub',v:parsed.github,ok:!!parsed.github},
    ].filter(f=>f.v);
  const skillsFound=parsed.skills.slice(0,12);
  const expFound=parsed.expEntries.length?parsed.expEntries:parsed.rawExp.slice(0,3).map(e=>({role:e}));
  const eduFound=parsed.eduEntries.length?parsed.eduEntries:parsed.rawEdu.slice(0,3).map(e=>({inst:e}));

    let html='<div class="import-result-card">';
  html+='<div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:10px"><div style="font-family:\'Cormorant Garamond\',serif;font-size:16px;font-weight:700;color:var(--dark)">âœ… Resume Parsed Successfully</div>';
  const totalFound=fieldRows.length+(skillsFound.length?1:0)+(parsed.expEntries.length?1:0)+(parsed.eduEntries.length?1:0);
  html+='<span class="import-badge">'+fieldRows.length+' fields Â· '+skillsFound.length+' skills</span></div>';

    if(fieldRows.length){
      html+='<div style="margin-bottom:8px">';
      fieldRows.forEach(f=>{html+='<div class="import-field-row"><span class="import-field-lbl">'+f.l+'</span><span class="import-field-val">'+f.v+'</span></div>';});
      html+='</div>';
    }
    if(skillsFound.length){
    html+='<div class="parse-section"><div class="parse-sec-title">ðŸ›  Skills ('+skillsFound.length+')</div>';
      html+='<div style="display:flex;flex-wrap:wrap;gap:4px">';
      skillsFound.forEach(s=>{html+='<span class="import-badge">'+s+'</span>';});
      html+='</div></div>';
    }
  if(parsed.expEntries.length){
    html+='<div class="parse-section"><div class="parse-sec-title">ðŸ’¼ Experience ('+parsed.expEntries.length+' entries added)</div>';
    parsed.expEntries.slice(0,3).forEach(e=>{html+='<div class="parse-item"><strong>'+e.role+'</strong>'+(e.company?' at '+e.company:'')+(e.start?' Â· '+e.start+(e.end?' â€“ '+e.end:''):'')+'</div>';});
    html+='</div>';
  } else if(parsed.rawExp.length){
      html+='<div class="parse-section"><div class="parse-sec-title">ðŸ’¼ Experience Snippets</div>';
    parsed.rawExp.slice(0,3).forEach(e=>{html+='<div class="parse-item">'+e+'</div>';});
      html+='</div>';
    }
  if(parsed.eduEntries.length){
    html+='<div class="parse-section"><div class="parse-sec-title">ðŸŽ“ Education ('+parsed.eduEntries.length+' entries added)</div>';
    parsed.eduEntries.slice(0,3).forEach(e=>{html+='<div class="parse-item"><strong>'+(e.deg||e.inst)+'</strong>'+(e.inst&&e.deg?' â€” '+e.inst:'')+(e.sy?' Â· '+e.sy+(e.ey?'â€“'+e.ey:''):'')+'</div>';});
    html+='</div>';
  } else if(parsed.rawEdu.length){
      html+='<div class="parse-section"><div class="parse-sec-title">ðŸŽ“ Education Snippets</div>';
    parsed.rawEdu.slice(0,3).forEach(e=>{html+='<div class="parse-item">'+e+'</div>';});
      html+='</div>';
    }

    if(fieldRows.length===0&&skillsFound.length===0){
    html+='<div class="import-badge warn" style="margin-top:6px;display:block">âš ï¸ Limited data extracted â€” try a TXT file for best results, or paste text directly into fields below</div>';
    }

    html+='<div class="import-actions">';
  html+='<button class="import-btn apply" onclick="scrollToEditFields()"><i class="fas fa-pen"></i> Edit Fields</button>';
  html+='<button class="import-btn apply" onclick="syncAllCustFields();showToast(\'Preview updated! âœ“\')"><i class="fas fa-eye"></i> Refresh Preview</button>';
    html+='<button class="import-btn clr" onclick="clearImportResult()"><i class="fas fa-times"></i> Clear</button>';
    html+='</div>';
  html+='<div style="margin-top:8px;font-size:10px;color:rgba(253,246,236,.6);text-align:center"><i class="fas fa-info-circle" style="color:var(--caramel)"></i> All fields are editable below â€” scroll down to refine. Grammar auto-corrected âœ“</div>';
    html+='</div>';
    if(res)res.innerHTML=html;

  showToast('Resume parsed! '+fieldRows.length+' fields + '+skillsFound.length+' skills extracted âœ“');
}

function scrollToEditFields(){
  const sec=$('cust-edit-sec');if(sec)sec.scrollIntoView({behavior:'smooth',block:'start'});
}

function clearImportResult(){const r=$('cust-import-result');if(r)r.innerHTML='';const f=$('cust-resume-file');if(f)f.value='';}

const PLACEHOLDERS={
  software:{name:'Alex Johnson',title:'Full Stack Software Engineer',email:'alex@email.com',phone:'+1 555 0142',location:'San Francisco, CA',linkedin:'linkedin.com/in/alexjohnson',github:'github.com/alexj',targetRole:'Senior Software Engineer',summary:'Results-driven Full Stack Engineer with 4 years building scalable web applications. Delivered 40% performance improvements and led teams of 5+ engineers at tech startups.',skills:{tech:[{n:'JavaScript',l:90},{n:'TypeScript',l:85},{n:'Python',l:80},{n:'SQL',l:75}],prof:[{n:'Leadership',l:80},{n:'Problem Solving',l:90},{n:'Code Review',l:85}],tools:[{n:'Git',l:95},{n:'Docker',l:75},{n:'VS Code',l:90}],fw:[{n:'React',l:88},{n:'Node.js',l:82},{n:'Next.js',l:78}]},exp:[{role:'Senior Frontend Developer',company:'TechCorp Inc.',loc:'San Francisco',start:'2022-01',end:'Present',desc:'â€¢ Led React migration reducing load time by 45%\nâ€¢ Mentored 3 junior engineers\nâ€¢ Delivered 12 features serving 500K daily users',type:'Full-time'},{role:'Web Developer',company:'Startup XYZ',loc:'Remote',start:'2020-06',end:'2021-12',desc:'â€¢ Built REST APIs using Node.js and Express\nâ€¢ Implemented CI/CD pipeline cutting deploy time by 60%',type:'Full-time'}],edu:[{inst:'UC Berkeley',deg:"Bachelor's",field:'Computer Science',sy:'2018',ey:'2022',gpa:'3.7',loc:'Berkeley, CA',acts:'ACM Club President, Hackathon Winner 2021'}],proj:[{name:'AI Resume Analyzer',tech:'React, Python, TensorFlow',dur:'2023',role:'Lead Developer',desc:'Built ML-powered resume analyzer used by 2,000+ job seekers.',git:'github.com/alexj/resume-ai',live:'resumeai.app'}]},
  designer:{name:'Maya Patel',title:'Senior UX/UI Designer',email:'maya@design.co',phone:'+1 555 0289',location:'New York, NY',targetRole:'Lead Product Designer',summary:'Creative UX/UI Designer with 5 years transforming complex problems into elegant user-centered solutions. Spearheaded redesigns that increased engagement by 60%.',skills:{tech:[{n:'Figma',l:95},{n:'Adobe XD',l:85},{n:'Sketch',l:80},{n:'Illustrator',l:78}],prof:[{n:'User Research',l:88},{n:'Prototyping',l:90},{n:'Design Thinking',l:92}],tools:[{n:'InVision',l:80},{n:'Miro',l:85},{n:'Zeplin',l:82}],fw:[]},exp:[{role:'Senior UX Designer',company:'Creative Studio',loc:'New York',start:'2021-03',end:'Present',desc:'â€¢ Redesigned onboarding flow, reducing drop-off by 35%\nâ€¢ Conducted 50+ user interviews\nâ€¢ Built design system used by 8 teams',type:'Full-time'}],edu:[{inst:'Parsons School of Design',deg:"Bachelor's",field:'Communication Design',sy:'2016',ey:'2020',gpa:'3.8',loc:'New York',acts:"Dean's List 2018-2020"}]},
  data:{name:'Priya Sharma',title:'Data Scientist',email:'priya@data.ai',phone:'+91 9876543210',location:'Bangalore, India',targetRole:'Senior Data Scientist',summary:'Data Scientist with 3 years building ML models driving business decisions. Reduced churn by 22% with predictive modeling. Expert in Python, TensorFlow, and cloud ML pipelines.',skills:{tech:[{n:'Python',l:92},{n:'R',l:75},{n:'SQL',l:88},{n:'Machine Learning',l:85},{n:'Deep Learning',l:78}],prof:[{n:'Statistical Analysis',l:88},{n:'Data Visualization',l:82}],tools:[{n:'Tableau',l:80},{n:'Jupyter',l:95},{n:'Apache Spark',l:72}],fw:[{n:'TensorFlow',l:80},{n:'Scikit-learn',l:85},{n:'Pandas',l:92}]},exp:[{role:'Data Scientist',company:'Analytics Corp',loc:'Bangalore',start:'2021-06',end:'Present',desc:'â€¢ Built churn prediction model (87% accuracy), saving $2M annually\nâ€¢ Automated reporting pipeline, reducing manual effort by 70%\nâ€¢ Collaborated with ML team of 12 to ship 3 major features',type:'Full-time'}],edu:[{inst:'IIT Bangalore',deg:"Master's",field:'Data Science',sy:'2019',ey:'2021',gpa:'8.9/10',loc:'Bangalore',acts:'Research publication in NLP'}]},
  manager:{name:'Robert Chen',title:'Senior Product Manager',email:'robert@corp.com',phone:'+1 555 0374',location:'Seattle, WA',targetRole:'Director of Product',summary:'Strategic Product Manager with 8 years leading cross-functional teams for products serving 2M+ users. Increased revenue by $12M through data-driven product decisions.',skills:{tech:[{n:'SQL',l:78},{n:'Analytics',l:85},{n:'Roadmapping',l:90}],prof:[{n:'Strategic Planning',l:92},{n:'Stakeholder Management',l:90},{n:'Agile/Scrum',l:88},{n:'OKRs',l:85}],tools:[{n:'JIRA',l:90},{n:'Confluence',l:85},{n:'Amplitude',l:80}],fw:[]},exp:[{role:'Senior Product Manager',company:'Big Tech Co.',loc:'Seattle',start:'2019-01',end:'Present',desc:'â€¢ Led 12-person team to ship payment feature adding $8M ARR\nâ€¢ Reduced time-to-market by 40% via Agile transformation\nâ€¢ Managed $2M product budget across 3 squads',type:'Full-time'},{role:'Product Manager',company:'SaaS Startup',loc:'Seattle',start:'2016-03',end:'2018-12',desc:'â€¢ Launched 4 core features from 0 to 50K monthly active users',type:'Full-time'}],edu:[{inst:'Stanford University',deg:'MBA',field:'Business Administration',sy:'2014',ey:'2016',gpa:'',loc:'Stanford, CA',acts:''}]},
  fresher:{name:'Arun Kumar',title:'Computer Science Graduate',email:'arun@gmail.com',phone:'+91 9123456789',location:'Chennai, India',targetRole:'Software Engineer (Entry Level)',summary:'Enthusiastic CS graduate with strong DSA fundamentals and hands-on project experience in web development. Completed 2 internships and built 3 full-stack projects using React and Node.js.',skills:{tech:[{n:'Java',l:78},{n:'Python',l:72},{n:'JavaScript',l:68},{n:'C++',l:65},{n:'SQL',l:70}],prof:[{n:'Problem Solving',l:85},{n:'Teamwork',l:80},{n:'Communication',l:75}],tools:[{n:'Git',l:75},{n:'VS Code',l:90},{n:'Postman',l:65}],fw:[{n:'React (Basic)',l:60},{n:'Spring Boot',l:65},{n:'Express.js',l:62}]},intern:[{company:'Startup XYZ',role:'Web Developer Intern',start:'2023-06',end:'2023-08',desc:'Built REST APIs using Spring Boot. Developed responsive UI with React. Worked in Agile team of 8.',type:'Paid Internship'},{company:'Digital Agency',role:'Frontend Intern',start:'2022-12',end:'2023-02',desc:'Created landing pages and email templates. Improved page speed by 20%.',type:'Unpaid Internship'}],edu:[{inst:'Anna University',deg:"Bachelor's",field:'Computer Science Engineering',sy:'2020',ey:'2024',gpa:'8.2/10',loc:'Chennai',acts:'Technical Club Secretary, Hackathon Winner 2023, CodeChef Rating 1600+'}],proj:[{name:'E-Commerce Platform',tech:'React, Node.js, MongoDB',dur:'Jan-Mar 2024',role:'Lead Developer',desc:'Built full-stack e-commerce app with payment integration, cart management, and admin panel.',git:'github.com/arun/ecommerce',live:''}]},
  marketing:{name:'Sara Williams',title:'Digital Marketing Manager',email:'sara@marketing.io',phone:'+1 555 0198',location:'Austin, TX',targetRole:'Head of Marketing',summary:'Data-driven Marketing Manager with 5 years scaling brands through SEO, content strategy, and paid campaigns. Grew organic traffic 180% and generated $3.5M in qualified pipeline.',skills:{tech:[{n:'SEO/SEM',l:90},{n:'Google Analytics',l:88},{n:'PPC',l:82},{n:'Email Marketing',l:85}],prof:[{n:'Content Strategy',l:88},{n:'Copywriting',l:85},{n:'A/B Testing',l:80}],tools:[{n:'HubSpot',l:90},{n:'SEMrush',l:85},{n:'Mailchimp',l:80}],fw:[]},exp:[{role:'Marketing Manager',company:'Growth Agency',loc:'Austin TX',start:'2020-04',end:'Present',desc:'â€¢ Scaled organic traffic from 20K to 56K monthly visitors\nâ€¢ Led $500K paid media budget achieving 3.5x ROAS\nâ€¢ Built content calendar generating 200+ leads/month',type:'Full-time'}],edu:[{inst:'UT Austin',deg:"Bachelor's",field:'Marketing & Communications',sy:'2015',ey:'2019',gpa:'3.6',loc:'Austin, TX',acts:''}]}
};
function loadPlaceholder(type){
  const ph=PLACEHOLDERS[type];if(!ph){showToast('Profile not found');return;}
  sv('p-name',ph.name);sv('p-title',ph.title);sv('p-email',ph.email);sv('p-phone',ph.phone);sv('p-loc',ph.location);
  if(ph.linkedin)sv('p-li',ph.linkedin);if(ph.github)sv('p-gh',ph.github);if(ph.targetRole)sv('p-target',ph.targetRole);
  sv('p-summary',ph.summary);
  if(ph.skills)A.skills=JSON.parse(JSON.stringify(ph.skills));
  if(ph.exp)A.exp=JSON.parse(JSON.stringify(ph.exp));else A.exp=[];
  if(ph.edu)A.edu=JSON.parse(JSON.stringify(ph.edu));else A.edu=[];
  if(ph.intern)A.intern=JSON.parse(JSON.stringify(ph.intern));else A.intern=[];
  if(ph.proj)A.proj=JSON.parse(JSON.stringify(ph.proj));else A.proj=[];
  if(ph.certs)A.certs=JSON.parse(JSON.stringify(ph.certs));else A.certs=[];
  liveUp();renderAllLists();renderSkChips();updSug();updATS();updComp();syncCustFieldsFromMain();
  showToast('Loaded: '+type+' profile âœ“');
}

// â”€â”€ PHOTO UPLOAD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function handlePhoto(e){
  const file=e.target.files[0];if(!file)return;
  if(file.size>3*1024*1024){showToast('Photo must be under 3MB');return;}
  const reader=new FileReader();
  reader.onload=ev=>{
    A.photoData=ev.target.result;
    const ring=$('photoRing');
    if(ring){ring.innerHTML=`<img src="${ev.target.result}" style="width:64px;height:64px;object-fit:cover;display:block;border-radius:50%">`;}
    const rmBtn=$('photoRmBtn');if(rmBtn)rmBtn.style.display='inline-block';
    const sph=$('show-photo');if(sph){sph.checked=true;}
    liveUp();showToast('Photo uploaded! âœ“');
  };
  reader.readAsDataURL(file);
}
function removePhoto(){
  A.photoData=null;
  const ring=$('photoRing');if(ring){ring.innerHTML='<span id="photoEmoji">ðŸ‘¤</span>';}
  const rmBtn=$('photoRmBtn');if(rmBtn)rmBtn.style.display='none';
  const pf=$('photoFile');if(pf)pf.value='';
  liveUp();showToast('Photo removed');
}

// â”€â”€ SPLIT SCREEN RESIZE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let _curLayout=50;
function setLayout(pct){
  _curLayout=pct;
  const total=document.getElementById('appBody')?.offsetWidth||window.innerWidth;
  if(pct===0){
    document.documentElement.style.setProperty('--sb-w','0px');
    document.getElementById('mainSidebar')?.style.setProperty('overflow','hidden');
  } else if(pct===100){
    document.documentElement.style.setProperty('--sb-w','380px');
  } else {
    const sbw=Math.round(total*(pct/100));
    document.documentElement.style.setProperty('--sb-w',sbw+'px');
  }
  // update active button
  document.querySelectorAll('.rsz-btn').forEach(b=>b.classList.remove('active'));
  const idMap={40:'rsz40',50:'rsz50',30:'rsz30',0:'rsz0',100:'rsz100'};
  const btn=$(idMap[pct]);if(btn)btn.classList.add('active');
}

function initDragResize(){
  const handle=$('dragHandle');
  const body=$('appBody');
  if(!handle||!body)return;
  let dragging=false, startX=0, startW=0;
  handle.addEventListener('mousedown',e=>{
    e.preventDefault();
    dragging=true;
    startX=e.clientX;
    startW=parseInt(getComputedStyle(document.documentElement).getPropertyValue('--sb-w'))||310;
    handle.classList.add('active');
    document.body.style.cursor='col-resize';
    document.body.style.userSelect='none';
  });
  document.addEventListener('mousemove',e=>{
    if(!dragging)return;
    const delta=e.clientX-startX;
    const newW=Math.max(200,Math.min(600,startW+delta));
    document.documentElement.style.setProperty('--sb-w',newW+'px');
  });
  document.addEventListener('mouseup',()=>{
    if(!dragging)return;
    dragging=false;
    handle.classList.remove('active');
    document.body.style.cursor='';
    document.body.style.userSelect='';
  });
  handle.addEventListener('touchstart',e=>{
    startX=e.touches[0].clientX;
    startW=parseInt(getComputedStyle(document.documentElement).getPropertyValue('--sb-w'))||310;
  },{passive:true});
  document.addEventListener('touchmove',e=>{
    if(!handle.classList.contains('active'))return;
    const delta=e.touches[0].clientX-startX;
    const newW=Math.max(200,Math.min(600,startW+delta));
    document.documentElement.style.setProperty('--sb-w',newW+'px');
  },{passive:true});
}

// â”€â”€ STORAGE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function autoSave(){
  silentAutoSave();
  // also save to multi-resume list
  const list=getResumeList();
  list[_activeResumeIdx].data=getState();
  saveResumeList(list);
  showToast('Progress saved âœ“');
}
function loadState(){
  const uid=A.user?.id||'guest';
  let saved=DB.getResume(uid);
  if(!saved){try{const raw=localStorage.getItem('elyssor_data');if(raw)saved=JSON.parse(raw);}catch(e){}}
  if(saved){try{
    Object.assign(A,{personal:saved.personal||{},summary:saved.summary||'',exp:saved.exp||[],edu:saved.edu||[],skills:saved.skills||{tech:[],prof:[],tools:[],fw:[]},certs:saved.certs||[],proj:saved.proj||[],intern:saved.intern||[],customText:saved.customText||'',photoData:saved.photoData||null});
    if(saved.tmpl)A.tmpl=saved.tmpl;if(saved.font)A.font=saved.font;if(saved.fs)A.fs=saved.fs;
    if(saved.acH)A.acH=saved.acH;if(saved.acA)A.acA=saved.acA;if(saved.acT)A.acT=saved.acT;if(saved.acBG)A.acBG=saved.acBG;
    if(saved.lineSpacing)A.lineSpacing=saved.lineSpacing;if(saved.align)A.align=saved.align;
  }catch(e){}}
}
function setMobileView(mode){
  const app=$('appScreen');if(!app)return;
  app.classList.remove('form-only','preview-only','sb-open');
  if(mode==='form')app.classList.add('form-only');
  if(mode==='preview')app.classList.add('preview-only');
  // Sync mobile bottom nav active state
  document.querySelectorAll('.mob-nav-btn').forEach(b=>b.classList.remove('active'));
  if(mode==='form'){const b=document.getElementById('mnEdit');if(b)b.classList.add('active');}
  if(mode==='preview'){const b=document.getElementById('mnPreview');if(b)b.classList.add('active');}
}
// â•â•â• GUIDED TOUR â€” REBUILT FROM SCRATCH â•â•â•
const TOUR_STEPS=[
  {sel:null, icon:'fas fa-hand-sparkles', title:'Welcome to Elyssor! ðŸ‘‹',
   text:'Let\'s take a quick tour so you know exactly where everything is. This will only take 30 seconds!',
   action:null},
  {sel:'#sb-rail', icon:'fas fa-compass', title:'Navigation Rail',
   text:'This is your command center. Each icon opens a different section â€” Personal info, Work experience, Education, Skills, and more. Click any icon to jump between sections.',
   action:null},
  {sel:'#sb-content', icon:'fas fa-edit', title:'Form Editor',
   text:'This is where you fill in your details. Each section has smart fields with suggestions, auto-complete, and real-time validation. Start with Personal Details!',
   action:null},
  {sel:'#previewPanel', icon:'fas fa-eye', title:'Live Resume Preview',
   text:'Your resume builds itself in real-time as you type. Every change you make instantly appears here â€” no refresh needed!',
   action:null},
  {sel:'#saveDD', icon:'fas fa-download', title:'Save & Export',
   text:'When you\'re ready, export as a polished PDF, save as JSON to resume later, or print directly. Your work auto-saves too!',
   action:function(){$('saveDD')?.classList.add('on');}},
  {sel:'#headerTourBtn', icon:'fas fa-route', title:'Replay This Tour',
   text:'You can restart this tour anytime by clicking this button in the header. It\'s always here if you need a refresher.',
   action:null},
  {sel:'#chinkoBtn', icon:'fas fa-robot', title:'Meet Chinko â€” Your AI Guide',
   text:'Chinko is your personal AI assistant. Ask questions, get resume tips, improve your ATS score, or get help with any section!',
   action:null},
  {sel:null, icon:'fas fa-rocket', title:'You\'re All Set! ðŸš€',
   text:'Start filling in your Personal Details on the left. Aim for 100% completion to maximize your ATS score. Good luck with your resume!',
   action:null}
];
let _tIdx=0;
function _tourEl(i){
  const s=TOUR_STEPS[i];
  if(!s||!s.sel)return null;
  return document.querySelector(s.sel);
}
function _positionSpotlight(el){
  const sl=$('tourSpotlight');if(!sl)return;
  if(!el){sl.style.display='none';return;}
  const r=el.getBoundingClientRect();
  const pad=6;
  sl.style.display='block';
  sl.style.top=(r.top-pad)+'px';
  sl.style.left=(r.left-pad)+'px';
  sl.style.width=(r.width+pad*2)+'px';
  sl.style.height=(r.height+pad*2)+'px';
}
function _positionDialog(el){
  const dlg=$('tourDialog');if(!dlg)return;
  const dW=dlg.offsetWidth||380;
  const dH=dlg.offsetHeight||260;
  if(!el){
    dlg.style.top=Math.max(16,(window.innerHeight-dH)/2)+'px';
    dlg.style.left=Math.max(16,(window.innerWidth-dW)/2)+'px';
    return;
  }
  const r=el.getBoundingClientRect();
  const spaceBelow=window.innerHeight-r.bottom;
  const spaceAbove=r.top;
  const spaceRight=window.innerWidth-r.right;
  let top,left;
  if(spaceBelow>=dH+20){
    top=r.bottom+14;
    left=Math.min(window.innerWidth-dW-16,Math.max(16,r.left));
  }else if(spaceAbove>=dH+20){
    top=r.top-dH-14;
    left=Math.min(window.innerWidth-dW-16,Math.max(16,r.left));
  }else if(spaceRight>=dW+20){
    top=Math.min(window.innerHeight-dH-16,Math.max(16,r.top));
    left=r.right+14;
  }else{
    top=Math.max(16,(window.innerHeight-dH)/2);
    left=Math.max(16,(window.innerWidth-dW)/2);
  }
  dlg.style.top=top+'px';
  dlg.style.left=left+'px';
}
function showTourStep(i){
  const step=TOUR_STEPS[i];if(!step)return;
  _tIdx=i;
  const el=_tourEl(i);
  if(step.action)step.action();
  if(el)el.scrollIntoView({behavior:'smooth',block:'nearest',inline:'nearest'});
  setTimeout(()=>{
    _positionSpotlight(el);
    const ico=$('tourIco');if(ico)ico.innerHTML='<i class="'+step.icon+'"></i>';
    const st=$('tourStep');if(st)st.textContent='Step '+(i+1)+' of '+TOUR_STEPS.length;
    const tt=$('tourTitle');if(tt)tt.textContent=step.title;
    const tb=$('tourBody');if(tb)tb.textContent=step.text;
    const pf=$('tourProgress');if(pf)pf.style.width=((i+1)/TOUR_STEPS.length*100)+'%';
    const bk=$('tourBack');if(bk)bk.disabled=(i===0);
    const nx=$('tourNext');if(nx)nx.innerHTML=(i===TOUR_STEPS.length-1)?'Finish <i class="fas fa-check"></i>':'Next <i class="fas fa-arrow-right"></i>';
    _positionDialog(el);
    const dlg=$('tourDialog');if(dlg){dlg.classList.remove('show');void dlg.offsetWidth;dlg.classList.add('show');}
  },el?300:50);
  $('tourBackdrop')?.classList.add('active');
}
function endTour(){
  $('tourBackdrop')?.classList.remove('active');
  const sl=$('tourSpotlight');if(sl)sl.style.display='none';
  const dlg=$('tourDialog');if(dlg){dlg.classList.remove('show');dlg.style.display='none';}
  $('saveDD')?.classList.remove('on');
  if(A.user?.id&&A.user.id!=='guest')localStorage.setItem('elyssor_tour_'+A.user.id,'done');
}
function startTour(){
  _tIdx=0;
  const dlg=$('tourDialog');if(dlg)dlg.style.display='';
  showTourStep(0);
}
function showTourIfFirstLogin(){
  if(!A.user?.id||A.user.id==='guest')return;
  if(localStorage.getItem('elyssor_tour_'+A.user.id)==='done')return;
  setTimeout(startTour,800);
}
jQuery(function(){
  // Mobile menu (original buttons)
  jQuery('#mb-menu').on('click',()=>jQuery('#appScreen').toggleClass('sb-open'));
  jQuery('#sb-overlay').on('click',()=>jQuery('#appScreen').removeClass('sb-open'));
  jQuery('#mb-preview').on('click',()=>{
    const app=jQuery('#appScreen');
    if(app.hasClass('preview-only'))setMobileView('form');else setMobileView('preview');
  });
  // Mobile bottom nav â€” sidebar toggle
  jQuery('#mnSidebar').on('click',function(){
    jQuery('.mob-nav-btn').removeClass('active');
    jQuery(this).addClass('active');
  });
  // When sidebar closes (overlay click), reset nav state
  jQuery('#sb-overlay').on('click',function(){
    jQuery('.mob-nav-btn').removeClass('active');
    jQuery('#mnEdit').addClass('active');
  });
  // Default to form-only on mobile load
  if(window.innerWidth<=768){setMobileView('form');}
  // Global grammar auto-correction on all textareas (debounced)
  let _gramTimer;
  jQuery(document).on('input','textarea.fi, textarea.inp',function(){
    const el=this;
    clearTimeout(_gramTimer);
    _gramTimer=setTimeout(()=>{
      if(typeof inlGram==='function')inlGram(el);
    },600);
  });
  // Quick actions
  jQuery('#qa-toggle').on('click',()=>jQuery('#quickActions').toggleClass('open'));
  jQuery('#qa-panel .qa-btn').on('click',function(){
    const act=jQuery(this).data('action');
    if(act==='form')setMobileView('form');
    if(act==='preview')setMobileView('preview');
    if(act==='save')autoSave();
    if(act==='pdf')dlPDF();
    if(act==='tour')startTour();
    jQuery('#quickActions').removeClass('open');
  });
  // Tour navigation
  jQuery('#tourNext').on('click',function(){
    if(_tIdx>=TOUR_STEPS.length-1){endTour();return;}
    showTourStep(_tIdx+1);
  });
  jQuery('#tourBack').on('click',function(){
    if(_tIdx>0)showTourStep(_tIdx-1);
  });
  jQuery('#tourSkip').on('click',endTour);
  jQuery('#tourBackdrop').on('click',endTour);
  // Reposition on resize
  jQuery(window).on('resize',function(){
    if(jQuery('#tourBackdrop').hasClass('active')){
      const el=_tourEl(_tIdx);
      _positionSpotlight(el);
      _positionDialog(el);
    }
    if(window.innerWidth>980){jQuery('#appScreen').removeClass('form-only preview-only sb-open');}
    else if(window.innerWidth<=768 && !jQuery('#appScreen').hasClass('form-only') && !jQuery('#appScreen').hasClass('preview-only')){setMobileView('form');}
  });
  // Close dropdowns
  jQuery(document).on('click',function(e){
    if(!jQuery(e.target).closest('#quickActions').length)jQuery('#quickActions').removeClass('open');
    if(!jQuery(e.target).closest('#mainSidebar').length && !jQuery(e.target).closest('#mb-menu').length)jQuery('#appScreen').removeClass('sb-open');
    if(!jQuery(e.target).closest('#resumeDD').length)jQuery('#resumeDD').removeClass('open');
  });
  jQuery('#sb-rail .st').on('click',()=>{
    if(window.innerWidth<=980){setMobileView('form');jQuery('#appScreen').removeClass('sb-open');}
  });
  // â•â•â• KEYBOARD SHORTCUTS â•â•â•
  jQuery(document).on('keydown',function(e){
    // Ctrl+K â†’ Command palette
    if((e.ctrlKey||e.metaKey)&&e.key==='k'){e.preventDefault();if(jQuery('#cmdPalette').hasClass('show'))closeCmdPalette();else openCmdPalette();return;}
    // Ctrl+S â†’ Save
    if((e.ctrlKey||e.metaKey)&&e.key==='s'&&!e.shiftKey){e.preventDefault();autoSave();return;}
    // Ctrl+E â†’ Export PDF
    if((e.ctrlKey||e.metaKey)&&e.key==='e'){e.preventDefault();dlPDF();return;}
    // Ctrl+P â†’ Toggle preview (only on mobile or always)
    if((e.ctrlKey||e.metaKey)&&e.key==='p'){e.preventDefault();const app=jQuery('#appScreen');if(app.hasClass('preview-only'))setMobileView('form');else setMobileView('preview');return;}
    // Ctrl+Z â†’ Undo
    if((e.ctrlKey||e.metaKey)&&e.key==='z'&&!e.shiftKey){if(!jQuery(e.target).is('input,textarea,select')){e.preventDefault();doUndo();return;}}
    // Ctrl+Shift+Z â†’ Redo
    if((e.ctrlKey||e.metaKey)&&e.shiftKey&&e.key==='Z'){if(!jQuery(e.target).is('input,textarea,select')){e.preventDefault();doRedo();return;}}
    // ESC â†’ close command palette
    if(e.key==='Escape'){if(jQuery('#cmdPalette').hasClass('show')){closeCmdPalette();return;}}
  });
  // Command palette input handling
  jQuery('#cmdInput').on('input',function(){
    _cmdIdx=0;
    renderCmdList(this.value);
  });
  jQuery('#cmdInput').on('keydown',function(e){
    const items=jQuery('.cmd-item');
    if(e.key==='ArrowDown'){e.preventDefault();_cmdIdx=Math.min(_cmdIdx+1,items.length-1);highlightCmd();items[_cmdIdx]?.scrollIntoView({block:'nearest'});}
    if(e.key==='ArrowUp'){e.preventDefault();_cmdIdx=Math.max(_cmdIdx-1,0);highlightCmd();items[_cmdIdx]?.scrollIntoView({block:'nearest'});}
    if(e.key==='Enter'){e.preventDefault();execCmd(_cmdIdx,this.value);}
  });
  jQuery('#cmdPalette').on('click',function(e){if(e.target.id==='cmdPalette')closeCmdPalette();});
});
function dlPDF(){
  const el=$('resume-content');if(!el){showToast('Generate your resume first');return;}
  const opt={margin:[8,8,8,8],filename:(A.personal.name||'Resume')+'-Elyssor.pdf',image:{type:'jpeg',quality:.95},html2canvas:{scale:2,useCORS:true},jsPDF:{unit:'mm',format:'a4',orientation:'portrait'}};
  showToast('Generating PDF...');
  html2pdf().set(opt).from(el).save().then(()=>showToast('PDF exported! âœ“'));
}
function dlJSON(){
  const data={personal:A.personal,summary:A.summary,exp:A.exp,edu:A.edu,skills:A.skills,certs:A.certs,proj:A.proj,intern:A.intern,customText:A.customText};
  const blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'});
  const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download=(A.personal.name||'Resume')+'-Elyssor.json';a.click();
  showToast('JSON saved âœ“');
}

// â•â•â• 1. COMMAND PALETTE (Ctrl+K) â•â•â•
const CMD_ACTIONS=[
  {name:'Go to Personal Details',icon:'fas fa-user',kbd:'',fn:()=>showSec('personal',document.querySelector('.st[onclick*=personal]'))},
  {name:'Go to Summary',icon:'fas fa-align-left',kbd:'',fn:()=>showSec('summary',document.querySelector('.st[onclick*=summary]'))},
  {name:'Go to Work Experience',icon:'fas fa-briefcase',kbd:'',fn:()=>showSec('exp',document.querySelector('.st[onclick*=exp]'))},
  {name:'Go to Education',icon:'fas fa-graduation-cap',kbd:'',fn:()=>showSec('edu',document.querySelector('.st[onclick*=edu]'))},
  {name:'Go to Skills',icon:'fas fa-code',kbd:'',fn:()=>showSec('skills',document.querySelector('.st[onclick*=skills]'))},
  {name:'Go to Certifications',icon:'fas fa-certificate',kbd:'',fn:()=>showSec('certs',document.querySelector('.st[onclick*=certs]'))},
  {name:'Go to Projects',icon:'fas fa-folder-open',kbd:'',fn:()=>showSec('proj',document.querySelector('.st[onclick*=proj]'))},
  {name:'Go to Internships',icon:'fas fa-star',kbd:'',fn:()=>showSec('intern',document.querySelector('.st[onclick*=intern]'))},
  {name:'Go to Templates & Design',icon:'fas fa-palette',kbd:'',fn:()=>showSec('design',document.querySelector('.st[onclick*=design]'))},
  {name:'Go to Customization',icon:'fas fa-sliders-h',kbd:'',fn:()=>showSec('customization',document.querySelector('.st[onclick*=customization]'))},
  {name:'Go to Grammar Check',icon:'fas fa-spell-check',kbd:'',fn:()=>showSec('grammar',document.querySelector('.st[onclick*=grammar]'))},
  {name:'Go to ATS Analysis',icon:'fas fa-chart-bar',kbd:'',fn:()=>showSec('analysis',document.querySelector('.st[onclick*=analysis]'))},
  {name:'Go to Courses',icon:'fas fa-book-open',kbd:'',fn:()=>showSec('courses',document.querySelector('.st[onclick*=courses]'))},
  {name:'Save Progress',icon:'fas fa-save',kbd:'Ctrl+S',fn:()=>autoSave()},
  {name:'Export as PDF',icon:'fas fa-file-pdf',kbd:'Ctrl+E',fn:()=>dlPDF()},
  {name:'Save as JSON',icon:'fas fa-file-code',kbd:'',fn:()=>dlJSON()},
  {name:'Toggle Preview / Form (Mobile)',icon:'fas fa-eye',kbd:'Ctrl+P',fn:()=>{const app=$('appScreen');if(app?.classList.contains('preview-only'))setMobileView('form');else setMobileView('preview');}},
  {name:'Open Analytics Dashboard',icon:'fas fa-chart-pie',kbd:'',fn:()=>goViz()},
  {name:'Take Guided Tour',icon:'fas fa-route',kbd:'',fn:()=>startTour()},
  {name:'Toggle Theme (Dark/Light)',icon:'fas fa-adjust',kbd:'',fn:()=>toggleTheme()},
  {name:'Undo',icon:'fas fa-undo',kbd:'Ctrl+Z',fn:()=>doUndo()},
  {name:'Redo',icon:'fas fa-redo',kbd:'Ctrl+Shift+Z',fn:()=>doRedo()},
  {name:'Upgrade Plan',icon:'fas fa-crown',kbd:'',fn:()=>showScreen('subScreen')},
  {name:'Recruiter Portal',icon:'fas fa-building',kbd:'',fn:()=>showScreen('recruiterScreen')},
  {name:'Ask Chinko AI',icon:'fas fa-robot',kbd:'',fn:()=>toggleChinko()},
  {name:'Generate AI Summary',icon:'fas fa-wand-magic-sparkles',kbd:'',fn:()=>genSum()},
  {name:'Print Resume',icon:'fas fa-print',kbd:'',fn:()=>window.print()},
  {name:'Logout',icon:'fas fa-sign-out-alt',kbd:'',fn:()=>doLogout()},
];
let _cmdIdx=0;
function openCmdPalette(){
  const pal=$('cmdPalette');if(!pal)return;
  pal.classList.add('show');
  const inp=$('cmdInput');if(inp){inp.value='';inp.focus();}
  _cmdIdx=0;renderCmdList('');
}
function closeCmdPalette(){$('cmdPalette')?.classList.remove('show');}
function renderCmdList(q){
  const list=$('cmdList');if(!list)return;
  const lq=q.toLowerCase();
  const filtered=q?CMD_ACTIONS.filter(a=>a.name.toLowerCase().includes(lq)):CMD_ACTIONS;
  if(!filtered.length){list.innerHTML='<div class="cmd-empty">No commands found for "'+q+'"</div>';return;}
  _cmdIdx=Math.min(_cmdIdx,filtered.length-1);
  list.innerHTML=filtered.map((a,i)=>'<div class="cmd-item'+(i===_cmdIdx?' active':'')+'" data-idx="'+i+'" onmouseenter="_cmdIdx='+i+';highlightCmd()" onclick="execCmd('+i+',\''+q.replace(/'/g,"\\'")+'\')"><i class="'+a.icon+'"></i><span class="cmd-item-text">'+a.name+'</span>'+(a.kbd?'<span class="cmd-item-kbd">'+a.kbd+'</span>':'')+'</div>').join('');
}
function highlightCmd(){
  document.querySelectorAll('.cmd-item').forEach((el,i)=>el.classList.toggle('active',i===_cmdIdx));
}
function execCmd(idx,q){
  const lq=(q||'').toLowerCase();
  const filtered=q?CMD_ACTIONS.filter(a=>a.name.toLowerCase().includes(lq)):CMD_ACTIONS;
  if(filtered[idx]){closeCmdPalette();filtered[idx].fn();}
}

// â•â•â• 2. AUTO-SAVE WITH STATUS INDICATOR â•â•â•
let _autoSaveTimer=null;
let _lastSaveTime=0;
let _saveStatusTimer=null;
let _hasUnsaved=false;
function markUnsaved(){
  _hasUnsaved=true;
  const el=$('saveStatus'),txt=$('saveStatusText');
  if(el){el.className='save-status unsaved';}
  if(txt)txt.textContent='Unsaved changes';
  clearTimeout(_autoSaveTimer);
  _autoSaveTimer=setTimeout(()=>{silentAutoSave();},30000);
}
function silentAutoSave(){
  if(!A.user)return;
  const el=$('saveStatus'),txt=$('saveStatusText');
  if(el)el.className='save-status saving';
  if(txt)txt.textContent='Saving...';
  const uid=A.user?.id||'guest';
  DB.saveResume(uid,getState());
  _lastSaveTime=Date.now();
  _hasUnsaved=false;
  setTimeout(()=>{
    if(el)el.className='save-status saved';
    if(txt)txt.textContent='Saved just now';
    updSaveTimeAgo();
  },400);
}
function updSaveTimeAgo(){
  clearInterval(_saveStatusTimer);
  _saveStatusTimer=setInterval(()=>{
    if(_hasUnsaved||!_lastSaveTime)return;
    const diff=Math.floor((Date.now()-_lastSaveTime)/1000);
    const txt=$('saveStatusText');
    if(!txt)return;
    if(diff<10)txt.textContent='Saved just now';
    else if(diff<60)txt.textContent='Saved '+diff+'s ago';
    else txt.textContent='Saved '+Math.floor(diff/60)+'m ago';
  },5000);
}

// â•â•â• 3. UNDO / REDO SYSTEM â•â•â•
const _undoStack=[];
const _redoStack=[];
let _snapshotTimer=null;
function pushSnapshot(){
  clearTimeout(_snapshotTimer);
  _snapshotTimer=setTimeout(()=>{
    const snap=JSON.stringify(getState());
    if(_undoStack.length>0&&_undoStack[_undoStack.length-1]===snap)return;
    _undoStack.push(snap);
    if(_undoStack.length>20)_undoStack.shift();
    _redoStack.length=0;
    updUndoRedoBtns();
  },500);
}
function doUndo(){
  if(_undoStack.length<2)return;
  _redoStack.push(_undoStack.pop());
  const snap=JSON.parse(_undoStack[_undoStack.length-1]);
  restoreSnap(snap);
  updUndoRedoBtns();
  showToast('Undo â†¶');
}
function doRedo(){
  if(!_redoStack.length)return;
  const snap=JSON.parse(_redoStack.pop());
  _undoStack.push(JSON.stringify(snap));
  restoreSnap(snap);
  updUndoRedoBtns();
  showToast('Redo â†·');
}
function restoreSnap(s){
  Object.assign(A,{personal:s.personal||{},summary:s.summary||'',exp:s.exp||[],edu:s.edu||[],skills:s.skills||{tech:[],prof:[],tools:[],fw:[]},certs:s.certs||[],proj:s.proj||[],intern:s.intern||[],customText:s.customText||'',photoData:s.photoData||null});
  if(s.tmpl)A.tmpl=s.tmpl;if(s.font)A.font=s.font;if(s.fs)A.fs=s.fs;
  if(s.acH)A.acH=s.acH;if(s.acA)A.acA=s.acA;if(s.acT)A.acT=s.acT;if(s.acBG)A.acBG=s.acBG;
  if(s.lineSpacing)A.lineSpacing=s.lineSpacing;if(s.align)A.align=s.align;
  populateF();renderAllLists();renderSkChips();updSug();liveUp();updATS();updComp();syncCustFieldsFromMain();
}
function updUndoRedoBtns(){
  const ub=$('undoBtn'),rb=$('redoBtn');
  if(ub)ub.disabled=_undoStack.length<2;
  if(rb)rb.disabled=!_redoStack.length;
}

// â•â•â• 4. CONFETTI CELEBRATIONS â•â•â•
let _celebratedMilestones={};
const CONFETTI_COLORS=['#caa46a','#e0b980','#b78a53','#7b8d74','#5a9fd4','#f59e0b','#ef5350','#4fc3f7','#a855f7','#4ade80'];
function fireConfetti(){
  const box=$('confettiBox');if(!box)return;
  box.innerHTML='';
  for(let i=0;i<60;i++){
    const p=document.createElement('div');p.className='confetti-piece';
    p.style.left=Math.random()*100+'%';
    p.style.background=CONFETTI_COLORS[Math.floor(Math.random()*CONFETTI_COLORS.length)];
    p.style.width=(6+Math.random()*8)+'px';
    p.style.height=(6+Math.random()*8)+'px';
    p.style.borderRadius=Math.random()>.5?'50%':'2px';
    p.style.animationDuration=(2+Math.random()*1.5)+'s';
    p.style.animationDelay=(Math.random()*0.5)+'s';
    box.appendChild(p);
  }
  setTimeout(()=>{box.innerHTML='';},4000);
}
function showMilestone(icon,title,sub){
  const mt=document.createElement('div');mt.className='milestone-toast';
  mt.innerHTML='<div class="mt-icon">'+icon+'</div><div class="mt-title">'+title+'</div><div class="mt-sub">'+sub+'</div>';
  document.body.appendChild(mt);
  fireConfetti();
  setTimeout(()=>{mt.style.opacity='0';mt.style.transform='translate(-50%,-50%) scale(.8)';mt.style.transition='.3s';setTimeout(()=>mt.remove(),400);},2800);
}
function checkMilestones(){
  const {score}=calcATS();
  const pctDone=pcItems.filter(i=>i.f()).length;
  const pct=Math.round(pctDone/pcItems.length*100);
  if(score>=85&&!_celebratedMilestones.ats85){
    _celebratedMilestones.ats85=true;
    setTimeout(()=>showMilestone('ðŸŽ¯','ATS Score 85+!','Your resume is highly ATS-optimized!'),600);
  }
  if(pct>=100&&!_celebratedMilestones.complete){
    _celebratedMilestones.complete=true;
    setTimeout(()=>showMilestone('ðŸ†','100% Complete!','Your resume is fully filled out â€” impressive!'),600);
  }
  if(pct>=75&&!_celebratedMilestones.p75){
    _celebratedMilestones.p75=true;
    if(pct<100)setTimeout(()=>showMilestone('âš¡','75% Complete!','Almost there â€” keep going!'),600);
  }
  if(pct>=50&&!_celebratedMilestones.p50){
    _celebratedMilestones.p50=true;
    if(pct<75)setTimeout(()=>showMilestone('ðŸ”¥','50% Milestone!','Halfway there â€” great progress!'),600);
  }
}

// â•â•â• 5. PASSWORD VISIBILITY TOGGLE â•â•â•
function togglePwd(inputId,btn){
  const inp=$(inputId);if(!inp)return;
  const isVisible=inp.type==='text';
  inp.type=isVisible?'password':'text';
  const ico=btn.querySelector('i');
  if(ico)ico.className=isVisible?'fas fa-eye':'fas fa-eye-slash';
}

// â•â•â• 6. WORD/CHARACTER COUNTER â•â•â•
function updCharCounter(inputId,counterId,min,max){
  const inp=$(inputId),counter=$(counterId);
  if(!inp||!counter)return;
  const len=inp.value.length;
  const words=inp.value.trim()?inp.value.trim().split(/\s+/).length:0;
  counter.textContent=len+' chars Â· '+words+' words';
  counter.className='cc-count'+(len>=min&&len<=max?' ok':len>max?' over':' warn');
}

// â•â•â• 7. DARK/LIGHT THEME TOGGLE â•â•â•
function toggleTheme(){
  document.body.classList.toggle('light-theme');
  const isLight=document.body.classList.contains('light-theme');
  localStorage.setItem('elyssor_theme',isLight?'light':'dark');
}
function loadTheme(){
  const saved=localStorage.getItem('elyssor_theme');
  if(saved==='light')document.body.classList.add('light-theme');
}

// â•â•â• 9. MULTI-RESUME SUPPORT â•â•â•
let _activeResumeIdx=0;
function _resumeKey(){return 'elyssor_resumes_'+(A.user?.id||'guest');}
function getResumeList(){
  try{const raw=localStorage.getItem(_resumeKey());return raw?JSON.parse(raw):[{name:'Resume 1',data:null}];}
  catch(e){return[{name:'Resume 1',data:null}];}
}
function saveResumeList(list){localStorage.setItem(_resumeKey(),JSON.stringify(list));}
function renderResumeDD(){
  const list=getResumeList();
  const nameEl=$('resumeDDName');if(nameEl)nameEl.textContent=list[_activeResumeIdx]?.name||'Resume 1';
  const rddList=$('rddList');if(!rddList)return;
  rddList.innerHTML=list.map((r,i)=>'<div class="rdd-item'+(i===_activeResumeIdx?' active':'')+'" onclick="switchResume('+i+')"><i class="fas fa-file-alt"></i><span class="rdd-item-name">'+r.name+'</span>'+(list.length>1?'<span class="rdd-item-del" onclick="event.stopPropagation();deleteResume('+i+')"><i class="fas fa-trash-alt"></i></span>':'')+'</div>').join('');
}
function toggleResumeDD(){$('resumeDD')?.classList.toggle('open');}
function switchResume(idx){
  const list=getResumeList();
  // save current resume data first
  list[_activeResumeIdx].data=getState();
  saveResumeList(list);
  // switch
  _activeResumeIdx=idx;
  if(list[idx].data){
    const s=list[idx].data;
    Object.assign(A,{personal:s.personal||{},summary:s.summary||'',exp:s.exp||[],edu:s.edu||[],skills:s.skills||{tech:[],prof:[],tools:[],fw:[]},certs:s.certs||[],proj:s.proj||[],intern:s.intern||[],customText:s.customText||'',photoData:s.photoData||null});
    if(s.tmpl)A.tmpl=s.tmpl;if(s.font)A.font=s.font;if(s.fs)A.fs=s.fs;
    if(s.acH)A.acH=s.acH;if(s.acA)A.acA=s.acA;if(s.acT)A.acT=s.acT;if(s.acBG)A.acBG=s.acBG;
    if(s.lineSpacing)A.lineSpacing=s.lineSpacing;if(s.align)A.align=s.align;
    populateF();renderAllLists();renderSkChips();updSug();liveUp();updATS();updComp();syncCustFieldsFromMain();
  } else {
    // new blank resume
    Object.assign(A,{personal:{},summary:'',exp:[],edu:[],skills:{tech:[],prof:[],tools:[],fw:[]},certs:[],proj:[],intern:[],customText:'',photoData:null});
    populateF();renderAllLists();renderSkChips();updSug();liveUp();updATS();updComp();syncCustFieldsFromMain();
  }
  renderResumeDD();
  $('resumeDD')?.classList.remove('open');
  showToast('Switched to: '+list[idx].name);
}
function createNewResume(){
  const list=getResumeList();
  if(list.length>=5){showToast('Max 5 resumes allowed');return;}
  list[_activeResumeIdx].data=getState();
  list.push({name:'Resume '+(list.length+1),data:null});
  saveResumeList(list);
  switchResume(list.length-1);
}
function duplicateResume(){
  const list=getResumeList();
  if(list.length>=5){showToast('Max 5 resumes allowed');return;}
  list[_activeResumeIdx].data=getState();
  list.push({name:list[_activeResumeIdx].name+' (Copy)',data:JSON.parse(JSON.stringify(getState()))});
  saveResumeList(list);
  switchResume(list.length-1);
}
function renameResume(){
  const list=getResumeList();
  const newName=prompt('Rename resume:',list[_activeResumeIdx].name);
  if(!newName||!newName.trim())return;
  list[_activeResumeIdx].name=newName.trim();
  saveResumeList(list);
  renderResumeDD();
  showToast('Renamed to: '+newName.trim());
}
function deleteResume(idx){
  const list=getResumeList();
  if(list.length<=1){showToast('Cannot delete the only resume');return;}
  if(!confirm('Delete "'+list[idx].name+'"?'))return;
  list.splice(idx,1);
  if(_activeResumeIdx>=list.length)_activeResumeIdx=list.length-1;
  saveResumeList(list);
  switchResume(_activeResumeIdx);
}

// ---- INIT ----
(function init(){
  loadTheme();
  // Check for existing session
  const sess=DB.getSession();
  if(sess&&sess.id){
    A.user=sess;A.userType=sess.userType||'student';A.field=sess.field||'';A.plan=sess.plan||'free';A.isRec=false;
    loadState();launchApp();return;
  }
  // Fallback: old localStorage format
  const saved=localStorage.getItem('elyssor_user');
  if(saved){try{const u=JSON.parse(saved);A.user=u;A.userType=u.userType||'student';A.field=u.field||'';A.plan=u.plan||'free';}catch(e){}}
})();
</script>
</body>
</html>
